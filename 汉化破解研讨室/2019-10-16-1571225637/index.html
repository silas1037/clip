
  <!DOCTYPE html>
  <html id="" class="">
    <!-- OriginalSrc: https://www.iteye.com/blog/rednaxelafx-180447 -->
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <title>ケータイ少女 script.arc的解压缩程序 (Java) - Script Ahead, Code Behind - ITeye博客</title>
      
<link rel="shortcut icon" href="assets/1571225637-1cd7c6fd0de855e9efac8dbe4a274b55.ico" type="image/x-icon" referrerpolicy="no-referrer">


<link href="assets/1571225637-24c828ef0717ef81511085cae5ef164a.css" media="screen" rel="stylesheet" type="text/css" referrerpolicy="no-referrer">
<link href="assets/1571225637-368b60bb216b4f4bf566fad6964a61f9.css" media="screen" rel="stylesheet" type="text/css" referrerpolicy="no-referrer">
<link href="assets/1571225637-396dd74c56d84598b8a22d8cb10eaf3a.css" media="screen" rel="stylesheet" type="text/css" referrerpolicy="no-referrer">
<link rel="stylesheet" type="text/css" href="assets/1571225637-9aeb703993455cc093fff678a2ad3401.css" referrerpolicy="no-referrer">
<link rel="stylesheet" type="text/css" href="assets/1571225637-05fb66a2c1140728ea8d74162a702c22.css" referrerpolicy="no-referrer">


<style class="darkreader darkreader--fallback" media="screen"></style>
<style class="darkreader darkreader--text" media="screen"></style>
<style class="darkreader darkreader--invert" media="screen"></style>
<style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}</style>
<style class="darkreader darkreader--user-agent" media="screen">html {
    background-color: #191a1b !important;
}
html, body, input, textarea, select, button {
    background-color: #191a1b;
}
html, body, input, textarea, select, button {
    border-color: #5a5956;
    color: #f0ebe2;
}
a {
    color: #4791e7;
}
table {
    border-color: #4f4e4c;
}
::placeholder {
    color: #bfb9ac;
}
::selection {
    background-color: #125cb4;
    color: #fffffd;
}
::-moz-selection {
    background-color: #125cb4;
    color: #fffffd;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #565a0f !important;
    color: #f0ebe2 !important;
}
::-webkit-scrollbar {
    background-color: #1d1f1f;
    color: #cbc5b9;
}
::-webkit-scrollbar-thumb {
    background-color: #2c2d2d;
}
::-webkit-scrollbar-thumb:hover {
    background-color: #343636;
}
::-webkit-scrollbar-thumb:active {
    background-color: #404142;
}
::-webkit-scrollbar-corner {
    background-color: #191a1b;
}
* {
    scrollbar-color: #2c2d2d #1d1f1f;
}</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--override" media="screen">.jfk-bubble {
    background-color: #000000 !important;
}
.vimvixen-hint {
    background-color: #765500 !important;
    border-color: #d5b22e !important;
    color: #f9edcc !important;
}</style>
<style>
 
.hide-main-content{
    position: relative;
}
.hide-article-box {
    display: none;
    position: absolute;
    z-index: 9999;
    bottom: -1px;
    width: 100%;
    padding-top: 160px;
    background-image: -webkit-gradient(linear,left top, left bottom,from(rgba(255,255,255,0)),color-stop(70%, #fff));
    background-image: linear-gradient(-180deg,rgba(255,255,255,0) 0%,#fff 70%);
}
.hide-article-box #btn-readmore{
    color: #ca0c16;
    border: 1px solid #ca0c16;
    margin: 10px auto;
    padding: 0 8px;
    display: block;
    font-size: 14px;
    border-radius: 4px;
    text-align: center;
    background-color: transparent;
    height: 34px;
    width: 74px;
    line-height: 32px;
    min-width: 72px;
    cursor: pointer;
}
.hide-article-box #btn-readmore:hover{
    background: #ca0c16;
    color:#fff;
    text-decoration: none;
}
</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--cors" media="screen">body,dd,div,dl,dt,form,h1,h2,h3,h4,h5,h6,html,input,li,ol,p,select,td,textarea,th,ul{margin:0;padding:0}*{box-sizing:border-box}body,html{min-height:100%}h1,h2,h3,h4,h5,h6{font-weight:400}.recommend-right ul,ol{list-style:none}.recommend-right img{border:none;vertical-align:middle}.recommend-right a{text-decoration:none;color:#232323}.recommend-right table{border-collapse:collapse;table-layout:fixed}.recommend-right input,textarea{outline:0;border:none}.recommend-right textarea{resize:none;overflow:auto}.clearfix:after{content:" ";display:block;height:0;visibility:hidden;clear:both}.recommend{overflow:hidden}.newbox.recommend{overflow:hidden}svg.icon{width:1em;height:1em;vertical-align:-.15em;fill:currentColor;overflow:hidden;margin-right:4px}svg.icon.icon-level{width:3em;height:1em}.recommend-right{float:right;width:300px;margin-left:8px;background-color:#fff;-webkit-box-shadow:0 2px 4px 0 rgba(0,0,0,.05);box-shadow:0 2px 4px 0 rgba(0,0,0,.05)}.recommend-right .recommend-fixed-box{background-color:#fff}.recommend-right .right-item{padding:8px 0;overflow:hidden;word-break:break-all;margin-left:8px;margin-right:8px;border-bottom:1px solid #f5f5f5;box-sizing:border-box}.recommend-right .right-item:hover .content h5{color:#ca0c16}.recommend-right .right-item .content{margin-bottom:4px}.recommend-right .right-item .content img{width:58px;height:36px}.recommend-right .right-item .content h5{display:inline;font-size:14px;color:#5c5c5c;letter-spacing:0;line-height:20px;max-height:44px;overflow:hidden;font-weight:500;margin-right:4px;white-space:nowrap;text-overflow:ellipsis}.recommend-right .right-item .content .h5width{width:76%;margin-left:8px}.recommend-right .right-item .content span{margin-right:8px;font-size:12px;color:#999;letter-spacing:0;line-height:20px}.recommend-right .right-item .content .download_mark{border:1px solid #e3e3e3;padding:2px;margin-right:4px}.recommend-right .right-item .right-item-desc{font-size:12px;color:#999;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--cors" media="screen">.{font-family:""!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fanyi:before{content:"\e661"}.shouji:before{content:"\e66f"}.yuedushu:before{content:"\e682"}</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css">@keyframes fadeInOpacity{0%{opacity:0}to{opacity:1}}:hover>*>.fbvd--wrapper{animation-name:fadeInOpacity;animation-duration:.3s;opacity:1}.fbvd--wrapper{position:absolute;top:10px;left:10px;opacity:0;text-align:center;margin:0;z-index:5}.fbvd--wrapper a{background: url("") no-repeat 3px 4.55px; background-color: #fff; display:inline-block;font:700 14px Helvetica,Arial,sans-serif;color:#4b4f56;text-decoration:none;vertical-align:middle;padding:0px 8px 0px;margin-right:8px;border-radius:2px; line-height: 22px; padding-left:19px; border: 1px solid #e7e7e7; background-size: 13px}.fbvd--wrapper a:last-child{margin-right:0}.fbvd--wrapper a:hover{text-decoration:none}.fbvd--wrapper a:focus{box-shadow:0 0 1px 2px rgba(88,144,255,.75),0 1px 1px rgba(0,0,0,.15);outline:none}.fbvd--wrapper b{font-size:13px;position:relative;top:1px;color:#3b5998;font-weight:400}</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style>
  .userinfo {display: none !important;}
  .persion_article h3{
    background: none !important;
    border-bottom: none!important;
    padding: 0!important;
    margin-bottom: 0!important;
    line-height: 1!important;
  }
  .persion_article .right_box{
    margin-top: 0!important;
  }
  .persion_article .footer_box .feed_new_tit span{
    padding-left: 0!important;
  }
</style>
<style class="darkreader darkreader--sync" media="screen"></style>

      <style class="mx-wc-style">
        .mx-wc-main img {max-width: 100%;}
        .mx-wc-main{
          box-sizing: content-box;
          background-color: rgb(35, 36, 36) !important;
          margin: 0 auto;
          margin-top: 20px;
          max-width: 706px;
        }
        @media (min-width: 768px) {
          .mx-wc-main { padding: 15px 15px 80px 15px }
        }
        @media (max-width: 767px) {
          .mx-wc-main { padding: 15px 3px 80px 3px }
        }
  
      </style>
    </head>
    <body style="background-color: #464646 !important; min-height: 100%; height: auto; position: static !important; overflow: auto !important; padding-bottom: 0px !important;" id="" class="">
      <div class="mx-wc-main">
        <DIV id="page" style="display: block !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><DIV id="content" class="clearfix" style="display: block !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><div id="main" class="mx-wc-selected-elem mx-wc-1571225637" style="display: block; float: none !important; position: relative !important; top: 0px !important; left: 0px !important; margin: 0px !important; flex: unset !important; width: 100% !important; max-width: 100% !important;">
        



        





<div class="blog_main">
  
  <div class="blog_title">
    <h3>
      ケータイ少女 script.arc的解压缩程序 (Java)
      <em class="actions">      </em>
    </h3>
    <ul class="blog_categories"><strong>博客分类：</strong> <li><a href="https://www.iteye.com/category/24338" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Reverse Engineering</a></li> </ul>
        <div class="news_tag"><a href="http://www.iteye.com/blogs/tag/Java" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Java</a><a href="http://www.iteye.com/blogs/tag/J%23" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">J#</a><a href="http://www.iteye.com/blogs/tag/%E6%B8%B8%E6%88%8F" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">游戏</a><a href="http://www.iteye.com/blogs/tag/Go" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Go</a><a href="http://www.iteye.com/blogs/tag/F%23" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">F#</a>&nbsp;</div>
  </div>

  <div id="blog_content" class="hide-main-content">
    
    嗯，这个也是快一年前写的了。当时在澄空看到有人想要解手机少女的文件，就随便写了个程序来处理这个script.arc与string.arc。另外几个arc文件用下面的程序处理不了，因为文件头里的信息没有被正确的处理。嘛，后来<a href="http://plaza.rakuten.co.jp/asmodean" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">asmodean</a>也放出了处理这个游戏的工具而且是用C++写的，我就没必要继续把这个程序做完。
<br>
<br>也是由于使用了<a href="http://www.hotpixel.net/software.html" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">BlowfishJ</a>的BinConverter.java，所以以下代码以<a href="http://www.gnu.org/copyleft/lesser.html" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">LGPL</a>许可证发布。
<br>
<br>Archiver.java:
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%2F*%0A%20*%20%40(%23)Archiver.java%20%202007%2F05%2F15%0A%20*%20Written%20by%20rednaxela%20%2F%20FX%0A%20*%2F%0A%0Aimport%20java.io.*%3B%0Aimport%20java.util.*%3B%0A%0A%2F*%0A%0AData%20structures%3A%0A%0A%2F%2F--------------------------------%0Atypedef%20struct%20tagHEADER%20%7B%0A%20%20%20%20DWORD%20id%3B%20%20%20%20%20%20%20%2F%2F%20IDENTIFIER%2C%20BE%20AD%20CA%20A8%2C%20little-endian%20(%22ARCW%22%20xor%200xFF)%0A%20%20%20%20DWORD%20ver%3B%20%20%20%20%20%20%2F%2F%20VERSION%2C%20locked%20to%200x00%0A%20%20%20%20DWORD%20fileSize%3B%20%2F%2F%20total%20size%20of%20current%20archive%0A%20%20%20%20DWORD%20data_offset%3B%20%20%2F%2F%20begin%20offset%20of%20file%20data%0A%7D%20HEADER%3B%20%2F%2F%2016%20bytes%0A%0Atypedef%20struct%20tagSECINFO%20%7B%0A%20%20%20%20DWORD%20sectionLength%3B%20%2F%2F%20sectionLength%20%3D%20len(SECINFO)(%3D0x0C)%20%2B%20len(SECDATA)%0A%20%20%20%20DWORD%20flags%3B%20%20%20%20%20%20%20%20%20%2F%2F%20flags%3A%20NOT_MSK%20%3D%201%2C%20LZSS_MSK%20%3D%202%0A%20%20%20%20DWORD%20origSize%3B%20%20%20%20%20%20%2F%2F%20original%20size%20of%20SECDATA%20after%20inflation%0A%7D%20SECINFO%3B%20%2F%2F%2012%20bytes%0A%0Atypedef%20struct%20tagSECDATA%20%7B%0A%20%20%20%20BYTE%20data%5BSECINFO.sectionLength%20-%2012%5D%3B%0A%20%20%20%20%2F%2F%20when%20SECINFO.flags%20%3D%20NOT_MSK%20%7C%20LZSS_MSK%2C%20the%20contents%20is%20both%20encrypted%20by%20NOT%0A%20%20%20%20%2F%2F%20and%20compressed%20by%20LZSS.%0A%7D%20SECDATA%3B%0A%0Astruct%20INDEXBLOCK1%20%7B%0A%20%20%20%20%0A%20%20%20%20struct%20INDEXENTRY%20%7B%0A%20%20%20%20%20%20%20%20DWORD%20offset%3B%20%2F%2F%20actualOfs%20%3D%20offset%20%2B%20totalHeaderLength%20-%200x0C%0A%20%20%20%20%20%20%20%20DWORD%20length%3B%20%2F%2F%20length%20in%20archive%0A%20%20%20%20%20%20%20%20DWORD%20flags%3B%20%20%2F%2F%20NOT_MSK%20%3D%201%2C%20LZSS_MSK%20%3D%202%0A%20%20%20%20%20%20%20%20DWORD%20origLen%3B%20%2F%2F%20original%20file%20length%0A%20%20%20%20%7D%3B%0A%20%20%20%20%0A%20%20%20%20DWORD%20reserved1%3B%20%20%20%2F%2F%20some%20sort%20of%20flag%20I%20guess%0A%20%20%20%20DWORD%20reserved2%3B%20%20%20%2F%2F%20seems%20to%20be%20always%20zero%0A%20%20%20%20DWORD%20entryCount%3B%20%20%2F%2F%20number%20of%20entries%20in%20this%20block%0A%20%20%20%20DWORD%20blockLength%3B%20%2F%2F%20length%20of%20the%20remaining%20part%20of%20this%20block%0A%20%20%20%20%0A%20%20%20%20DWORD%20nameOffset%5BentryCount%5D%3B%20%2F%2F%20offset%20relative%20to%20nameSecData%20after%20decode%20and%20decompression%0A%20%20%20%20INDEXENTRY%20entry%5BentryCount%5D%3B%20%2F%2F%20TOC%20entrys%0A%7D%3B%0A%0Astruct%20INDEXBLOCK2%20%7B%0A%7D%3B%20%2F%2F%20structure%20is%20unknown%0A%0A%0A%2F%2F--------------------------------%0A%0Aarc%20file%3A%0A%0AHEADER%20header%3B%20%20%20%20%20%20%20%2F%2F%201%20header%20per%20archive%0ASECINFO%20nameSecInfo%3B%20%2F%2F%201st%20of%20SECINFO%20in%20archive%0ASECDATA%20nameSecData%3B%20%2F%2F%201st%20of%20SECDATA%20in%20archive%2C%20contents%20of%20which%20are%20filenames%20in%20UNICODE%0ASECINFO%20indexSecInfo%3B%20%2F%2F%202nd%20of%20SECINFO%20in%20archive%0ASECDATA%20indexSecData%3B%20%2F%2F%202nd%20of%20SECDATA%20in%20archive%2C%20contents%20of%20which%20indicates%20offset%2C%20length%2C%20flag%20info%20of%20file%20data.%0Abytes%20data%5B%5D%3B%20%2F%2F%20remaining%20part%20of%20archive%2C%20which%20is%20file%20data%0A%0A%2F%2F--------------------------------%0A%0AindexSecData%20after%20decode%20and%20decompression%3A%0A%0ADWORD%20blockCount%3B%0AINDEXBLOCK1%20block1%3B%0A%2F%2F%20INDEXBLOCK2%20block2%3B%20%2F%2F%20this%20is%20where%20I've%20got%20trouble%20figuring%20out.%0A%0A*%2F%0A%0A%2F**%0A%20*%20Demonstrating%20archive%20operations%20on%20*.arc%20files%20as%20seen%20in%20Ketai-s.%0A%20*%2F%0Apublic%20class%20Archiver%20%7B%0A%20%20%20%20%0A%20%20%20%20static%20final%20int%20IDENTIFIER%20%3D%200xA8BCADBE%3B%0A%20%20%20%20static%20final%20int%20VERSION%20%3D%200x00%3B%0A%20%20%20%20static%20final%20int%20NOT_MSK%20%3D%201%3B%0A%20%20%20%20static%20final%20int%20LZSS_MSK%20%3D%202%3B%0A%0A%20%20%20%20static%20final%20String%20USAGE%20%3D%20%22Usage%3A%20java%20Archiver%20%5Boption%5D%20srcPath%20dstPath%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20%22options%3A%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20%22%5Bl%5Dist%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20%22%5Be%5Dxtract%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20%22%5Ba%5Drchive%22%3B%0A%0A%20%20%20%20static%20ArrayList%3CIndexEntry%3E%20index%20%3D%20null%3B%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20the%20application%20entry%20point%0A%20%20%20%20%20*%20%40param%20args%20(command%20line)%20parameters%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20check%20command%20line%20arguments%0A%20%20%20%20%20%20%20%20if%20(args.length%20!%3D%203)%20error(USAGE)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20if%20(%22l%22.equals(args%5B0%5D.trim()))%20%7B%20%2F%2F%20extract%20files%20from%20archive%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20String%20srcPath%20%3D%20args%5B1%5D.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20String%20dstPath%20%3D%20args%5B2%5D.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(srcPath.length()%20%3D%3D%200)%20error(%222nd%20argument%20not%20exist.%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(dstPath.length()%20%3D%3D%200)%20error(%223rd%20argument%20not%20exist.%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20listFiles(srcPath%2C%20dstPath)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(%22e%22.equals(args%5B0%5D.trim()))%20%7B%20%2F%2F%20extract%20files%20from%20archive%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20String%20srcPath%20%3D%20args%5B1%5D.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20String%20dstPath%20%3D%20args%5B2%5D.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(srcPath.length()%20%3D%3D%200)%20error(%222nd%20argument%20not%20exist.%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(dstPath.length()%20%3D%3D%200)%20error(%223rd%20argument%20not%20exist.%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20extractFiles(srcPath%2C%20dstPath)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(%22a%22.equals(args%5B0%5D.trim()))%20%7B%20%2F%2F%20pack%20files%20into%20archive%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20String%20srcPath%20%3D%20args%5B1%5D.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20String%20dstPath%20%3D%20args%5B2%5D.trim()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(srcPath.length()%20%3D%3D%200)%20error(%222nd%20argument%20not%20exist.%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(dstPath.length()%20%3D%3D%200)%20error(%223rd%20argument%20not%20exist.%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20packFiles(srcPath%2C%20dstPath)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%7D%20else%20error(USAGE)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20void%20listFiles(String%20srcFile%2C%20String%20listFile)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20open%20source%20archive%0A%20%20%20%20%20%20%20%20File%20arc%20%3D%20new%20File(srcFile)%3B%0A%20%20%20%20%20%20%20%20if%20(!arc.exists())%20error(%22Archive%20%22%20%2B%20srcFile%20%2B%20%22%20doesn't%20exist%22)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20long%20contentOfs%20%3D%20-1L%3B%0A%20%20%20%20%20%20%20%20FileInputStream%20fis%20%3D%20new%20FileInputStream(arc)%3B%0A%20%20%20%20%20%20%20%20DataInputStream%20dis%20%3D%20new%20DataInputStream(fis)%3B%0A%20%20%20%20%20%20%20%20index%20%3D%20new%20ArrayList%3CIndexEntry%3E()%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20match%20archive%20IDENTIFIER%0A%20%20%20%20%20%20%20%20int%20id%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20if%20(IDENTIFIER%20!%3D%20id)%20error(%22Archive%20file%20not%20supported.%20Unexpected%20identifier%200x%22%20%2B%20Integer.toHexString(id).toUpperCase())%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20match%20archive%20version%0A%20%20%20%20%20%20%20%20int%20ver%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20if%20(VERSION%20!%3D%20ver)%20error(%22Archive%20file%20not%20supported.%20Unexpected%20version.%22)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20match%20file%20size%0A%20%20%20%20%20%20%20%20int%20fsize%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20if%20((int)(arc.length())%20!%3D%20fsize)%20error(%22Archive%20file%20not%20supported.%20Unexpected%20file%20size.%22)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20probable%20checksum%0A%20%20%20%20%20%20%20%20int%20checksum%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20%2F%2F%20if%20(checksum(arc)%20!%3D%20checksum))%20error(%22Archive%20file%20not%20supported.%20Unexpected%20checksum.%22)%3B%0A%20%20%20%20%20%20%20%20System.err.println(%22CHECKSUM%3A%200x%22%20%2B%20Integer.toHexString(checksum).toUpperCase())%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20read%20index%20entries%0A%20%20%20%20%20%20%20%20byte%5B%5D%20nameBuf%20%3D%20readIndexBlock(fis)%3B%0A%20%20%20%20%20%20%20%20byte%5B%5D%20infoBuf%20%3D%20readIndexBlock(fis)%3B%0A%20%20%20%20%20%20%20%20parseIndex(nameBuf%2C%20infoBuf)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20extract%20files%0A%20%20%20%20%20%20%20%20int%20baseOfs%20%3D%20(int)(fis.getChannel().position())%3B%20%2F%2F%20check%20this%2C%20might%20not%20be%20correct%0A%20%20%20%20%20%20%20%20PrintStream%20out%20%3D%20new%20PrintStream(new%20FileOutputStream(listFile))%3B%0A%20%20%20%20%20%20%20%20System.setOut(out)%3B%20%2F%2F%20stdout%20redirection%0A%20%20%20%20%20%20%20%20for%20(IndexEntry%20entry%20%3A%20index)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20print%20file%20info%0A%20%20%20%20%20%20%20%20%20%20%20%20printFileInfo(entry%2C%20baseOfs)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20void%20extractFiles(String%20srcFile%2C%20String%20dstDir)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20open%20source%20archive%0A%20%20%20%20%20%20%20%20File%20arc%20%3D%20new%20File(srcFile)%3B%0A%20%20%20%20%20%20%20%20if%20(!arc.exists())%20error(%22Archive%20%22%20%2B%20srcFile%20%2B%20%22%20doesn't%20exist%22)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20long%20contentOfs%20%3D%20-1L%3B%0A%20%20%20%20%20%20%20%20FileInputStream%20fis%20%3D%20new%20FileInputStream(arc)%3B%0A%20%20%20%20%20%20%20%20DataInputStream%20dis%20%3D%20new%20DataInputStream(fis)%3B%0A%20%20%20%20%20%20%20%20index%20%3D%20new%20ArrayList%3CIndexEntry%3E()%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20match%20archive%20IDENTIFIER%0A%20%20%20%20%20%20%20%20int%20id%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20if%20(IDENTIFIER%20!%3D%20id)%20error(%22Archive%20file%20not%20supported.%20Unexpected%20identifier%200x%22%20%2B%20Integer.toHexString(id).toUpperCase())%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20match%20archive%20version%0A%20%20%20%20%20%20%20%20int%20ver%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20if%20(VERSION%20!%3D%20ver)%20error(%22Archive%20file%20not%20supported.%20Unexpected%20version.%22)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20match%20file%20size%0A%20%20%20%20%20%20%20%20int%20fsize%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20if%20((int)(arc.length())%20!%3D%20fsize)%20error(%22Archive%20file%20not%20supported.%20Unexpected%20file%20size.%22)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20probable%20checksum%0A%20%20%20%20%20%20%20%20int%20checksum%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20%2F%2F%20if%20(checksum(arc)%20!%3D%20checksum))%20error(%22Archive%20file%20not%20supported.%20Unexpected%20checksum.%22)%3B%0A%20%20%20%20%20%20%20%20System.err.println(%22CHECKSUM%3A%200x%22%20%2B%20Integer.toHexString(checksum).toUpperCase())%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20read%20index%20entries%0A%20%20%20%20%20%20%20%20byte%5B%5D%20nameBuf%20%3D%20readIndexBlock(fis)%3B%0A%20%20%20%20%20%20%20%20byte%5B%5D%20infoBuf%20%3D%20readIndexBlock(fis)%3B%0A%20%20%20%20%20%20%20%20parseIndex(nameBuf%2C%20infoBuf)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20extract%20files%0A%20%20%20%20%20%20%20%20int%20baseOfs%20%3D%20(int)(fis.getChannel().position())%3B%20%2F%2F%20check%20this%2C%20might%20not%20be%20correct%0A%20%20%20%20%20%20%20%20for%20(IndexEntry%20entry%20%3A%20index)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20print%20file%20info%0A%20%20%20%20%20%20%20%20%20%20%20%20printFileInfo(entry%2C%20baseOfs)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20data%20correctness%20check%20-%20this%20support%20ordered%20file%20archive%20only%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20to%20support%20out-of-order%20archives%2C%20use%20RandomAccessFile%20instead.%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20((int)(fis.getChannel().position())%20!%3D%20entry.getOffset()%20%2B%20baseOfs)%20%7B%0A%2F%2F%20%20%20%20%20%20%20%20%20%20%20%20%20%20error(%22Bad%20file%20content%20order%20%22%0A%2F%2F%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20entry.getFilename()%20%2B%20%22%20%40%200x%22%0A%2F%2F%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20Integer.toHexString((int)(fis.getChannel().position())))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20System.err.println(%22Out-of-order.%20%22%20%2B%20entry.getFilename()%20%2B%20%22%20%40%200x%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20Integer.toHexString((int)(fis.getChannel().position())))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fis.getChannel().position(entry.getOffset()%20%2B%20baseOfs)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20get%20buffer%20and%20read%20file%0A%20%20%20%20%20%20%20%20%20%20%20%20byte%5B%5D%20writeBuf%20%3D%20readBlock(fis%2C%20entry.getLength()%2C%20entry.getFlags()%2C%20entry.getOrigLength())%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20write%20file%0A%20%20%20%20%20%20%20%20%20%20%20%20writeFile(writeBuf%2C%20entry.getFilename()%2C%20dstDir)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20fis.close()%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20void%20packFiles(String%20srcDir%2C%20String%20dstFile)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20TODO%0A%20%20%20%20%20%20%20%20%2F%2F%20not%20implemented%20yet%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20void%20parseIndex(byte%5B%5D%20nameBuf%2C%20byte%5B%5D%20infoBuf)%20throws%20IOException%20%7B%0A%20%20%20%20%20%20%20%20DataInputStream%20dis%20%3D%20new%20DataInputStream(%0A%20%20%20%20%20%20%20%20%20%20%20%20new%20ByteArrayInputStream(infoBuf))%3B%0A%20%20%20%20%20%20%20%20int%20blockCount%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20PROBLEM%201%0A%20%20%20%20%20%20%20%20%2F%2F%20This%20is%20where%20my%20program%20doesn't%20go%20compatible%20with%20the%20image.arc%0A%20%20%20%20%20%20%20%20%2F%2F%20and%20sound.arc%20files.%20Their%20blockCount%20is%202.%20The%201st%20block%20seem%0A%20%20%20%20%20%20%20%20%2F%2F%20to%20be%20the%20same%20as%20string.arc%20and%20script.arc%2C%20but%20the%202nd%20block%20is%20severely%0A%20%20%20%20%20%20%20%20%2F%2F%20obsfucated%20that%20I%20don't%20know%20what%20the%20program%20is%20doing.%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2F%2F%20if%20(blockCount%20!%3D%201)%20error(%22Archive%20not%20supported.%20BlockCount%20is%20%22%20%2B%20blockCount)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20blockCount%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20int%20reserved1%20%3D%20flipEndian(dis.readInt())%3B%20%2F%2F%20unknown%20usage%0A%20%20%20%20%20%20%20%20%20%20%20%20int%20reserved2%20%3D%20flipEndian(dis.readInt())%3B%20%2F%2F%20not%20used%0A%20%20%20%20%20%20%20%20%20%20%20%20int%20entryCount%20%3D%20flipEndian(dis.readInt())%3B%20%2F%2F%20entry%20count%20in%20current%20block%0A%20%20%20%20%20%20%20%20%20%20%20%20int%20blockSize%20%3D%20flipEndian(dis.readInt())%3B%20%2F%2F%20current%20block%20size%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20System.err.println(Arrays.toString(nameBuf))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20System.err.println(%22reserved1%3A%20%22%20%2B%20reserved1)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20System.err.println(%22reserved2%3A%20%22%20%2B%20reserved2)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20System.err.println(%22entry%20count%3A%20%22%20%2B%20entryCount)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20System.err.println(%22block%20size%3A%20%22%20%2B%20blockSize)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PROBLEM%202%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20if%20(4%20*%205%20*%20entryCount%20!%3D%20blockSize)%20error(%22Index%20error.%20Wrong%20block%20size.%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%20%2B%20%22Count%3D%22%20%2B%20entryCount%20%2B%20%22%20BlockSize%3D%22%20%2B%20blockSize)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20int%5B%5D%20nameOfs%20%3D%20new%20int%5BentryCount%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(int%20j%20%3D%200%3B%20j%20%3C%20entryCount%3B%20%2B%2Bj)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nameOfs%5Bj%5D%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(int%20j%20%3D%200%3B%20j%20%3C%20entryCount%3B%20%2B%2Bj)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20IndexEntry%20entry%20%3D%20new%20IndexEntry()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20entry.setFilename(readWString(nameBuf%2C%20nameOfs%5Bj%5D))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20entry.setOffset(flipEndian(dis.readInt()))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20entry.setLength(flipEndian(dis.readInt())%20-%2012)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20entry.setFlags(flipEndian(dis.readInt()))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20entry.setOrigLength(flipEndian(dis.readInt()))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20index.add(entry)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20int%20flipEndian(int%20i)%20%7B%0A%20%20%20%20%20%20%20%20byte%5B%5D%20bytes%20%3D%20new%20byte%5B4%5D%3B%0A%20%20%20%20%20%20%20%20bytes%5B0%5D%20%3D%20(byte)(i%20%3E%3E%3E%2024)%3B%0A%20%20%20%20%20%20%20%20bytes%5B1%5D%20%3D%20(byte)(i%20%3E%3E%3E%2016)%3B%0A%20%20%20%20%20%20%20%20bytes%5B2%5D%20%3D%20(byte)(i%20%3E%3E%3E%208)%3B%0A%20%20%20%20%20%20%20%20bytes%5B3%5D%20%3D%20(byte)%20i%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20i%20%20%3D%20%20bytes%5B3%5D%20%3C%3C%2024%3B%0A%20%20%20%20%20%20%20%20i%20%7C%3D%20(bytes%5B2%5D%20%3C%3C%2016)%20%26%200x0ff0000%3B%0A%20%20%20%20%20%20%20%20i%20%7C%3D%20(bytes%5B1%5D%20%3C%3C%20%208)%20%26%200x000ff00%3B%0A%20%20%20%20%20%20%20%20i%20%7C%3D%20%20bytes%5B0%5D%20%20%20%20%20%20%20%20%26%200x00000ff%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20return%20i%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20void%20invertBitsArray(byte%5B%5D%20arr)%20%7B%0A%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20arr.length%3B%20%2B%2Bi)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20arr%5Bi%5D%20%3D%20(byte)~arr%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20private%20static%20void%20error(String%20cause)%20%7B%0A%20%20%20%20%20%20%20%20System.err.println(%22Error%20%22%20%2B%20cause)%3B%0A%20%20%20%20%20%20%20%20System.exit(1)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20void%20printFileInfo(IndexEntry%20entry%2C%20int%20baseOfs)%20%7B%0A%20%20%20%20%20%20%20%20System.out.print(%22File%20%22%20%2B%20entry.getFilename())%3B%0A%20%20%20%20%20%20%20%20System.out.print(%22%20%40%200x%22%20%2B%20Integer.toHexString(entry.getOffset()%20%2B%20baseOfs).toUpperCase())%3B%0A%20%20%20%20%20%20%20%20System.out.print(%22%20size%3A%200x%22%20%2B%20Integer.toHexString(entry.getLength()).toUpperCase())%3B%0A%20%20%20%20%20%20%20%20System.out.println(%22%20origSize%3A%200x%22%20%2B%20Integer.toHexString(entry.getOrigLength()).toUpperCase())%3B%0A%20%20%20%20%20%20%20%20System.out.print(%22Masks%3A%20%22)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20boolean%20doPrint%20%3D%20(entry.getFlags()%20%7C%20NOT_MSK)%20!%3D%200%3B%0A%20%20%20%20%20%20%20%20if%20(doPrint)%20System.out.print(%22NOT_MSK%22)%3B%0A%20%20%20%20%20%20%20%20if%20((entry.getFlags()%20%7C%20LZSS_MSK)%20!%3D%200%20%26%26%20doPrint)%20System.out.print(%22%20%7C%20%22)%3B%0A%20%20%20%20%20%20%20%20else%20System.out.println()%3B%0A%20%20%20%20%20%20%20%20if%20((entry.getFlags()%20%7C%20LZSS_MSK)%20!%3D%200)%20System.out.println(%22LZSS_MSK%22)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20byte%5B%5D%20readIndexBlock(InputStream%20in)%20throws%20IOException%20%7B%0A%20%20%20%20%20%20%20%20DataInputStream%20dis%20%3D%20new%20DataInputStream(in)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20int%20len%20%3D%20flipEndian(dis.readInt())%20-%2012%3B%0A%20%20%20%20%20%20%20%20int%20flags%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20int%20origLen%20%3D%20flipEndian(dis.readInt())%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20return%20readBlock(in%2C%20len%2C%20flags%2C%20origLen)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20byte%5B%5D%20readBlock(InputStream%20in%2C%20int%20len%2C%20int%20flags%2C%20int%20origLen)%20throws%20IOException%20%7B%0A%20%20%20%20%20%20%20%20byte%5B%5D%20buf%20%3D%20new%20byte%5Blen%5D%3B%0A%20%20%20%20%20%20%20%20in.read(buf)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20if%20((flags%20%7C%20NOT_MSK)%20!%3D%200)%20invertBitsArray(buf)%3B%0A%20%20%20%20%20%20%20%20if%20(((flags%20%7C%20LZSS_MSK)%20!%3D%200)%20%26%26%20(len%20%3C%20origLen))%20buf%20%3D%20LZSS.decompress(buf%2C%20len%2C%20null%2C%20origLen)%3B%0A%20%20%20%20%20%20%20%20%2F%2F%20TODO%20-%20other%20flag%20status%20are%20not%20supported%20yet%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20return%20buf%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20String%20readWString(byte%5B%5D%20buf%2C%20int%20pos)%20throws%20IOException%20%7B%0A%20%20%20%20%20%20%20%20int%20len%20%3D%200%3B%0A%20%20%20%20%20%20%20%20int%20i%20%3D%20pos%3B%0A%20%20%20%20%20%20%20%20while%20((buf%5Bi%5D%20%7C%20buf%5Bi%2B1%5D)%20!%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20len%20%2B%3D%202%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20i%20%2B%3D%202%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20return%20new%20String(buf%2C%20pos%2C%20len%2C%20%22UTF-16LE%22)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20private%20static%20void%20writeFile(byte%5B%5D%20buf%2C%20String%20name%2C%20String%20dstDir)%20throws%20IOException%20%7B%0A%20%20%20%20%20%20%20%20if%20(dstDir%20%3D%3D%20null)%20dstDir%20%3D%20%22.%2Foutput%22%3B%0A%20%20%20%20%20%20%20%20File%20outfile%20%3D%20new%20File(dstDir%20%2B%20%22%2F%22%20%2B%20name)%3B%0A%20%20%20%20%20%20%20%20File%20parentDir%20%3D%20outfile.getParentFile()%3B%0A%20%20%20%20%20%20%20%20if%20(!parentDir.exists())%20parentDir.mkdirs()%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20FileOutputStream%20fos%20%3D%20new%20FileOutputStream(outfile)%3B%0A%20%20%20%20%20%20%20%20BufferedOutputStream%20bos%20%3D%20new%20BufferedOutputStream(fos%2C%200x100000)%3B%0A%20%20%20%20%20%20%20%20ByteArrayInputStream%20bais%20%3D%20new%20ByteArrayInputStream(buf)%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20int%20remainder%20%3D%20buf.length%3B%20%2F%2F%20keep%20track%20of%20the%20amount%20of%20remaining%20bytes%0A%20%20%20%20%20%20%20%20byte%5B%5D%20bytes16%20%3D%20new%20byte%5B16%5D%3B%0A%20%20%20%20%20%20%20%20while%20(bais.available()%20!%3D%200%20%26%26%20remainder%20%2F%2016%20!%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20bais.read(bytes16)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20bos.write(bytes16)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20remainder%20-%3D%2016%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20if%20(remainder%20!%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20byte%5B%5D%20remains%20%3D%20new%20byte%5Bremainder%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20bais.read(remains)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20bos.write(remains)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20bos.flush()%3B%0A%20%20%20%20%20%20%20%20bos.close()%3B%0A%20%20%20%20%7D%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="star" src="assets/1571225637-bf632ec55a05f69a9359f73417402b26.png" alt="收藏代码"><img class="spinner" src="assets/1571225637-a42df3a5b569bdc98ca473a4a3adfeac.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="comment">/*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@(#)Archiver.java&nbsp;&nbsp;2007/05/15</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;Written&nbsp;by&nbsp;rednaxela&nbsp;/&nbsp;FX</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">import</span><span>&nbsp;java.io.*;&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">import</span><span>&nbsp;java.util.*;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="comment">/*</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">Data&nbsp;structures:</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">//--------------------------------</span>&nbsp;</span></li><li><span><span class="comment">typedef&nbsp;struct&nbsp;tagHEADER&nbsp;{</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;IDENTIFIER,&nbsp;BE&nbsp;AD&nbsp;CA&nbsp;A8,&nbsp;little-endian&nbsp;("ARCW"&nbsp;xor&nbsp;0xFF)</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;ver;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;VERSION,&nbsp;locked&nbsp;to&nbsp;0x00</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;fileSize;&nbsp;//&nbsp;total&nbsp;size&nbsp;of&nbsp;current&nbsp;archive</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;data_offset;&nbsp;&nbsp;//&nbsp;begin&nbsp;offset&nbsp;of&nbsp;file&nbsp;data</span>&nbsp;</span></li><li><span><span class="comment">}&nbsp;HEADER;&nbsp;//&nbsp;16&nbsp;bytes</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">typedef&nbsp;struct&nbsp;tagSECINFO&nbsp;{</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;sectionLength;&nbsp;//&nbsp;sectionLength&nbsp;=&nbsp;len(SECINFO)(=0x0C)&nbsp;+&nbsp;len(SECDATA)</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;flags;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;flags:&nbsp;NOT_MSK&nbsp;=&nbsp;1,&nbsp;LZSS_MSK&nbsp;=&nbsp;2</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;origSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;original&nbsp;size&nbsp;of&nbsp;SECDATA&nbsp;after&nbsp;inflation</span>&nbsp;</span></li><li><span><span class="comment">}&nbsp;SECINFO;&nbsp;//&nbsp;12&nbsp;bytes</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">typedef&nbsp;struct&nbsp;tagSECDATA&nbsp;{</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;BYTE&nbsp;data[SECINFO.sectionLength&nbsp;-&nbsp;12];</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;when&nbsp;SECINFO.flags&nbsp;=&nbsp;NOT_MSK&nbsp;|&nbsp;LZSS_MSK,&nbsp;the&nbsp;contents&nbsp;is&nbsp;both&nbsp;encrypted&nbsp;by&nbsp;NOT</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;and&nbsp;compressed&nbsp;by&nbsp;LZSS.</span>&nbsp;</span></li><li><span><span class="comment">}&nbsp;SECDATA;</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">struct&nbsp;INDEXBLOCK1&nbsp;{</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;INDEXENTRY&nbsp;{</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;offset;&nbsp;//&nbsp;actualOfs&nbsp;=&nbsp;offset&nbsp;+&nbsp;totalHeaderLength&nbsp;-&nbsp;0x0C</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;length;&nbsp;//&nbsp;length&nbsp;in&nbsp;archive</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;flags;&nbsp;&nbsp;//&nbsp;NOT_MSK&nbsp;=&nbsp;1,&nbsp;LZSS_MSK&nbsp;=&nbsp;2</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;origLen;&nbsp;//&nbsp;original&nbsp;file&nbsp;length</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;};</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;reserved1;&nbsp;&nbsp;&nbsp;//&nbsp;some&nbsp;sort&nbsp;of&nbsp;flag&nbsp;I&nbsp;guess</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;reserved2;&nbsp;&nbsp;&nbsp;//&nbsp;seems&nbsp;to&nbsp;be&nbsp;always&nbsp;zero</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;entryCount;&nbsp;&nbsp;//&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;this&nbsp;block</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;blockLength;&nbsp;//&nbsp;length&nbsp;of&nbsp;the&nbsp;remaining&nbsp;part&nbsp;of&nbsp;this&nbsp;block</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;nameOffset[entryCount];&nbsp;//&nbsp;offset&nbsp;relative&nbsp;to&nbsp;nameSecData&nbsp;after&nbsp;decode&nbsp;and&nbsp;decompression</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;INDEXENTRY&nbsp;entry[entryCount];&nbsp;//&nbsp;TOC&nbsp;entrys</span>&nbsp;</span></li><li><span><span class="comment">};</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">struct&nbsp;INDEXBLOCK2&nbsp;{</span>&nbsp;</span></li><li><span><span class="comment">};&nbsp;//&nbsp;structure&nbsp;is&nbsp;unknown</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">//--------------------------------</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">arc&nbsp;file:</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">HEADER&nbsp;header;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;1&nbsp;header&nbsp;per&nbsp;archive</span>&nbsp;</span></li><li><span><span class="comment">SECINFO&nbsp;nameSecInfo;&nbsp;//&nbsp;1st&nbsp;of&nbsp;SECINFO&nbsp;in&nbsp;archive</span>&nbsp;</span></li><li><span><span class="comment">SECDATA&nbsp;nameSecData;&nbsp;//&nbsp;1st&nbsp;of&nbsp;SECDATA&nbsp;in&nbsp;archive,&nbsp;contents&nbsp;of&nbsp;which&nbsp;are&nbsp;filenames&nbsp;in&nbsp;UNICODE</span>&nbsp;</span></li><li><span><span class="comment">SECINFO&nbsp;indexSecInfo;&nbsp;//&nbsp;2nd&nbsp;of&nbsp;SECINFO&nbsp;in&nbsp;archive</span>&nbsp;</span></li><li><span><span class="comment">SECDATA&nbsp;indexSecData;&nbsp;//&nbsp;2nd&nbsp;of&nbsp;SECDATA&nbsp;in&nbsp;archive,&nbsp;contents&nbsp;of&nbsp;which&nbsp;indicates&nbsp;offset,&nbsp;length,&nbsp;flag&nbsp;info&nbsp;of&nbsp;file&nbsp;data.</span>&nbsp;</span></li><li><span><span class="comment">bytes&nbsp;data[];&nbsp;//&nbsp;remaining&nbsp;part&nbsp;of&nbsp;archive,&nbsp;which&nbsp;is&nbsp;file&nbsp;data</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">//--------------------------------</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">indexSecData&nbsp;after&nbsp;decode&nbsp;and&nbsp;decompression:</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">DWORD&nbsp;blockCount;</span>&nbsp;</span></li><li><span><span class="comment">INDEXBLOCK1&nbsp;block1;</span>&nbsp;</span></li><li><span><span class="comment">//&nbsp;INDEXBLOCK2&nbsp;block2;&nbsp;//&nbsp;this&nbsp;is&nbsp;where&nbsp;I've&nbsp;got&nbsp;trouble&nbsp;figuring&nbsp;out.</span>&nbsp;</span></li><li><span><span class="comment"></span>&nbsp;</span></li><li><span><span class="comment">*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;Demonstrating&nbsp;archive&nbsp;operations&nbsp;on&nbsp;*.arc&nbsp;files&nbsp;as&nbsp;seen&nbsp;in&nbsp;Ketai-s.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;Archiver&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;IDENTIFIER&nbsp;=&nbsp;</span><span class="number">0xA8BCADBE</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;VERSION&nbsp;=&nbsp;</span><span class="number">0x00</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;NOT_MSK&nbsp;=&nbsp;</span><span class="number">1</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;LZSS_MSK&nbsp;=&nbsp;</span><span class="number">2</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;String&nbsp;USAGE&nbsp;=&nbsp;</span><span class="string">"Usage:&nbsp;java&nbsp;Archiver&nbsp;[option]&nbsp;srcPath&nbsp;dstPath\n"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="string">"options:\n"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="string">"[l]ist\n"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="string">"[e]xtract\n"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="string">"[a]rchive"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;ArrayList&lt;IndexEntry&gt;&nbsp;index&nbsp;=&nbsp;</span><span class="keyword">null</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;application&nbsp;entry&nbsp;point</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;args&nbsp;(command&nbsp;line)&nbsp;parameters</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;main(String[]&nbsp;args)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;check&nbsp;command&nbsp;line&nbsp;arguments</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(args.length&nbsp;!=&nbsp;</span><span class="number">3</span><span>)&nbsp;error(USAGE);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(</span><span class="string">"l"</span><span>.equals(args[</span><span class="number">0</span><span>].trim()))&nbsp;{&nbsp;</span><span class="comment">//&nbsp;extract&nbsp;files&nbsp;from&nbsp;archive</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;srcPath&nbsp;=&nbsp;args[<span class="number">1</span><span>].trim();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;dstPath&nbsp;=&nbsp;args[<span class="number">2</span><span>].trim();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(srcPath.length()&nbsp;==&nbsp;</span><span class="number">0</span><span>)&nbsp;error(</span><span class="string">"2nd&nbsp;argument&nbsp;not&nbsp;exist."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(dstPath.length()&nbsp;==&nbsp;</span><span class="number">0</span><span>)&nbsp;error(</span><span class="string">"3rd&nbsp;argument&nbsp;not&nbsp;exist."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listFiles(srcPath,&nbsp;dstPath);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span><span>&nbsp;</span><span class="keyword">if</span><span>&nbsp;(</span><span class="string">"e"</span><span>.equals(args[</span><span class="number">0</span><span>].trim()))&nbsp;{&nbsp;</span><span class="comment">//&nbsp;extract&nbsp;files&nbsp;from&nbsp;archive</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;srcPath&nbsp;=&nbsp;args[<span class="number">1</span><span>].trim();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;dstPath&nbsp;=&nbsp;args[<span class="number">2</span><span>].trim();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(srcPath.length()&nbsp;==&nbsp;</span><span class="number">0</span><span>)&nbsp;error(</span><span class="string">"2nd&nbsp;argument&nbsp;not&nbsp;exist."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(dstPath.length()&nbsp;==&nbsp;</span><span class="number">0</span><span>)&nbsp;error(</span><span class="string">"3rd&nbsp;argument&nbsp;not&nbsp;exist."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extractFiles(srcPath,&nbsp;dstPath);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span><span>&nbsp;</span><span class="keyword">if</span><span>&nbsp;(</span><span class="string">"a"</span><span>.equals(args[</span><span class="number">0</span><span>].trim()))&nbsp;{&nbsp;</span><span class="comment">//&nbsp;pack&nbsp;files&nbsp;into&nbsp;archive</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;srcPath&nbsp;=&nbsp;args[<span class="number">1</span><span>].trim();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;dstPath&nbsp;=&nbsp;args[<span class="number">2</span><span>].trim();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(srcPath.length()&nbsp;==&nbsp;</span><span class="number">0</span><span>)&nbsp;error(</span><span class="string">"2nd&nbsp;argument&nbsp;not&nbsp;exist."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(dstPath.length()&nbsp;==&nbsp;</span><span class="number">0</span><span>)&nbsp;error(</span><span class="string">"3rd&nbsp;argument&nbsp;not&nbsp;exist."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;packFiles(srcPath,&nbsp;dstPath);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span><span>&nbsp;error(USAGE);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;listFiles(String&nbsp;srcFile,&nbsp;String&nbsp;listFile)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;open&nbsp;source&nbsp;archive</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;arc&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;File(srcFile);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(!arc.exists())&nbsp;error(</span><span class="string">"Archive&nbsp;"</span><span>&nbsp;+&nbsp;srcFile&nbsp;+&nbsp;</span><span class="string">"&nbsp;doesn't&nbsp;exist"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">long</span><span>&nbsp;contentOfs&nbsp;=&nbsp;-1L;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileInputStream&nbsp;fis&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;FileInputStream(arc);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataInputStream&nbsp;dis&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;DataInputStream(fis);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;ArrayList&lt;IndexEntry&gt;();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;match&nbsp;archive&nbsp;IDENTIFIER</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;id&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(IDENTIFIER&nbsp;!=&nbsp;id)&nbsp;error(</span><span class="string">"Archive&nbsp;file&nbsp;not&nbsp;supported.&nbsp;Unexpected&nbsp;identifier&nbsp;0x"</span><span>&nbsp;+&nbsp;Integer.toHexString(id).toUpperCase());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;match&nbsp;archive&nbsp;version</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ver&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(VERSION&nbsp;!=&nbsp;ver)&nbsp;error(</span><span class="string">"Archive&nbsp;file&nbsp;not&nbsp;supported.&nbsp;Unexpected&nbsp;version."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;match&nbsp;file&nbsp;size</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;fsize&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((</span><span class="keyword">int</span><span>)(arc.length())&nbsp;!=&nbsp;fsize)&nbsp;error(</span><span class="string">"Archive&nbsp;file&nbsp;not&nbsp;supported.&nbsp;Unexpected&nbsp;file&nbsp;size."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;probable&nbsp;checksum</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;checksum&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;if&nbsp;(checksum(arc)&nbsp;!=&nbsp;checksum))&nbsp;error("Archive&nbsp;file&nbsp;not&nbsp;supported.&nbsp;Unexpected&nbsp;checksum.");</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(<span class="string">"CHECKSUM:&nbsp;0x"</span><span>&nbsp;+&nbsp;Integer.toHexString(checksum).toUpperCase());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;read&nbsp;index&nbsp;entries</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;nameBuf&nbsp;=&nbsp;readIndexBlock(fis);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;infoBuf&nbsp;=&nbsp;readIndexBlock(fis);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parseIndex(nameBuf,&nbsp;infoBuf);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;extract&nbsp;files</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;baseOfs&nbsp;=&nbsp;(</span><span class="keyword">int</span><span>)(fis.getChannel().position());&nbsp;</span><span class="comment">//&nbsp;check&nbsp;this,&nbsp;might&nbsp;not&nbsp;be&nbsp;correct</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintStream&nbsp;out&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;PrintStream(</span><span class="keyword">new</span><span>&nbsp;FileOutputStream(listFile));&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.setOut(out);&nbsp;<span class="comment">//&nbsp;stdout&nbsp;redirection</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(IndexEntry&nbsp;entry&nbsp;:&nbsp;index)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;print&nbsp;file&nbsp;info</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printFileInfo(entry,&nbsp;baseOfs);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;extractFiles(String&nbsp;srcFile,&nbsp;String&nbsp;dstDir)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;open&nbsp;source&nbsp;archive</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;arc&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;File(srcFile);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(!arc.exists())&nbsp;error(</span><span class="string">"Archive&nbsp;"</span><span>&nbsp;+&nbsp;srcFile&nbsp;+&nbsp;</span><span class="string">"&nbsp;doesn't&nbsp;exist"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">long</span><span>&nbsp;contentOfs&nbsp;=&nbsp;-1L;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileInputStream&nbsp;fis&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;FileInputStream(arc);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataInputStream&nbsp;dis&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;DataInputStream(fis);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;ArrayList&lt;IndexEntry&gt;();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;match&nbsp;archive&nbsp;IDENTIFIER</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;id&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(IDENTIFIER&nbsp;!=&nbsp;id)&nbsp;error(</span><span class="string">"Archive&nbsp;file&nbsp;not&nbsp;supported.&nbsp;Unexpected&nbsp;identifier&nbsp;0x"</span><span>&nbsp;+&nbsp;Integer.toHexString(id).toUpperCase());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;match&nbsp;archive&nbsp;version</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ver&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(VERSION&nbsp;!=&nbsp;ver)&nbsp;error(</span><span class="string">"Archive&nbsp;file&nbsp;not&nbsp;supported.&nbsp;Unexpected&nbsp;version."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;match&nbsp;file&nbsp;size</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;fsize&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((</span><span class="keyword">int</span><span>)(arc.length())&nbsp;!=&nbsp;fsize)&nbsp;error(</span><span class="string">"Archive&nbsp;file&nbsp;not&nbsp;supported.&nbsp;Unexpected&nbsp;file&nbsp;size."</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;probable&nbsp;checksum</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;checksum&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;if&nbsp;(checksum(arc)&nbsp;!=&nbsp;checksum))&nbsp;error("Archive&nbsp;file&nbsp;not&nbsp;supported.&nbsp;Unexpected&nbsp;checksum.");</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(<span class="string">"CHECKSUM:&nbsp;0x"</span><span>&nbsp;+&nbsp;Integer.toHexString(checksum).toUpperCase());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;read&nbsp;index&nbsp;entries</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;nameBuf&nbsp;=&nbsp;readIndexBlock(fis);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;infoBuf&nbsp;=&nbsp;readIndexBlock(fis);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parseIndex(nameBuf,&nbsp;infoBuf);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;extract&nbsp;files</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;baseOfs&nbsp;=&nbsp;(</span><span class="keyword">int</span><span>)(fis.getChannel().position());&nbsp;</span><span class="comment">//&nbsp;check&nbsp;this,&nbsp;might&nbsp;not&nbsp;be&nbsp;correct</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(IndexEntry&nbsp;entry&nbsp;:&nbsp;index)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;print&nbsp;file&nbsp;info</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printFileInfo(entry,&nbsp;baseOfs);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;data&nbsp;correctness&nbsp;check&nbsp;-&nbsp;this&nbsp;support&nbsp;ordered&nbsp;file&nbsp;archive&nbsp;only</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;to&nbsp;support&nbsp;out-of-order&nbsp;archives,&nbsp;use&nbsp;RandomAccessFile&nbsp;instead.</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((</span><span class="keyword">int</span><span>)(fis.getChannel().position())&nbsp;!=&nbsp;entry.getOffset()&nbsp;+&nbsp;baseOfs)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error("Bad&nbsp;file&nbsp;content&nbsp;order&nbsp;"</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;entry.getFilename()&nbsp;+&nbsp;"&nbsp;@&nbsp;0x"</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;Integer.toHexString((int)(fis.getChannel().position())));</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(<span class="string">"Out-of-order.&nbsp;"</span><span>&nbsp;+&nbsp;entry.getFilename()&nbsp;+&nbsp;</span><span class="string">"&nbsp;@&nbsp;0x"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;Integer.toHexString((<span class="keyword">int</span><span>)(fis.getChannel().position())));&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fis.getChannel().position(entry.getOffset()&nbsp;+&nbsp;baseOfs);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;get&nbsp;buffer&nbsp;and&nbsp;read&nbsp;file</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;writeBuf&nbsp;=&nbsp;readBlock(fis,&nbsp;entry.getLength(),&nbsp;entry.getFlags(),&nbsp;entry.getOrigLength());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;write&nbsp;file</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writeFile(writeBuf,&nbsp;entry.getFilename(),&nbsp;dstDir);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fis.close();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;packFiles(String&nbsp;srcDir,&nbsp;String&nbsp;dstFile)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;Exception&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;TODO</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;not&nbsp;implemented&nbsp;yet</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;parseIndex(</span><span class="keyword">byte</span><span>[]&nbsp;nameBuf,&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;infoBuf)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;IOException&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataInputStream&nbsp;dis&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;DataInputStream(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">new</span><span>&nbsp;ByteArrayInputStream(infoBuf));&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;blockCount&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;PROBLEM&nbsp;1</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;This&nbsp;is&nbsp;where&nbsp;my&nbsp;program&nbsp;doesn't&nbsp;go&nbsp;compatible&nbsp;with&nbsp;the&nbsp;image.arc</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;and&nbsp;sound.arc&nbsp;files.&nbsp;Their&nbsp;blockCount&nbsp;is&nbsp;2.&nbsp;The&nbsp;1st&nbsp;block&nbsp;seem</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;to&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;string.arc&nbsp;and&nbsp;script.arc,&nbsp;but&nbsp;the&nbsp;2nd&nbsp;block&nbsp;is&nbsp;severely</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;obsfucated&nbsp;that&nbsp;I&nbsp;don't&nbsp;know&nbsp;what&nbsp;the&nbsp;program&nbsp;is&nbsp;doing.</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;if&nbsp;(blockCount&nbsp;!=&nbsp;1)&nbsp;error("Archive&nbsp;not&nbsp;supported.&nbsp;BlockCount&nbsp;is&nbsp;"&nbsp;+&nbsp;blockCount);</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(</span><span class="keyword">int</span><span>&nbsp;i&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;i&nbsp;&lt;&nbsp;blockCount;&nbsp;++i)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;reserved1&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;</span><span class="comment">//&nbsp;unknown&nbsp;usage</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;reserved2&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;</span><span class="comment">//&nbsp;not&nbsp;used</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;entryCount&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;</span><span class="comment">//&nbsp;entry&nbsp;count&nbsp;in&nbsp;current&nbsp;block</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;blockSize&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;</span><span class="comment">//&nbsp;current&nbsp;block&nbsp;size</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;System.err.println(Arrays.toString(nameBuf));</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(<span class="string">"reserved1:&nbsp;"</span><span>&nbsp;+&nbsp;reserved1);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(<span class="string">"reserved2:&nbsp;"</span><span>&nbsp;+&nbsp;reserved2);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(<span class="string">"entry&nbsp;count:&nbsp;"</span><span>&nbsp;+&nbsp;entryCount);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(<span class="string">"block&nbsp;size:&nbsp;"</span><span>&nbsp;+&nbsp;blockSize);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;PROBLEM&nbsp;2</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;if&nbsp;(4&nbsp;*&nbsp;5&nbsp;*&nbsp;entryCount&nbsp;!=&nbsp;blockSize)&nbsp;error("Index&nbsp;error.&nbsp;Wrong&nbsp;block&nbsp;size.\n"</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;&nbsp;+&nbsp;"Count="&nbsp;+&nbsp;entryCount&nbsp;+&nbsp;"&nbsp;BlockSize="&nbsp;+&nbsp;blockSize);</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>[]&nbsp;nameOfs&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;</span><span class="keyword">int</span><span>[entryCount];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(</span><span class="keyword">int</span><span>&nbsp;j&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;j&nbsp;&lt;&nbsp;entryCount;&nbsp;++j)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nameOfs[j]&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(</span><span class="keyword">int</span><span>&nbsp;j&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;j&nbsp;&lt;&nbsp;entryCount;&nbsp;++j)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IndexEntry&nbsp;entry&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;IndexEntry();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entry.setFilename(readWString(nameBuf,&nbsp;nameOfs[j]));&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entry.setOffset(flipEndian(dis.readInt()));&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entry.setLength(flipEndian(dis.readInt())&nbsp;-&nbsp;<span class="number">12</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entry.setFlags(flipEndian(dis.readInt()));&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entry.setOrigLength(flipEndian(dis.readInt()));&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index.add(entry);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;flipEndian(</span><span class="keyword">int</span><span>&nbsp;i)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;bytes&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;</span><span class="keyword">byte</span><span>[</span><span class="number">4</span><span>];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bytes[<span class="number">0</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)(i&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">24</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bytes[<span class="number">1</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)(i&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">16</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bytes[<span class="number">2</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)(i&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">8</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bytes[<span class="number">3</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)&nbsp;i;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;=&nbsp;&nbsp;bytes[<span class="number">3</span><span>]&nbsp;&lt;&lt;&nbsp;</span><span class="number">24</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;|=&nbsp;(bytes[<span class="number">2</span><span>]&nbsp;&lt;&lt;&nbsp;</span><span class="number">16</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff0000</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;|=&nbsp;(bytes[<span class="number">1</span><span>]&nbsp;&lt;&lt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x000ff00</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;|=&nbsp;&nbsp;bytes[<span class="number">0</span><span>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;</span><span class="number">0x00000ff</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;i;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;invertBitsArray(</span><span class="keyword">byte</span><span>[]&nbsp;arr)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(</span><span class="keyword">int</span><span>&nbsp;i&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;i&nbsp;&lt;&nbsp;arr.length;&nbsp;++i)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arr[i]&nbsp;=&nbsp;(<span class="keyword">byte</span><span>)~arr[i];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;error(String&nbsp;cause)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(<span class="string">"Error&nbsp;"</span><span>&nbsp;+&nbsp;cause);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.exit(<span class="number">1</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;printFileInfo(IndexEntry&nbsp;entry,&nbsp;</span><span class="keyword">int</span><span>&nbsp;baseOfs)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="string">"File&nbsp;"</span><span>&nbsp;+&nbsp;entry.getFilename());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="string">"&nbsp;@&nbsp;0x"</span><span>&nbsp;+&nbsp;Integer.toHexString(entry.getOffset()&nbsp;+&nbsp;baseOfs).toUpperCase());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="string">"&nbsp;size:&nbsp;0x"</span><span>&nbsp;+&nbsp;Integer.toHexString(entry.getLength()).toUpperCase());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="string">"&nbsp;origSize:&nbsp;0x"</span><span>&nbsp;+&nbsp;Integer.toHexString(entry.getOrigLength()).toUpperCase());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="string">"Masks:&nbsp;"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">boolean</span><span>&nbsp;doPrint&nbsp;=&nbsp;(entry.getFlags()&nbsp;|&nbsp;NOT_MSK)&nbsp;!=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(doPrint)&nbsp;System.out.print(</span><span class="string">"NOT_MSK"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((entry.getFlags()&nbsp;|&nbsp;LZSS_MSK)&nbsp;!=&nbsp;</span><span class="number">0</span><span>&nbsp;&amp;&amp;&nbsp;doPrint)&nbsp;System.out.print(</span><span class="string">"&nbsp;|&nbsp;"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><span>&nbsp;System.out.println();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((entry.getFlags()&nbsp;|&nbsp;LZSS_MSK)&nbsp;!=&nbsp;</span><span class="number">0</span><span>)&nbsp;System.out.println(</span><span class="string">"LZSS_MSK"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;readIndexBlock(InputStream&nbsp;in)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;IOException&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataInputStream&nbsp;dis&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;DataInputStream(in);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;len&nbsp;=&nbsp;flipEndian(dis.readInt())&nbsp;-&nbsp;</span><span class="number">12</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;flags&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;origLen&nbsp;=&nbsp;flipEndian(dis.readInt());&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;readBlock(in,&nbsp;len,&nbsp;flags,&nbsp;origLen);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;readBlock(InputStream&nbsp;in,&nbsp;</span><span class="keyword">int</span><span>&nbsp;len,&nbsp;</span><span class="keyword">int</span><span>&nbsp;flags,&nbsp;</span><span class="keyword">int</span><span>&nbsp;origLen)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;IOException&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;buf&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;</span><span class="keyword">byte</span><span>[len];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in.read(buf);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((flags&nbsp;|&nbsp;NOT_MSK)&nbsp;!=&nbsp;</span><span class="number">0</span><span>)&nbsp;invertBitsArray(buf);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(((flags&nbsp;|&nbsp;LZSS_MSK)&nbsp;!=&nbsp;</span><span class="number">0</span><span>)&nbsp;&amp;&amp;&nbsp;(len&nbsp;&lt;&nbsp;origLen))&nbsp;buf&nbsp;=&nbsp;LZSS.decompress(buf,&nbsp;len,&nbsp;</span><span class="keyword">null</span><span>,&nbsp;origLen);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;TODO&nbsp;-&nbsp;other&nbsp;flag&nbsp;status&nbsp;are&nbsp;not&nbsp;supported&nbsp;yet</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;buf;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;String&nbsp;readWString(</span><span class="keyword">byte</span><span>[]&nbsp;buf,&nbsp;</span><span class="keyword">int</span><span>&nbsp;pos)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;IOException&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;len&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;i&nbsp;=&nbsp;pos;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;((buf[i]&nbsp;|&nbsp;buf[i+</span><span class="number">1</span><span>])&nbsp;!=&nbsp;</span><span class="number">0</span><span>)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;+=&nbsp;<span class="number">2</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;+=&nbsp;<span class="number">2</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;</span><span class="keyword">new</span><span>&nbsp;String(buf,&nbsp;pos,&nbsp;len,&nbsp;</span><span class="string">"UTF-16LE"</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;writeFile(</span><span class="keyword">byte</span><span>[]&nbsp;buf,&nbsp;String&nbsp;name,&nbsp;String&nbsp;dstDir)&nbsp;</span><span class="keyword">throws</span><span>&nbsp;IOException&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(dstDir&nbsp;==&nbsp;</span><span class="keyword">null</span><span>)&nbsp;dstDir&nbsp;=&nbsp;</span><span class="string">"./output"</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;outfile&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;File(dstDir&nbsp;+&nbsp;</span><span class="string">"/"</span><span>&nbsp;+&nbsp;name);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;parentDir&nbsp;=&nbsp;outfile.getParentFile();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(!parentDir.exists())&nbsp;parentDir.mkdirs();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileOutputStream&nbsp;fos&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;FileOutputStream(outfile);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferedOutputStream&nbsp;bos&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;BufferedOutputStream(fos,&nbsp;</span><span class="number">0x100000</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteArrayInputStream&nbsp;bais&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;ByteArrayInputStream(buf);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;remainder&nbsp;=&nbsp;buf.length;&nbsp;</span><span class="comment">//&nbsp;keep&nbsp;track&nbsp;of&nbsp;the&nbsp;amount&nbsp;of&nbsp;remaining&nbsp;bytes</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;bytes16&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;</span><span class="keyword">byte</span><span>[</span><span class="number">16</span><span>];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;(bais.available()&nbsp;!=&nbsp;</span><span class="number">0</span><span>&nbsp;&amp;&amp;&nbsp;remainder&nbsp;/&nbsp;</span><span class="number">16</span><span>&nbsp;!=&nbsp;</span><span class="number">0</span><span>)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bais.read(bytes16);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bos.write(bytes16);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainder&nbsp;-=&nbsp;<span class="number">16</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(remainder&nbsp;!=&nbsp;</span><span class="number">0</span><span>)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;remains&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;</span><span class="keyword">byte</span><span>[remainder];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bais.read(remains);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bos.write(remains);&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bos.flush();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bos.close();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div>
<br>
<br>IndexEntry.java:
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%2F*%0A%20*%20%40(%23)IndexEntry.java%20%202007%2F05%2F15%0A%20*%20Written%20by%20rednaxela%20%2F%20FX%0A%20*%2F%0A%0Apublic%20class%20IndexEntry%20%7B%0A%20%20%20%20%0A%20%20%20%20static%20final%20int%20ENTRY_LENGTH%20%3D%2016%3B%0A%20%20%20%20static%20final%20int%20MAX_FILENAME_LENGTH%20%3D%20256%3B%0A%20%20%20%20static%20final%20int%20OFFSET_OFS%20%3D%200%3B%0A%20%20%20%20static%20final%20int%20LENGTH_OFS%20%3D%204%3B%0A%20%20%20%20static%20final%20int%20FLAGS_OFS%20%3D%208%3B%0A%20%20%20%20static%20final%20int%20ORIGLENGTH_OFS%20%3D%2012%3B%0A%20%20%20%20%0A%20%20%20%20private%20String%20filename%3B%0A%20%20%20%20private%20int%20length%3B%0A%20%20%20%20private%20int%20offset%3B%0A%20%20%20%20private%20int%20flags%3B%20%2F%2F%20NOT_MSK%20%3D%201%2C%20LZSS_MSK%20%3D%202%0A%20%20%20%20private%20int%20origLength%3B%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40return%20the%20filename%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20String%20getFilename()%20%7B%0A%20%20%20%20%20%20%20%20return%20filename%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40param%20filename%20the%20filename%20to%20set%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20void%20setFilename(String%20filename)%20%7B%0A%20%20%20%20%20%20%20%20this.filename%20%3D%20filename%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40return%20the%20length%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20int%20getLength()%20%7B%0A%20%20%20%20%20%20%20%20return%20length%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40param%20length%20the%20length%20to%20set%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20void%20setLength(int%20length)%20%7B%0A%20%20%20%20%20%20%20%20this.length%20%3D%20length%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40return%20the%20offset%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20int%20getOffset()%20%7B%0A%20%20%20%20%20%20%20%20return%20offset%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40param%20offset%20the%20offset%20to%20set%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20void%20setOffset(int%20offset)%20%7B%0A%20%20%20%20%20%20%20%20this.offset%20%3D%20offset%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40return%20the%20offset%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20int%20getFlags()%20%7B%0A%20%20%20%20%20%20%20%20return%20offset%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40param%20offset%20the%20offset%20to%20set%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20void%20setFlags(int%20flags)%20%7B%0A%20%20%20%20%20%20%20%20this.flags%20%3D%20flags%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40return%20the%20compressedLength%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20int%20getOrigLength()%20%7B%0A%20%20%20%20%20%20%20%20return%20origLength%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20%40param%20offset%20the%20compressedLength%20to%20set%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20void%20setOrigLength(int%20origLength)%20%7B%0A%20%20%20%20%20%20%20%20this.origLength%20%3D%20origLength%3B%0A%20%20%20%20%7D%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="star" src="assets/1571225637-bf632ec55a05f69a9359f73417402b26.png" alt="收藏代码"><img class="spinner" src="assets/1571225637-a42df3a5b569bdc98ca473a4a3adfeac.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="comment">/*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@(#)IndexEntry.java&nbsp;&nbsp;2007/05/15</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;Written&nbsp;by&nbsp;rednaxela&nbsp;/&nbsp;FX</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;IndexEntry&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;ENTRY_LENGTH&nbsp;=&nbsp;</span><span class="number">16</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;MAX_FILENAME_LENGTH&nbsp;=&nbsp;</span><span class="number">256</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;OFFSET_OFS&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;LENGTH_OFS&nbsp;=&nbsp;</span><span class="number">4</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;FLAGS_OFS&nbsp;=&nbsp;</span><span class="number">8</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;ORIGLENGTH_OFS&nbsp;=&nbsp;</span><span class="number">12</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;String&nbsp;filename;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;length;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;offset;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;flags;&nbsp;</span><span class="comment">//&nbsp;NOT_MSK&nbsp;=&nbsp;1,&nbsp;LZSS_MSK&nbsp;=&nbsp;2</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;origLength;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;filename</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;getFilename()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;filename;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;filename&nbsp;the&nbsp;filename&nbsp;to&nbsp;set</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setFilename(String&nbsp;filename)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.filename&nbsp;=&nbsp;filename;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;length</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;getLength()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;length;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;length&nbsp;the&nbsp;length&nbsp;to&nbsp;set</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setLength(</span><span class="keyword">int</span><span>&nbsp;length)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.length&nbsp;=&nbsp;length;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;offset</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;getOffset()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;offset;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;offset&nbsp;the&nbsp;offset&nbsp;to&nbsp;set</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setOffset(</span><span class="keyword">int</span><span>&nbsp;offset)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.offset&nbsp;=&nbsp;offset;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;offset</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;getFlags()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;offset;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;offset&nbsp;the&nbsp;offset&nbsp;to&nbsp;set</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setFlags(</span><span class="keyword">int</span><span>&nbsp;flags)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.flags&nbsp;=&nbsp;flags;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;compressedLength</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;getOrigLength()&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;origLength;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;offset&nbsp;the&nbsp;compressedLength&nbsp;to&nbsp;set</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setOrigLength(</span><span class="keyword">int</span><span>&nbsp;origLength)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.origLength&nbsp;=&nbsp;origLength;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div>
<br>
<br>LZSS.java:
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%2F*%0A%20*%20%40(%23)LZSS.java%20%202007%2F05%2F15%0A%20*%20Written%20by%20rednaxela%20%2F%20FX%0A%20*%2F%0A%0Apublic%20class%20LZSS%20%7B%0A%20%20%20%20%0A%20%20%20%20static%20final%20int%20WINDOW_LENGTH%20%3D%204096%3B%0A%20%20%20%20%0A%20%20%20%20public%20static%20byte%5B%5D%20decompress(byte%5B%5D%20from%2C%20int%20compLen%2C%20byte%5B%5D%20to%2C%20int%20origLen)%20%7B%0A%20%20%20%20%20%20%20%20return%20decompress(from%2C%20compLen%2C%20to%2C%200%2C%20origLen)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20public%20static%20byte%5B%5D%20decompress(byte%5B%5D%20from%2C%20int%20compLen%2C%20byte%5B%5D%20to%2C%20int%20pos%2C%20int%20origLen)%20%7B%0A%20%20%20%20%20%20%20%20if%20(to%20%3D%3D%20null)%20to%20%3D%20new%20byte%5BorigLen%5D%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20byte%5B%5D%20window%20%3D%20new%20byte%5BWINDOW_LENGTH%5D%3B%0A%20%20%20%20%20%20%20%20int%20readOffset%20%3D%200%3B%0A%20%20%20%20%20%20%20%20int%20writeOffset%20%3D%20pos%3B%0A%20%20%20%20%20%20%20%20int%20marker%20%3D%200%3B%20%2F%2F%20read%20marker%2C%208-bits%2C%201%20for%20raw%20byte%2C%200%20for%20back%20ref%0A%20%20%20%20%20%20%20%20int%20windowWriteOffset%20%3D%200x0FEE%3B%0A%20%20%20%20%20%20%20%20int%20windowReadOffset%20%3D%200%3B%0A%20%20%20%20%20%20%20%20int%20backRefLength%20%3D%200%3B%0A%20%20%20%20%20%20%20%20int%20current%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20while%20(readOffset%20!%3D%20from.length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%20%3E%3E%3D%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20((marker%20%26%200x0100)%20%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20current%20%3D%20from%5BreadOffset%2B%2B%5D%20%26%200x0FF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20marker%20%3D%200x0FF00%20%7C%20current%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20if(readOffset%20%3D%3D%20from.length)%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20((marker%20%26%200x01)%20%3D%3D%201)%20%7B%20%2F%2F%20copy%20raw%20bytes%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20current%20%3D%20from%5BreadOffset%2B%2B%5D%20%26%200x0FF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20to%5BwriteOffset%2B%2B%5D%20%3D%20(byte)current%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20window%5BwindowWriteOffset%2B%2B%5D%20%3D%20(byte)current%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20windowWriteOffset%20%26%3D%200x0FFF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%20%2F%2F%20copy%20from%20slide%20window%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20windowReadOffset%20%3D%20from%5BreadOffset%2B%2B%5D%20%26%200x0FF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(readOffset%20%3D%3D%20from.length)%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20current%20%3D%20from%5BreadOffset%2B%2B%5D%20%26%200x0FF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20windowReadOffset%20%7C%3D%20(current%20%26%200x0F0)%20%3C%3C%204%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20backRefLength%20%3D%20(current%20%26%200x0F)%20%2B%202%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(backRefLength%20%3C%200)%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int%20addOffset%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(addOffset%20%3C%3D%20backRefLength)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20int%20curOfs%20%3D%20(windowReadOffset%20%2B%20addOffset%2B%2B)%20%26%200x0FFF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20current%20%3D%20window%5BcurOfs%5D%20%26%200x0FF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20windowReadOffset%20%26%3D%200x0FFF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20to%5BwriteOffset%2B%2B%5D%20%3D%20(byte)current%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20window%5BwindowWriteOffset%2B%2B%5D%20%3D%20(byte)current%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20windowWriteOffset%20%26%3D%200x0FFF%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%2F%2F%20while%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%2F%2F%20if-else%20%20%20%20%0A%20%20%20%20%20%20%20%20%7D%20%2F%2F%20while%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20return%20to%3B%0A%20%20%20%20%7D%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="star" src="assets/1571225637-bf632ec55a05f69a9359f73417402b26.png" alt="收藏代码"><img class="spinner" src="assets/1571225637-a42df3a5b569bdc98ca473a4a3adfeac.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="comment">/*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@(#)LZSS.java&nbsp;&nbsp;2007/05/15</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;Written&nbsp;by&nbsp;rednaxela&nbsp;/&nbsp;FX</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;LZSS&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">static</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;WINDOW_LENGTH&nbsp;=&nbsp;</span><span class="number">4096</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;decompress(</span><span class="keyword">byte</span><span>[]&nbsp;from,&nbsp;</span><span class="keyword">int</span><span>&nbsp;compLen,&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;to,&nbsp;</span><span class="keyword">int</span><span>&nbsp;origLen)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;decompress(from,&nbsp;compLen,&nbsp;to,&nbsp;</span><span class="number">0</span><span>,&nbsp;origLen);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;decompress(</span><span class="keyword">byte</span><span>[]&nbsp;from,&nbsp;</span><span class="keyword">int</span><span>&nbsp;compLen,&nbsp;</span><span class="keyword">byte</span><span>[]&nbsp;to,&nbsp;</span><span class="keyword">int</span><span>&nbsp;pos,&nbsp;</span><span class="keyword">int</span><span>&nbsp;origLen)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(to&nbsp;==&nbsp;</span><span class="keyword">null</span><span>)&nbsp;to&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;</span><span class="keyword">byte</span><span>[origLen];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;window&nbsp;=&nbsp;</span><span class="keyword">new</span><span>&nbsp;</span><span class="keyword">byte</span><span>[WINDOW_LENGTH];&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;readOffset&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;writeOffset&nbsp;=&nbsp;pos;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;marker&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;</span><span class="comment">//&nbsp;read&nbsp;marker,&nbsp;8-bits,&nbsp;1&nbsp;for&nbsp;raw&nbsp;byte,&nbsp;0&nbsp;for&nbsp;back&nbsp;ref</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;windowWriteOffset&nbsp;=&nbsp;</span><span class="number">0x0FEE</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;windowReadOffset&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;backRefLength&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;current&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;(readOffset&nbsp;!=&nbsp;from.length)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;marker&nbsp;&gt;&gt;=&nbsp;<span class="number">1</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((marker&nbsp;&amp;&nbsp;</span><span class="number">0x0100</span><span>)&nbsp;==&nbsp;</span><span class="number">0</span><span>)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;=&nbsp;from[readOffset++]&nbsp;&amp;&nbsp;<span class="number">0x0FF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;marker&nbsp;=&nbsp;<span class="number">0x0FF00</span><span>&nbsp;|&nbsp;current;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>(readOffset&nbsp;==&nbsp;from.length)&nbsp;</span><span class="keyword">break</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((marker&nbsp;&amp;&nbsp;</span><span class="number">0x01</span><span>)&nbsp;==&nbsp;</span><span class="number">1</span><span>)&nbsp;{&nbsp;</span><span class="comment">//&nbsp;copy&nbsp;raw&nbsp;bytes</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;=&nbsp;from[readOffset++]&nbsp;&amp;&nbsp;<span class="number">0x0FF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to[writeOffset++]&nbsp;=&nbsp;(<span class="keyword">byte</span><span>)current;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window[windowWriteOffset++]&nbsp;=&nbsp;(<span class="keyword">byte</span><span>)current;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;windowWriteOffset&nbsp;&amp;=&nbsp;<span class="number">0x0FFF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span><span>&nbsp;{&nbsp;</span><span class="comment">//&nbsp;copy&nbsp;from&nbsp;slide&nbsp;window</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;windowReadOffset&nbsp;=&nbsp;from[readOffset++]&nbsp;&amp;&nbsp;<span class="number">0x0FF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>(readOffset&nbsp;==&nbsp;from.length)&nbsp;</span><span class="keyword">break</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;=&nbsp;from[readOffset++]&nbsp;&amp;&nbsp;<span class="number">0x0FF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;windowReadOffset&nbsp;|=&nbsp;(current&nbsp;&amp;&nbsp;<span class="number">0x0F0</span><span>)&nbsp;&lt;&lt;&nbsp;</span><span class="number">4</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;backRefLength&nbsp;=&nbsp;(current&nbsp;&amp;&nbsp;<span class="number">0x0F</span><span>)&nbsp;+&nbsp;</span><span class="number">2</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(backRefLength&nbsp;&lt;&nbsp;</span><span class="number">0</span><span>)&nbsp;</span><span class="keyword">continue</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;addOffset&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;(addOffset&nbsp;&lt;=&nbsp;backRefLength)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;curOfs&nbsp;=&nbsp;(windowReadOffset&nbsp;+&nbsp;addOffset++)&nbsp;&amp;&nbsp;</span><span class="number">0x0FFF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;=&nbsp;window[curOfs]&nbsp;&amp;&nbsp;<span class="number">0x0FF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;windowReadOffset&nbsp;&amp;=&nbsp;<span class="number">0x0FFF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to[writeOffset++]&nbsp;=&nbsp;(<span class="keyword">byte</span><span>)current;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window[windowWriteOffset++]&nbsp;=&nbsp;(<span class="keyword">byte</span><span>)current;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;windowWriteOffset&nbsp;&amp;=&nbsp;<span class="number">0x0FFF</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="comment">//&nbsp;while</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="comment">//&nbsp;if-else&nbsp;&nbsp;&nbsp;&nbsp;</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="comment">//&nbsp;while</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;to;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div>
<br>
<br>Binconverter.java:
<br><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%2F*%0A%20*%20%40(%23)BinConverter.java%0A%20*%2F%0A%0A%2F**%0A%20*%20Some%20helper%20routines%20for%20data%20conversion%2C%20all%20data%20is%20treated%20in%20network%0A%20*%20byte%20order.%0A%20*%2F%0Apublic%20class%20BinConverter%0A%7B%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Gets%20bytes%20from%20an%20array%20into%20an%20integer%2C%20in%20big-endian.%0A%20%20%20%20%20*%20%40param%20buf%20where%20to%20get%20the%20bytes%0A%20%20%20%20%20*%20%40param%20ofs%20index%20from%20where%20to%20read%20the%20data%0A%20%20%20%20%20*%20%40return%20the%2032bit%20integer%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20int%20byteArrayToIntBE(%0A%20%20%20%20%20%20%20%20byte%5B%5D%20buf%2C%0A%20%20%20%20%20%20%20%20int%20ofs)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20return%20(buf%5Bofs%20%20%20%20%5D%20%20%20%20%20%20%20%20%20%20%3C%3C%2024)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7C%20((buf%5Bofs%20%2B%201%5D%20%26%200x0ff)%20%3C%3C%2016)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7C%20((buf%5Bofs%20%2B%202%5D%20%26%200x0ff)%20%3C%3C%20%208)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7C%20(%20buf%5Bofs%20%2B%203%5D%20%26%200x0ff)%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Gets%20bytes%20from%20an%20array%20into%20an%20integer%2C%20in%20little-endian.%0A%20%20%20%20%20*%20%40param%20buf%20where%20to%20get%20the%20bytes%0A%20%20%20%20%20*%20%40param%20ofs%20index%20from%20where%20to%20read%20the%20data%0A%20%20%20%20%20*%20%40return%20the%2032bit%20integer%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20int%20byteArrayToIntLE(%0A%20%20%20%20%20%20%20%20byte%5B%5D%20buf%2C%0A%20%20%20%20%20%20%20%20int%20ofs)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20return%20(buf%5Bofs%20%2B%203%5D%20%20%20%20%20%20%20%20%20%20%3C%3C%2024)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7C%20((buf%5Bofs%20%2B%202%5D%20%26%200x0ff)%20%3C%3C%2016)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7C%20((buf%5Bofs%20%2B%201%5D%20%26%200x0ff)%20%3C%3C%20%208)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7C%20(%20buf%5Bofs%20%20%20%20%5D%20%26%200x0ff)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20an%20integer%20to%20bytes%20in%20big-endian%2C%20which%20are%20put%20into%20an%20array.%0A%20%20%20%20%20*%20%40param%20value%20the%2032bit%20integer%20to%20convert%0A%20%20%20%20%20*%20%40param%20buf%20the%20target%20buf%0A%20%20%20%20%20*%20%40param%20ofs%20where%20to%20place%20the%20bytes%20in%20the%20buf%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20void%20intToByteArrayBE(%0A%20%20%20%20%20%20%20%20int%20value%2C%0A%20%20%20%20%20%20%20%20byte%5B%5D%20buf%2C%0A%20%20%20%20%20%20%20%20int%20ofs)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%20%20%20%5D%20%3D%20(byte)((value%20%3E%3E%3E%2024)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%201%5D%20%3D%20(byte)((value%20%3E%3E%3E%2016)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%202%5D%20%3D%20(byte)((value%20%3E%3E%3E%20%208)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%203%5D%20%3D%20(byte)%20%20value%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20an%20integer%20to%20bytes%20in%20little-endian%2C%20which%20are%20put%20into%20an%20array.%0A%20%20%20%20%20*%20%40param%20value%20the%2032bit%20integer%20to%20convert%0A%20%20%20%20%20*%20%40param%20buf%20the%20target%20buf%0A%20%20%20%20%20*%20%40param%20ofs%20where%20to%20place%20the%20bytes%20in%20the%20buf%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20void%20intToByteArrayLE(%0A%20%20%20%20%20%20%20%20int%20value%2C%0A%20%20%20%20%20%20%20%20byte%5B%5D%20buf%2C%0A%20%20%20%20%20%20%20%20int%20ofs)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%203%5D%20%3D%20(byte)((value%20%3E%3E%3E%2024)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%202%5D%20%3D%20(byte)((value%20%3E%3E%3E%2016)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%201%5D%20%3D%20(byte)((value%20%3E%3E%3E%20%208)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%20%20%20%5D%20%3D%20(byte)%20%20value%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Gets%20bytes%20from%20an%20array%20into%20a%20long.%0A%20%20%20%20%20*%20%40param%20buf%20where%20to%20get%20the%20bytes%0A%20%20%20%20%20*%20%40param%20ofs%20index%20from%20where%20to%20read%20the%20data%0A%20%20%20%20%20*%20%40return%20the%2064bit%20integer%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20long%20byteArrayToLong(%0A%20%20%20%20%20%20%20%20byte%5B%5D%20buf%2C%0A%20%20%20%20%20%20%20%20int%20ofs)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20Looks%20more%20complex%20-%20but%20it%20is%20faster%20(at%20least%20on%2032bit%20platforms).%0A%0A%20%20%20%20%20%20%20%20return%0A%20%20%20%20%20%20%20%20%20%20%20%20((long)((%20buf%5Bofs%20%20%20%20%5D%20%20%20%20%20%20%20%20%20%20%3C%3C%2024)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((buf%5Bofs%20%2B%201%5D%20%26%200x0ff)%20%3C%3C%2016)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((buf%5Bofs%20%2B%202%5D%20%26%200x0ff)%20%3C%3C%20%208)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(%20buf%5Bofs%20%2B%203%5D%20%26%200x0ff%20%20%20%20%20%20%20))%20%3C%3C%2032)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20((long)((%20buf%5Bofs%20%2B%204%5D%20%20%20%20%20%20%20%20%20%20%3C%3C%2024)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((buf%5Bofs%20%2B%205%5D%20%26%200x0ff)%20%3C%3C%2016)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((buf%5Bofs%20%2B%206%5D%20%26%200x0ff)%20%3C%3C%20%208)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(%20buf%5Bofs%20%2B%207%5D%20%26%200x0ff%20%20%20%20%20%20%20))%20%26%200x0ffffffffL)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20a%20long%20to%20bytes%2C%20which%20are%20put%20into%20an%20array.%0A%20%20%20%20%20*%20%40param%20value%20the%2064bit%20integer%20to%20convert%0A%20%20%20%20%20*%20%40param%20buf%20the%20target%20buf%0A%20%20%20%20%20*%20%40param%20ofs%20where%20to%20place%20the%20bytes%20in%20the%20buf%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20void%20longToByteArray(%0A%20%20%20%20%20%20%20%20long%20value%2C%0A%20%20%20%20%20%20%20%20byte%5B%5D%20buf%2C%0A%20%20%20%20%20%20%20%20int%20ofs)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20int%20tmp%20%3D%20(int)(value%20%3E%3E%3E%2032)%3B%0A%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%20%20%20%5D%20%3D%20(byte)%20(tmp%20%3E%3E%3E%2024)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%201%5D%20%3D%20(byte)((tmp%20%3E%3E%3E%2016)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%202%5D%20%3D%20(byte)((tmp%20%3E%3E%3E%20%208)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%203%5D%20%3D%20(byte)%20%20tmp%3B%0A%0A%20%20%20%20%20%20%20%20tmp%20%3D%20(int)value%3B%0A%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%204%5D%20%3D%20(byte)%20(tmp%20%3E%3E%3E%2024)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%205%5D%20%3D%20(byte)((tmp%20%3E%3E%3E%2016)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%206%5D%20%3D%20(byte)((tmp%20%3E%3E%3E%20%208)%20%26%200x0ff)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%207%5D%20%3D%20(byte)%20%20tmp%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20values%20from%20an%20integer%20array%20to%20a%20long.%0A%20%20%20%20%20*%20%40param%20buf%20where%20to%20get%20the%20bytes%0A%20%20%20%20%20*%20%40param%20ofs%20index%20from%20where%20to%20read%20the%20data%0A%20%20%20%20%20*%20%40return%20the%2064bit%20integer%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20long%20intArrayToLong(%0A%20%20%20%20%20%20%20%20int%5B%5D%20buf%2C%0A%20%20%20%20%20%20%20%20int%20ofs)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20return%20(((long)%20buf%5Bofs%20%20%20%20%5D)%20%3C%3C%2032)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(((long)%20buf%5Bofs%20%2B%201%5D)%20%26%200x0ffffffffL)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20a%20long%20to%20integers%20which%20are%20put%20into%20an%20array.%0A%20%20%20%20%20*%20%40param%20value%20the%2064bit%20integer%20to%20convert%0A%20%20%20%20%20*%20%40param%20buf%20the%20target%20buf%0A%20%20%20%20%20*%20%40param%20ofs%20where%20to%20place%20the%20bytes%20in%20the%20buf%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20void%20longToIntArray(%0A%20%20%20%20%20%20%20%20long%20value%2C%0A%20%20%20%20%20%20%20%20int%5B%5D%20buf%2C%0A%20%20%20%20%20%20%20%20int%20ofs)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%20%20%20%5D%20%3D%20(int)(value%20%3E%3E%3E%2032)%3B%0A%20%20%20%20%20%20%20%20buf%5Bofs%20%2B%201%5D%20%3D%20(int)%20value%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Makes%20a%20long%20from%20two%20integers%20(treated%20unsigned).%0A%20%20%20%20%20*%20%40param%20lo%20lower%2032bits%0A%20%20%20%20%20*%20%40param%20hi%20higher%2032bits%0A%20%20%20%20%20*%20%40return%20the%20built%20long%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20long%20makeLong(%0A%20%20%20%20%20%20%20%20int%20lo%2C%0A%20%20%20%20%20%20%20%20int%20hi)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20return%20(((long)%20hi%20%3C%3C%2032)%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((long)%20lo%20%26%200x00000000ffffffffL))%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Gets%20the%20lower%2032%20bits%20of%20a%20long.%0A%20%20%20%20%20*%20%40param%20val%20the%20long%20integer%0A%20%20%20%20%20*%20%40return%20lower%2032%20bits%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20int%20longLo32(%0A%20%20%20%20%20%20%20%20long%20val)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20return%20(int)val%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Gets%20the%20higher%2032%20bits%20of%20a%20long.%0A%20%20%20%20%20*%20%40param%20val%20the%20long%20integer%0A%20%20%20%20%20*%20%40return%20higher%2032%20bits%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20int%20longHi32(%0A%20%20%20%20%20%20%20%20long%20val)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20return%20(int)(val%20%3E%3E%3E%2032)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F%2F%20our%20table%20for%20hex%20conversion%0A%20%20%20%20final%20static%20char%5B%5D%20HEXTAB%20%3D%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20'0'%2C%20'1'%2C%20'2'%2C%20'3'%2C%20'4'%2C%20'5'%2C%20'6'%2C%20'7'%2C%0A%20%20%20%20%20%20%20%20'8'%2C%20'9'%2C%20'a'%2C%20'b'%2C%20'c'%2C%20'd'%2C%20'e'%2C%20'f'%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20a%20byte%20array%20to%20a%20hex%20string.%0A%20%20%20%20%20*%20%40param%20data%20the%20byte%20array%0A%20%20%20%20%20*%20%40return%20the%20hex%20string%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20String%20bytesToHexStr(%0A%20%20%20%20%20%20%20%20byte%5B%5D%20data)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20return%20bytesToHexStr(data%2C%200%2C%20data.length)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20a%20byte%20array%20to%20a%20hex%20string.%0A%20%20%20%20%20*%20%40param%20data%20the%20byte%20array%0A%20%20%20%20%20*%20%40param%20ofs%20start%20index%20where%20to%20get%20the%20bytes%0A%20%20%20%20%20*%20%40param%20len%20number%20of%20bytes%20to%20convert%0A%20%20%20%20%20*%20%40return%20the%20hex%20string%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20String%20bytesToHexStr(%0A%20%20%20%20%20%20%20%20byte%5B%5D%20data%2C%0A%20%20%20%20%20%20%20%20int%20ofs%2C%0A%20%20%20%20%20%20%20%20int%20len)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20int%20pos%2C%20c%3B%0A%20%20%20%20%20%20%20%20StringBuffer%20sbuf%3B%0A%0A%0A%20%20%20%20%20%20%20%20sbuf%20%3D%20new%20StringBuffer()%3B%0A%20%20%20%20%20%20%20%20sbuf.setLength(len%20%3C%3C%201)%3B%0A%0A%20%20%20%20%20%20%20%20pos%20%3D%200%3B%0A%20%20%20%20%20%20%20%20c%20%3D%20ofs%20%2B%20len%3B%0A%0A%20%20%20%20%20%20%20%20while%20(ofs%20%3C%20c)%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20sbuf.setCharAt(pos%2B%2B%2C%20HEXTAB%5B(data%5Bofs%20%20%5D%20%3E%3E%204)%20%26%200x0f%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20sbuf.setCharAt(pos%2B%2B%2C%20HEXTAB%5B%20data%5Bofs%2B%2B%5D%20%20%20%20%20%20%20%26%200x0f%5D)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20sbuf.toString()%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20a%20hex%20string%20back%20into%20a%20byte%20array%20(invalid%20codes%20will%20be%0A%20%20%20%20%20*%20skipped).%0A%20%20%20%20%20*%20%40param%20hex%20hex%20string%0A%20%20%20%20%20*%20%40param%20data%20the%20target%20array%0A%20%20%20%20%20*%20%40param%20srcofs%20from%20which%20character%20in%20the%20string%20the%20conversion%20should%0A%20%20%20%20%20*%20begin%2C%20remember%20that%20(nSrcPos%20modulo%202)%20should%20equals%200%20normally%0A%20%20%20%20%20*%20%40param%20dstofs%20to%20store%20the%20bytes%20from%20which%20position%20in%20the%20array%0A%20%20%20%20%20*%20%40param%20len%20number%20of%20bytes%20to%20extract%0A%20%20%20%20%20*%20%40return%20number%20of%20extracted%20bytes%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20int%20hexStrToBytes(%0A%20%20%20%20%20%20%20%20String%20hex%2C%0A%20%20%20%20%20%20%20%20byte%5B%5D%20data%2C%0A%20%20%20%20%20%20%20%20int%20srcofs%2C%0A%20%20%20%20%20%20%20%20int%20dstofs%2C%0A%20%20%20%20%20%20%20%20int%20len)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20int%20i%2C%20j%2C%20strlen%2C%20avail_bytes%2C%20dstofs_bak%3B%0A%20%20%20%20%20%20%20%20byte%20abyte%3B%0A%20%20%20%20%20%20%20%20boolean%20convertOK%3B%0A%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20check%20for%20correct%20ranges%0A%20%20%20%20%20%20%20%20strlen%20%3D%20hex.length()%3B%0A%0A%20%20%20%20%20%20%20%20avail_bytes%20%3D%20(strlen%20-%20srcofs)%20%3E%3E%201%3B%0A%20%20%20%20%20%20%20%20if%20(avail_bytes%20%3C%20len)%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20len%20%3D%20avail_bytes%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20int%20nOutputCapacity%20%3D%20data.length%20-%20dstofs%3B%0A%20%20%20%20%20%20%20%20if%20(len%20%3E%20nOutputCapacity)%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20len%20%3D%20nOutputCapacity%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20convert%20now%0A%0A%20%20%20%20%20%20%20%20dstofs_bak%20%3D%20dstofs%3B%0A%0A%20%20%20%20%20%20%20%20for%20(i%20%3D%200%3B%20i%20%3C%20len%3B%20i%2B%2B)%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20abyte%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20convertOK%20%3D%20true%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(j%20%3D%200%3B%20j%20%3C%202%3B%20j%2B%2B)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20abyte%20%3C%3C%3D%204%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20char%20cActChar%20%3D%20hex.charAt(srcofs%2B%2B)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((cActChar%20%3E%3D%20'a')%20%26%26%20(cActChar%20%3C%3D%20'f'))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20abyte%20%7C%3D%20(byte)%20(cActChar%20-%20'a')%20%2B%2010%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20((cActChar%20%3E%3D%20'0')%20%26%26%20(cActChar%20%3C%3D%20'9'))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20abyte%20%7C%3D%20(byte)%20(cActChar%20-%20'0')%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20convertOK%20%3D%20false%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(convertOK)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data%5Bdstofs%2B%2B%5D%20%3D%20abyte%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20return%20(dstofs%20-%20dstofs_bak)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%0A%0A%20%20%20%20%2F**%0A%20%20%20%20%20*%20Converts%20a%20byte%20array%20into%20a%20Unicode%20string.%0A%20%20%20%20%20*%20%40param%20data%20the%20byte%20array%0A%20%20%20%20%20*%20%40param%20ofs%20where%20to%20begin%20the%20conversion%0A%20%20%20%20%20*%20%40param%20len%20number%20of%20bytes%20to%20handle%0A%20%20%20%20%20*%20%40return%20the%20string%0A%20%20%20%20%20*%2F%0A%20%20%20%20public%20final%20static%20String%20byteArrayToStr(%0A%20%20%20%20%20%20%20%20byte%5B%5D%20data%2C%0A%20%20%20%20%20%20%20%20int%20ofs%2C%0A%20%20%20%20%20%20%20%20int%20len)%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20int%20avail_capacity%2C%20sbuf_pos%3B%0A%20%20%20%20%20%20%20%20StringBuffer%20sbuf%3B%0A%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20we%20need%20two%20bytes%20for%20every%20character%0A%20%20%20%20%20%20%20%20len%20%26%3D%20~1%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20enough%20bytes%20in%20the%20buf%3F%0A%20%20%20%20%20%20%20%20avail_capacity%20%3D%20data.length%20-%20ofs%3B%0A%0A%20%20%20%20%20%20%20%20if%20(avail_capacity%20%3C%20len)%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20len%20%3D%20avail_capacity%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20sbuf%20%3D%20new%20StringBuffer()%3B%0A%20%20%20%20%20%20%20%20sbuf.setLength(len%20%3E%3E%201)%3B%0A%0A%20%20%20%20%20%20%20%20sbuf_pos%20%3D%200%3B%0A%0A%20%20%20%20%20%20%20%20while%20(0%20%3C%20len)%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20sbuf.setCharAt(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sbuf_pos%2B%2B%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(char)((data%5Bofs%20%20%20%20%5D%20%3C%3C%208)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20(data%5Bofs%20%2B%201%5D%20%26%200x0ff)))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20ofs%20%2B%3D%202%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20len%20-%3D%202%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20return%20sbuf.toString()%3B%0A%20%20%20%20%7D%0A%7D" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="star" src="assets/1571225637-bf632ec55a05f69a9359f73417402b26.png" alt="收藏代码"><img class="spinner" src="assets/1571225637-a42df3a5b569bdc98ca473a4a3adfeac.gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="comment">/*</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;@(#)BinConverter.java</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span><span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;Some&nbsp;helper&nbsp;routines&nbsp;for&nbsp;data&nbsp;conversion,&nbsp;all&nbsp;data&nbsp;is&nbsp;treated&nbsp;in&nbsp;network</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*&nbsp;byte&nbsp;order.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;BinConverter&nbsp;&nbsp;</span></span></li><li><span>{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;bytes&nbsp;from&nbsp;an&nbsp;array&nbsp;into&nbsp;an&nbsp;integer,&nbsp;in&nbsp;big-endian.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;buf&nbsp;where&nbsp;to&nbsp;get&nbsp;the&nbsp;bytes</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;index&nbsp;from&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;32bit&nbsp;integer</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;byteArrayToIntBE(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;buf,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(buf[ofs&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span class="number">24</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;((buf[ofs&nbsp;+&nbsp;<span class="number">1</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)&nbsp;&lt;&lt;&nbsp;</span><span class="number">16</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;((buf[ofs&nbsp;+&nbsp;<span class="number">2</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)&nbsp;&lt;&lt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">3</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;bytes&nbsp;from&nbsp;an&nbsp;array&nbsp;into&nbsp;an&nbsp;integer,&nbsp;in&nbsp;little-endian.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;buf&nbsp;where&nbsp;to&nbsp;get&nbsp;the&nbsp;bytes</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;index&nbsp;from&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;32bit&nbsp;integer</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;byteArrayToIntLE(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;buf,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(buf[ofs&nbsp;+&nbsp;</span><span class="number">3</span><span>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span class="number">24</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;((buf[ofs&nbsp;+&nbsp;<span class="number">2</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)&nbsp;&lt;&lt;&nbsp;</span><span class="number">16</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;((buf[ofs&nbsp;+&nbsp;<span class="number">1</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)&nbsp;&lt;&lt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(&nbsp;buf[ofs&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;&amp;&nbsp;<span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;an&nbsp;integer&nbsp;to&nbsp;bytes&nbsp;in&nbsp;big-endian,&nbsp;which&nbsp;are&nbsp;put&nbsp;into&nbsp;an&nbsp;array.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;value&nbsp;the&nbsp;32bit&nbsp;integer&nbsp;to&nbsp;convert</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;buf&nbsp;the&nbsp;target&nbsp;buf</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;where&nbsp;to&nbsp;place&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buf</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;intToByteArrayBE(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;value,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;buf,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;=&nbsp;(<span class="keyword">byte</span><span>)((value&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">24</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">1</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((value&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">16</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">2</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((value&nbsp;&gt;&gt;&gt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">3</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)&nbsp;&nbsp;value;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;an&nbsp;integer&nbsp;to&nbsp;bytes&nbsp;in&nbsp;little-endian,&nbsp;which&nbsp;are&nbsp;put&nbsp;into&nbsp;an&nbsp;array.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;value&nbsp;the&nbsp;32bit&nbsp;integer&nbsp;to&nbsp;convert</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;buf&nbsp;the&nbsp;target&nbsp;buf</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;where&nbsp;to&nbsp;place&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buf</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;intToByteArrayLE(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;value,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;buf,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">3</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((value&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">24</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">2</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((value&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">16</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">1</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((value&nbsp;&gt;&gt;&gt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;=&nbsp;(<span class="keyword">byte</span><span>)&nbsp;&nbsp;value;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;bytes&nbsp;from&nbsp;an&nbsp;array&nbsp;into&nbsp;a&nbsp;long.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;buf&nbsp;where&nbsp;to&nbsp;get&nbsp;the&nbsp;bytes</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;index&nbsp;from&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;64bit&nbsp;integer</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">long</span><span>&nbsp;byteArrayToLong(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;buf,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Looks&nbsp;more&nbsp;complex&nbsp;-&nbsp;but&nbsp;it&nbsp;is&nbsp;faster&nbsp;(at&nbsp;least&nbsp;on&nbsp;32bit&nbsp;platforms).</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="keyword">long</span><span>)((&nbsp;buf[ofs&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span class="number">24</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((buf[ofs&nbsp;+&nbsp;<span class="number">1</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)&nbsp;&lt;&lt;&nbsp;</span><span class="number">16</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((buf[ofs&nbsp;+&nbsp;<span class="number">2</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)&nbsp;&lt;&lt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">3</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))&nbsp;&lt;&lt;&nbsp;</span><span class="number">32</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="keyword">long</span><span>)((&nbsp;buf[ofs&nbsp;+&nbsp;</span><span class="number">4</span><span>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span class="number">24</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((buf[ofs&nbsp;+&nbsp;<span class="number">5</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)&nbsp;&lt;&lt;&nbsp;</span><span class="number">16</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((buf[ofs&nbsp;+&nbsp;<span class="number">6</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)&nbsp;&lt;&lt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">7</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))&nbsp;&amp;&nbsp;0x0ffffffffL);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;a&nbsp;long&nbsp;to&nbsp;bytes,&nbsp;which&nbsp;are&nbsp;put&nbsp;into&nbsp;an&nbsp;array.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;value&nbsp;the&nbsp;64bit&nbsp;integer&nbsp;to&nbsp;convert</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;buf&nbsp;the&nbsp;target&nbsp;buf</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;where&nbsp;to&nbsp;place&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buf</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;longToByteArray(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">long</span><span>&nbsp;value,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;buf,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;tmp&nbsp;=&nbsp;(</span><span class="keyword">int</span><span>)(value&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">32</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;=&nbsp;(<span class="keyword">byte</span><span>)&nbsp;(tmp&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">24</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">1</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((tmp&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">16</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">2</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((tmp&nbsp;&gt;&gt;&gt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">3</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)&nbsp;&nbsp;tmp;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp&nbsp;=&nbsp;(<span class="keyword">int</span><span>)value;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">4</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)&nbsp;(tmp&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">24</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">5</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((tmp&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">16</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">6</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)((tmp&nbsp;&gt;&gt;&gt;&nbsp;&nbsp;</span><span class="number">8</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">7</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">byte</span><span>)&nbsp;&nbsp;tmp;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;values&nbsp;from&nbsp;an&nbsp;integer&nbsp;array&nbsp;to&nbsp;a&nbsp;long.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;buf&nbsp;where&nbsp;to&nbsp;get&nbsp;the&nbsp;bytes</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;index&nbsp;from&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;64bit&nbsp;integer</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">long</span><span>&nbsp;intArrayToLong(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>[]&nbsp;buf,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(((</span><span class="keyword">long</span><span>)&nbsp;buf[ofs&nbsp;&nbsp;&nbsp;&nbsp;])&nbsp;&lt;&lt;&nbsp;</span><span class="number">32</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((<span class="keyword">long</span><span>)&nbsp;buf[ofs&nbsp;+&nbsp;</span><span class="number">1</span><span>])&nbsp;&amp;&nbsp;0x0ffffffffL);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;a&nbsp;long&nbsp;to&nbsp;integers&nbsp;which&nbsp;are&nbsp;put&nbsp;into&nbsp;an&nbsp;array.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;value&nbsp;the&nbsp;64bit&nbsp;integer&nbsp;to&nbsp;convert</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;buf&nbsp;the&nbsp;target&nbsp;buf</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;where&nbsp;to&nbsp;place&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buf</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;longToIntArray(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">long</span><span>&nbsp;value,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>[]&nbsp;buf,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;=&nbsp;(<span class="keyword">int</span><span>)(value&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">32</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf[ofs&nbsp;+&nbsp;<span class="number">1</span><span>]&nbsp;=&nbsp;(</span><span class="keyword">int</span><span>)&nbsp;value;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Makes&nbsp;a&nbsp;long&nbsp;from&nbsp;two&nbsp;integers&nbsp;(treated&nbsp;unsigned).</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;lo&nbsp;lower&nbsp;32bits</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;hi&nbsp;higher&nbsp;32bits</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;built&nbsp;long</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">long</span><span>&nbsp;makeLong(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;lo,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;hi)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(((</span><span class="keyword">long</span><span>)&nbsp;hi&nbsp;&lt;&lt;&nbsp;</span><span class="number">32</span><span>)&nbsp;|&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="keyword">long</span><span>)&nbsp;lo&nbsp;&amp;&nbsp;0x00000000ffffffffL));&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;lower&nbsp;32&nbsp;bits&nbsp;of&nbsp;a&nbsp;long.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;val&nbsp;the&nbsp;long&nbsp;integer</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;lower&nbsp;32&nbsp;bits</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;longLo32(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">long</span><span>&nbsp;val)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(</span><span class="keyword">int</span><span>)val;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Gets&nbsp;the&nbsp;higher&nbsp;32&nbsp;bits&nbsp;of&nbsp;a&nbsp;long.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;val&nbsp;the&nbsp;long&nbsp;integer</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;higher&nbsp;32&nbsp;bits</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;longHi32(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">long</span><span>&nbsp;val)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(</span><span class="keyword">int</span><span>)(val&nbsp;&gt;&gt;&gt;&nbsp;</span><span class="number">32</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;our&nbsp;table&nbsp;for&nbsp;hex&nbsp;conversion</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">char</span><span>[]&nbsp;HEXTAB&nbsp;=&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'0'</span><span>,&nbsp;</span><span class="string">'1'</span><span>,&nbsp;</span><span class="string">'2'</span><span>,&nbsp;</span><span class="string">'3'</span><span>,&nbsp;</span><span class="string">'4'</span><span>,&nbsp;</span><span class="string">'5'</span><span>,&nbsp;</span><span class="string">'6'</span><span>,&nbsp;</span><span class="string">'7'</span><span>,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">'8'</span><span>,&nbsp;</span><span class="string">'9'</span><span>,&nbsp;</span><span class="string">'a'</span><span>,&nbsp;</span><span class="string">'b'</span><span>,&nbsp;</span><span class="string">'c'</span><span>,&nbsp;</span><span class="string">'d'</span><span>,&nbsp;</span><span class="string">'e'</span><span>,&nbsp;</span><span class="string">'f'</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;a&nbsp;byte&nbsp;array&nbsp;to&nbsp;a&nbsp;hex&nbsp;string.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;data&nbsp;the&nbsp;byte&nbsp;array</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;hex&nbsp;string</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;String&nbsp;bytesToHexStr(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;data)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;bytesToHexStr(data,&nbsp;</span><span class="number">0</span><span>,&nbsp;data.length);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;a&nbsp;byte&nbsp;array&nbsp;to&nbsp;a&nbsp;hex&nbsp;string.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;data&nbsp;the&nbsp;byte&nbsp;array</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;start&nbsp;index&nbsp;where&nbsp;to&nbsp;get&nbsp;the&nbsp;bytes</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;len&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;convert</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;hex&nbsp;string</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;String&nbsp;bytesToHexStr(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;data,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;len)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;pos,&nbsp;c;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuffer&nbsp;sbuf;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;StringBuffer();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf.setLength(len&nbsp;&lt;&lt;&nbsp;<span class="number">1</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos&nbsp;=&nbsp;<span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;ofs&nbsp;+&nbsp;len;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;(ofs&nbsp;&lt;&nbsp;c)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf.setCharAt(pos++,&nbsp;HEXTAB[(data[ofs&nbsp;&nbsp;]&nbsp;&gt;&gt;&nbsp;<span class="number">4</span><span>)&nbsp;&amp;&nbsp;</span><span class="number">0x0f</span><span>]);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf.setCharAt(pos++,&nbsp;HEXTAB[&nbsp;data[ofs++]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;<span class="number">0x0f</span><span>]);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;sbuf.toString();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;a&nbsp;hex&nbsp;string&nbsp;back&nbsp;into&nbsp;a&nbsp;byte&nbsp;array&nbsp;(invalid&nbsp;codes&nbsp;will&nbsp;be</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;skipped).</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;hex&nbsp;hex&nbsp;string</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;data&nbsp;the&nbsp;target&nbsp;array</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;srcofs&nbsp;from&nbsp;which&nbsp;character&nbsp;in&nbsp;the&nbsp;string&nbsp;the&nbsp;conversion&nbsp;should</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;begin,&nbsp;remember&nbsp;that&nbsp;(nSrcPos&nbsp;modulo&nbsp;2)&nbsp;should&nbsp;equals&nbsp;0&nbsp;normally</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;dstofs&nbsp;to&nbsp;store&nbsp;the&nbsp;bytes&nbsp;from&nbsp;which&nbsp;position&nbsp;in&nbsp;the&nbsp;array</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;len&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;extract</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;number&nbsp;of&nbsp;extracted&nbsp;bytes</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">int</span><span>&nbsp;hexStrToBytes(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;hex,&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;data,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;srcofs,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;dstofs,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;len)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;i,&nbsp;j,&nbsp;strlen,&nbsp;avail_bytes,&nbsp;dstofs_bak;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>&nbsp;abyte;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">boolean</span><span>&nbsp;convertOK;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;check&nbsp;for&nbsp;correct&nbsp;ranges</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strlen&nbsp;=&nbsp;hex.length();&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;avail_bytes&nbsp;=&nbsp;(strlen&nbsp;-&nbsp;srcofs)&nbsp;&gt;&gt;&nbsp;<span class="number">1</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(avail_bytes&nbsp;&lt;&nbsp;len)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;=&nbsp;avail_bytes;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;nOutputCapacity&nbsp;=&nbsp;data.length&nbsp;-&nbsp;dstofs;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(len&nbsp;&gt;&nbsp;nOutputCapacity)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;=&nbsp;nOutputCapacity;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;convert&nbsp;now</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstofs_bak&nbsp;=&nbsp;dstofs;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(i&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;i&nbsp;&lt;&nbsp;len;&nbsp;i++)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abyte&nbsp;=&nbsp;<span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convertOK&nbsp;=&nbsp;<span class="keyword">true</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>&nbsp;(j&nbsp;=&nbsp;</span><span class="number">0</span><span>;&nbsp;j&nbsp;&lt;&nbsp;</span><span class="number">2</span><span>;&nbsp;j++)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abyte&nbsp;&lt;&lt;=&nbsp;<span class="number">4</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">char</span><span>&nbsp;cActChar&nbsp;=&nbsp;hex.charAt(srcofs++);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((cActChar&nbsp;&gt;=&nbsp;</span><span class="string">'a'</span><span>)&nbsp;&amp;&amp;&nbsp;(cActChar&nbsp;&lt;=&nbsp;</span><span class="string">'f'</span><span>))&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abyte&nbsp;|=&nbsp;(<span class="keyword">byte</span><span>)&nbsp;(cActChar&nbsp;-&nbsp;</span><span class="string">'a'</span><span>)&nbsp;+&nbsp;</span><span class="number">10</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;((cActChar&nbsp;&gt;=&nbsp;</span><span class="string">'0'</span><span>)&nbsp;&amp;&amp;&nbsp;(cActChar&nbsp;&lt;=&nbsp;</span><span class="string">'9'</span><span>))&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abyte&nbsp;|=&nbsp;(<span class="keyword">byte</span><span>)&nbsp;(cActChar&nbsp;-&nbsp;</span><span class="string">'0'</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convertOK&nbsp;=&nbsp;<span class="keyword">false</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(convertOK)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data[dstofs++]&nbsp;=&nbsp;abyte;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;(dstofs&nbsp;-&nbsp;dstofs_bak);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">///////////////////////////////////////////////////////////////////////////</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/**</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Converts&nbsp;a&nbsp;byte&nbsp;array&nbsp;into&nbsp;a&nbsp;Unicode&nbsp;string.</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;data&nbsp;the&nbsp;byte&nbsp;array</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;ofs&nbsp;where&nbsp;to&nbsp;begin&nbsp;the&nbsp;conversion</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;len&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;handle</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;the&nbsp;string</span>&nbsp;</span></li><li><span><span class="comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">final</span><span>&nbsp;</span><span class="keyword">static</span><span>&nbsp;String&nbsp;byteArrayToStr(&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">byte</span><span>[]&nbsp;data,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;ofs,&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;len)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;avail_capacity,&nbsp;sbuf_pos;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuffer&nbsp;sbuf;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;we&nbsp;need&nbsp;two&nbsp;bytes&nbsp;for&nbsp;every&nbsp;character</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;&amp;=&nbsp;~<span class="number">1</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;enough&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buf?</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;avail_capacity&nbsp;=&nbsp;data.length&nbsp;-&nbsp;ofs;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(avail_capacity&nbsp;&lt;&nbsp;len)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;=&nbsp;avail_capacity;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf&nbsp;=&nbsp;<span class="keyword">new</span><span>&nbsp;StringBuffer();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf.setLength(len&nbsp;&gt;&gt;&nbsp;<span class="number">1</span><span>);&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf_pos&nbsp;=&nbsp;<span class="number">0</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">while</span><span>&nbsp;(</span><span class="number">0</span><span>&nbsp;&lt;&nbsp;len)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf.setCharAt(&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbuf_pos++,&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">char</span><span>)((data[ofs&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;&lt;&lt;&nbsp;</span><span class="number">8</span><span>)&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;(data[ofs&nbsp;+&nbsp;<span class="number">1</span><span>]&nbsp;&amp;&nbsp;</span><span class="number">0x0ff</span><span>)));&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ofs&nbsp;+=&nbsp;<span class="number">2</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;-=&nbsp;<span class="number">2</span><span>;&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;sbuf.toString();&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>}&nbsp;&nbsp;</span></li></ol></div>

  


  <div id="bottoms" class="clearfix">
    
    <div id="share_weibo">分享到：
      <a data-type="sina" href="javascript:;" title="分享到新浪微博" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img src="assets/1571225637-18e900b8666ce6f233d25ec02f95ee59.jpg"></a>
      <a data-type="qq" href="javascript:;" title="分享到腾讯微博" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img src="assets/1571225637-72dd548719f0ace4d5f9bca64e1d7715.jpg"></a>
    </div>
  </div>

  <div class="blog_nav">
    <div class="pre_next">
      <a href="https://www.iteye.com/blog/180521" class="next" title="BattleMoonWars 归档解压/压缩程序 (Java)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">BattleMoonWars 归档解压/压缩程序 (Java ...</a>
      |
      <a href="https://www.iteye.com/blog/180434" class="pre" title="桃華月憚体験版的解压缩程序 (Java)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">桃華月憚体験版的解压缩程序 (Java)</a>
    </div>
  </div>
  <div class="blog_bottom">
    <ul>
      <li>2008-04-08 14:02</li>
      <li>浏览 4042</li>
      <li><a href="#comments">评论(0)</a></li>
      
      
            
      <li class="last"><a href="https://www.iteye.com/wiki/blog/180447" target="_blank" class="more" referrerpolicy="no-referrer" rel="noopener noreferrer">查看更多</a></li>
    </ul>    
  </div>
    
  <div class="blog_comment">
    <h5>评论</h5>
    <a id="comments" name="comments" data-mx-warn="Empty URL"></a>
    
    
    
  </div>

  <div class="blog_comment">
    <h5>发表评论</h5>
            <p style="text-align:center; margin-top:30px;margin-bottom:0px;"><a href="https://www.iteye.com/login" style="background-color: white; --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"> <img src="assets/1571225637-cf6d69dfbb92d2238c3e50c97eb9e7bf.png" style="vertical-align:middle; margin-right: 10px;"></a><a href="https://www.iteye.com/login" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">  您还没有登录,请您登录后再发表评论 </a></p>
      </div>
  </div>
  <div>
    <div style="" id="_mt463rz5db"></div>
    <!-- 多条广告如下脚本只需引入一次 -->
    
  </div>
</div>







      </div></DIV></DIV>
        
      </div>
    </body>
  </html>