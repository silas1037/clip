
  <!DOCTYPE html>
  <html id="" class="">
    <!-- OriginalSrc: https://bbs.sumisora.net/read.php?tid=10978083&fpage=4 -->
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <title>Some about Malie（Dies irae/LIGHT）|【汉化破解研讨室】|【游戏汉化交流区】 - 『澄空学园』 GalGame专题网</title>
      

<link rel="stylesheet" type="text/css" href="assets/1570973869-5f21d2d0f0e14c54e3e080ff47c8ec08.css" referrerpolicy="no-referrer">
<link type="text/css" href="assets/1570973869-2f10d407050ab6b2185fb483267feb32.css" rel="stylesheet" referrerpolicy="no-referrer">
<link href="assets/1570973869-6ea61090578ddc8e91dc9b26707cebc8.css" rel="stylesheet" type="text/css" referrerpolicy="no-referrer">
<link rel="stylesheet" type="text/css" href="assets/1570973869-46d427da9cafb653c4ed606490c99b3a.css" referrerpolicy="no-referrer">


<style class="darkreader darkreader--fallback" media="screen"></style>
<style class="darkreader darkreader--text" media="screen"></style>
<style class="darkreader darkreader--invert" media="screen"></style>
<style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}</style>
<style class="darkreader darkreader--user-agent" media="screen">html {
    background-color: #191a1b !important;
}
html, body, input, textarea, select, button {
    background-color: #191a1b;
}
html, body, input, textarea, select, button {
    border-color: #5a5956;
    color: #f0ebe2;
}
a {
    color: #4791e7;
}
table {
    border-color: #4f4e4c;
}
::placeholder {
    color: #bfb9ac;
}
::selection {
    background-color: #125cb4;
    color: #fffffd;
}
::-moz-selection {
    background-color: #125cb4;
    color: #fffffd;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #565a0f !important;
    color: #f0ebe2 !important;
}
::-webkit-scrollbar {
    background-color: #1d1f1f;
    color: #cbc5b9;
}
::-webkit-scrollbar-thumb {
    background-color: #2c2d2d;
}
::-webkit-scrollbar-thumb:hover {
    background-color: #343636;
}
::-webkit-scrollbar-thumb:active {
    background-color: #404142;
}
::-webkit-scrollbar-corner {
    background-color: #191a1b;
}
* {
    scrollbar-color: #2c2d2d #1d1f1f;
}</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--override" media="screen">.jfk-bubble {
    background-color: #000000 !important;
}
.vimvixen-hint {
    background-color: #765500 !important;
    border-color: #d5b22e !important;
    color: #f9edcc !important;
}</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css"> 
.tr3 td,.tr3 th{border-right:1px solid #D5E5E8;}
.y-style{text-align:center;}
.tr1 th{border-right:1px solid #D5E5E8;}
.tr1 td.td1{border-left:0}
 

.signature img { max-height:250px !important; }
</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css">@keyframes fadeInOpacity{0%{opacity:0}to{opacity:1}}:hover>*>.fbvd--wrapper{animation-name:fadeInOpacity;animation-duration:.3s;opacity:1}.fbvd--wrapper{position:absolute;top:10px;left:10px;opacity:0;text-align:center;margin:0;z-index:5}.fbvd--wrapper a{background: url("") no-repeat 3px 4.55px; background-color: #fff; display:inline-block;font:700 14px Helvetica,Arial,sans-serif;color:#4b4f56;text-decoration:none;vertical-align:middle;padding:0px 8px 0px;margin-right:8px;border-radius:2px; line-height: 22px; padding-left:19px; border: 1px solid #e7e7e7; background-size: 13px}.fbvd--wrapper a:last-child{margin-right:0}.fbvd--wrapper a:hover{text-decoration:none}.fbvd--wrapper a:focus{box-shadow:0 0 1px 2px rgba(88,144,255,.75),0 1px 1px rgba(0,0,0,.15);outline:none}.fbvd--wrapper b{font-size:13px;position:relative;top:1px;color:#3b5998;font-weight:400}</style>
<style class="darkreader darkreader--sync" media="screen"></style>

      <style class="mx-wc-style">
        .mx-wc-main img {max-width: 100%;}
        .mx-wc-main{
          box-sizing: content-box;
          background-color: rgb(25, 26, 27) !important;
          margin: 0 auto;
          margin-top: 20px;
          max-width: 1349px;
        }
        @media (min-width: 768px) {
          .mx-wc-main { padding: 15px 15px 80px 15px }
        }
        @media (max-width: 767px) {
          .mx-wc-main { padding: 15px 3px 80px 3px }
        }
  
      </style>
    </head>
    <body style="background-color: #ffffff !important; min-height: 100%; height: auto; position: static !important; overflow: auto !important; padding-bottom: 0px !important;" id="" class="">
      <div class="mx-wc-main">
        <div id="wrapA" class="mx-wc-selected-elem mx-wc-1570973869" style="display: block; float: none !important; position: relative !important; top: 0px !important; left: 0px !important; margin: 0px !important; flex: unset !important; width: 100% !important; max-width: 100% !important; box-sizing: border-box !important;">

<div id="header">
<div class="toptool tar">	<span>
	<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;fpage=4&amp;skinco=simple" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">手机版</a>

	| <a style="cursor:pointer;" id="td_skin" data-mx-warn="Empty URL">风格切换<img src="assets/1570973869-5c8e409588b73ce4284cf5b9bd619e15.gif"></a>
	| <a href="https://bbs.sumisora.net/read.php?tid=10894912" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">学生手册</a>
	</span>
</div>
<table cellspacing="0" cellpadding="0" align="center" width="100%">
<tbody><tr>
	<td class="banner"><a href="https://bbs.sumisora.net/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img id="forumlogo" src="assets/1570973869-7ac78a0e1e3ce795251288b0c8bd4b1b.png"></a></td>
	<td class="banner" id="banner" align="right"></td>
</tr>
<tr><td align="center" height="1" colspan="2"></td></tr>
</tbody></table>
<div id="h_guide" class="guide" colspan="2"><span class="s3">»</span>

	<span style="font-weight:bold" class="s3">silasu</span>&nbsp;<a href="https://bbs.sumisora.net/login.php?action=quit&amp;verify=034be2bd" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">退出</a> |
	<a id="td_profile" href="https://bbs.sumisora.net/profile.php" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">控制面板</a>
	| <a id="td_msg" href="https://bbs.sumisora.net/message.php" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">

	短消息</a>

	| <a id="td_sort" href="https://bbs.sumisora.net/sort.php" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">统计排行</a>

	| <a href="https://bbs.sumisora.net/member.php" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">会员</a>

	| <a href="https://bbs.sumisora.net/search.php" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">搜索</a>
	| <a style="cursor:pointer;" id="td_hack" data-mx-warn="Empty URL">社区服务<img src="assets/1570973869-5c8e409588b73ce4284cf5b9bd619e15.gif"></a>

	| <a href="https://bbs.sumisora.net/hack.php?H_name=galgamevote" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">GALGAME角色人气投票活动</a>

 | <a href="https://bbs.sumisora.net/yume/polls/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">近期关注</a><!--[if lte IE 6]>
 | <a href="read.php?tid=10955539" style="color:red">本站已停止支持IE6，请升级或更换浏览器</a>
<![endif]-->
</div>



</div>
<div id="main">




<div class="t3" style="margin-top:8px"><table width="100%" cellspacing="0" cellpadding="0" align="center">
	<tbody><tr><td class="b"><img src="assets/1570973869-ca4a91079181c2a5cb3514b2e5b5f035.gif" align="absmiddle"> <a href="https://bbs.sumisora.net/index.php" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">『澄空学园』</a> » <a href="https://bbs.sumisora.net/thread.php?fid=77" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">【游戏汉化交流区】</a> » <a href="https://bbs.sumisora.net/thread.php?fid=78&amp;page=4" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">【汉化破解研讨室】</a> » <a href="https://bbs.sumisora.net/read.php?tid=10978083" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Some about Malie（Dies irae/LIGHT）</a> <a href="https://bbs.sumisora.net/rss.php?tid=10978083" target="_blank" title="Rss订阅本帖最新内容" referrerpolicy="no-referrer" rel="noopener noreferrer"><img align="absmiddle" src="assets/1570973869-b4369735f1bfb33ab69477230a8ba635.png"></a></td></tr>
</tbody></table></div>

<!--ads begin-->

<!--ads end-->
<div class="t3"><table width="100%" align="center" cellspacing="0" cellpadding="0">
	<tbody><tr><td align="left"><div class="fl"></div></td><td align="right" style="padding-bottom:.2em"><a href="https://bbs.sumisora.net/post.php?action=reply&amp;fid=78&amp;tid=10978083" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img src="assets/1570973869-132cb83b134d7ecd9b390389d489bc43.png"></a>

<a href="https://bbs.sumisora.net/post.php?fid=78" style="margin-left:.5em" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img src="assets/1570973869-8cab7ee31ae503cf78e5410d40cec291.png" id="td_post"></a>

</td></tr>
</tbody></table></div>



<form name="delatc" method="post">


<div class="t" style="margin-bottom: 0px; border-bottom: 0px; --darkreader-inline-border-bottom: initial;" data-darkreader-inline-border-bottom=""><table cellspacing="0" cellpadding="0" width="100%">
	<tbody><tr><th class="h"><strong class="fl w"><b>本页主题:</b> Some about Malie（Dies irae/LIGHT）</strong>
	<span class="fr w"><a data-mx-warn="Empty URL">&nbsp;</a><a href="https://bbs.sumisora.net/job.php?action=previous&amp;fid=78&amp;tid=10978083&amp;fpage=4&amp;goto=previous" class="fn" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">上一主题</a> | <a href="https://bbs.sumisora.net/job.php?action=previous&amp;fid=78&amp;tid=10978083&amp;fpage=4&amp;goto=next" class="fn" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">下一主题</a> | <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span> </th>
	</tr>
	<tr><td></td></tr>
	<tr class="tr2"><td colspan="2" class="tar">

		<a id="usetool" style="cursor:pointer" onclick="sendmsg('pw_ajax.php?action=usetool','',this.id)" data-mx-warn="Empty URL">[使用道具]</a>

		<br></td>
	</tr>
	<tr><td></td></tr>
</tbody></table></div>

<a name="tpc" data-mx-warn="Empty URL"></a>
<div class="t t2" style="border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top=""><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>初音拓海</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-80678a1e90de4d0a85fbe524c3d35182.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_0"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空二年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-3699e74cfe4e975552e8db25eb7cc233.gif"><br>

<span class="user-info2" id="showface_0">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">412</span><br>
学分: <span class="s2 f9">11 点</span><br>
澄空币: <span class="s3 f9">674 KID</span><br>

		GPA: <span class="s2 f9">1 点</span><br>

		<span class="gray">注册时间:2009-05-07<br>
		最后登录:2017-06-12 <br><br> 
		<img src="assets/1570973869-d1be6d7f9758587bb010e932f19b099a.gif" title="ピアノの森の満開の下"> <img src="assets/1570973869-15e89d0b08be5c8eefbdfacf3bb9dffd.gif" title="天神乱漫汉化纪念勋章"> <img src="assets/1570973869-0be30e42d981b60e7b1ef013372e2d39.gif" title="V.G.NEO汉化纪念勋章"> <img src="assets/1570973869-cf90ee580aa7aa167980e457d4ade136.gif" title="青空の見える丘汉化纪念勋章"> <img src="assets/1570973869-28c25581c211b3c7aef52d987ff9b722.gif" title="Akabeesoft2主题学部纪念勋章"> <img src="assets/1570973869-073c3b6be58f710904aa8fb76d998d56.gif" title="高町なのは"> <br></span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_tpc" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=tpc&amp;article=0" onclick="return sendurl(this,4,event)" id="quote_tpc" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=tpc&amp;article=0" id="modify_tpc" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=tpc" onclick="return sendurl(this,8)" id="report_tpc" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=284925" title="只看楼主的所有帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('tpc')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_tpc" class="fl">&nbsp;Some about Malie（Dies irae/LIGHT）</h1>
			

			<div id="p_tpc" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_tpc">前几个月帮某大大搞了下light的引擎，被TMA弄得晕头转向之后终于搞定。<br>做一个小笔记玩玩。<br>//Hatsunetakumi@CK<br>//Game：Dies Irae （light2010）<br><b><u>//仅允许发布于：Hatsunetakumi‘s blog/Sumisora</u></b><br><b><span style="color: rgb(255, 0, 0); --darkreader-inline-color:#e63f3c;" data-darkreader-inline-color=""><font size="5">//禁止转载、引用及用于非法用途</font></span></b><br>//唉 最近就没什么好玩的坑么 寂寞<br><br>随便开个lib很容易看到满屏幕乱码，其实可以去找原来老版的light引擎，可以有一定几率发现明文版 - =<br>不过我没什么兴趣，就这样了。<br>其实可以不脱TMA壳的，因为很多代码都封装到了dll中，只要你有兴趣，很容易追到。<br>这不是破解入门教学，所以这些简单东西一概掠过。<br>然后就看这个中二的算法吧。<br>procedure rotate16bytes(offset: DWORD; var cipher1);<br>var<br>shifts: Byte;<br>cipher: PByte;<br>begin<br>cipher := @cipher1;<br>shifts := ((offset shr 4) and $0F) + 16;<br>PDWORD(@cipher[0])^ := LeftRotate(PDWORD(@cipher[0])^, shifts);<br>PDWORD(@cipher[4])^ := RightRotate(PDWORD(@cipher[4])^, shifts);<br>PDWORD(@cipher[8])^ := LeftRotate(PDWORD(@cipher[8])^, shifts);<br>PDWORD(@cipher[12])^ := RightRotate(PDWORD(@cipher[12])^, shifts);<br>end;<br>procedure Read_Cipher(const Buffer: PByte; const cipher: PByte;<br>const offset: DWORD);<br>begin<br>Move(Buffer[offset], cipher[0], 16);<br>end;<br>procedure Write_Plain_Buffer(const Plain_Buffer: PByte; const Plain: PByte;<br>const offset: DWORD);<br>begin<br>Move(Plain[0], Plain_Buffer[offset], 16);<br>end;<br>function Decode_Data_Block(Data_Buffer: PByte; offset: DWORD;<br>Data_Length: DWORD; RawKey: SBCamellia.TSBCamelliaKey): PByte;<br>// Offset -&gt; key<br>var<br>cipher, Plain: PByte;<br>Al_Key, key, i: DWORD;<br>Tmp, Act_Length, cipher_length: DWORD;<br>Plain_Buffer: PByte;<br>offset0: DWORD;<br>Key_Context: TCamelliaContext;<br>Iv: TSBCamelliaBuffer;<br>begin<br>// 一些乱七八糟的操作<br>Move(RawKey[0], Iv[0], 16); // 初始化IV<br>cipher := SysGetMem(32);<br>Plain := SysGetMem(32);<br>Plain_Buffer := SysGetMem(Data_Length);<br>Result := Plain_Buffer;<br>Al_Key := offset and $0F;<br>offset0 := offset - Al_Key;<br>key := (16 - Al_Key) and $0F; // 这个是真实的数据地址<br>offset := 0; // 注意 这里置0 ,加上offset0就是绝对偏移<br>if Al_Key &lt;&gt; 0 then<br>begin<br>Read_Cipher(Data_Buffer, cipher, offset); // 将数据读入临时场所 每次解密前均使用这个函数,这样保证数据仅受offset控制<br>InitializeDecryptionCBC(RawKey, Iv, Key_Context);<br>rotate16bytes(Integer(offset + offset0), cipher[0]); // 这里使用的是绝对偏移<br>Tmp := 16;<br>DecryptCBC(Key_Context, Pointer(@cipher[0]), 16, Pointer(@Plain^), Tmp);<br>FinalizeDecryptionCBC(Key_Context, Pointer(@Plain^), Tmp);<br>if Data_Length &gt; key then<br>Act_Length := key<br>else<br>Act_Length := Data_Length;<br>Move(Plain[Al_Key], Plain_Buffer[0], Act_Length);<br>Data_Length := Data_Length - Act_Length;<br>Inc(offset, 16);<br>end;<br>cipher_length := (Data_Length and not $0F) div 16; // 数据解密次数<br>for i := 0 to cipher_length - 1 do<br>begin<br>Read_Cipher(Data_Buffer, cipher, offset);<br>rotate16bytes(Integer(offset + offset0), cipher[0]);<br>Tmp := 16;<br>InitializeDecryptionCBC(RawKey, Iv, Key_Context);<br>DecryptCBC(Key_Context, Pointer(@cipher[0]), 16,<br>Pointer(@Plain_Buffer[key + i * 16]), Tmp);<br>FinalizeDecryptionCBC(Key_Context, Pointer(@Plain_Buffer[key + i * 16]),<br>Tmp); // 数据被直接写入plainbuffer<br>Inc(offset, 16); // 一次16字节&nbsp;&nbsp;因为每次的原始数据都要进行变换<br>Application.ProcessMessages;<br>end;<br>Al_Key := Data_Length and $0F;<br>if Al_Key &lt;&gt; 0 then<br>begin<br>Read_Cipher(Data_Buffer, cipher, offset);<br>rotate16bytes(Integer(offset + offset0), cipher[0]);<br>Tmp := 16;<br>InitializeDecryptionCBC(RawKey, Iv, Key_Context);<br>DecryptCBC(Key_Context, Pointer(@cipher[0]), 16,<br>@Plain_Buffer[key + cipher_length * 16], Tmp);<br>FinalizeDecryptionCBC(Key_Context,<br>Pointer(@Plain_Buffer[key + cipher_length * 16]), Tmp);<br>end;<br>SysFreeMem(Plain);<br>SysFreeMem(cipher);<br>end;<br>其实很简单，16位对齐用カメリア算法，不过我在写完大部分代码的时候才听说这是カメリア……差点崩溃w。<br>16位对齐带来的问题就像这引擎一样，他需要重新对齐之后计算长度，并且需要对各种情况单独处理，麻烦的很，至于カメリア，我只贴简单的一点东西，完整的请自己去写……<br>procedure EncryptBlock(const InBuf : TSBCamelliaBuffer; out OutBuf : TSBCamelliaBuffer;<br>const Key : TSBCamelliaExpandedKey; LongKey : boolean);<br>var<br>D1, D2, R : TCmInt64;<br>begin<br>D1[0] := InBuf[7] or (InBuf[6] shl 8) or (InBuf[5] shl 16) or (InBuf[4] shl 24);<br>D1[1] := InBuf[3] or (InBuf[2] shl 8) or (InBuf[1] shl 16) or (InBuf[0] shl 24);<br>D2[0] := InBuf[15] or (InBuf[14] shl 8) or (InBuf[13] shl 16) or (InBuf[12] shl 24);<br>D2[1] := InBuf[11] or (InBuf[10] shl 8) or (InBuf[9] shl 16) or (InBuf[8] shl 24);<br>D1[0] := D1[0] xor Key.KW[1 , 0]; D1[1] := D1[1] xor Key.KW[1 , 1];<br>D2[0] := D2[0] xor Key.KW[2 , 0]; D2[1] := D2[1] xor Key.KW[2 , 1];<br>CamelliaF(D1, Key.K[1 ], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[2], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[3], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[4], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[5], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[6], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaFL(D1, Key.KE[1], D1);<br>CamelliaFLInv(D2, Key.KE[2], D2);<br>CamelliaF(D1, Key.K[7], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[8], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[9], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[10], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[11], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[12], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaFL(D1, Key.KE[3], D1);<br>CamelliaFLInv(D2, Key.KE[4], D2);<br>CamelliaF(D1, Key.K[13], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[14], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[15], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[16], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[17], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[18], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>if LongKey then<br>begin<br>CamelliaFL(D1, Key.KE[5], D1);<br>CamelliaFLInv(D2, Key.KE[6], D2);<br>CamelliaF(D1, Key.K[19], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[20], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[21], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[22], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[23], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[24], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>end;<br>D2[0] := D2[0] xor Key.KW[3 , 0]; D2[1] := D2[1] xor Key.KW[3 , 1];<br>D1[0] := D1[0] xor Key.KW[4 , 0]; D1[1] := D1[1] xor Key.KW[4 , 1];<br>{OutBuf[0] := D2[1] shr 24;<br>OutBuf[1] := (D2[1] shr 16) and $ff;<br>OutBuf[2] := (D2[1] shr 8) and $ff;<br>OutBuf[3] := D2[1] and $ff;<br>OutBuf[4] := D2[0] shr 24;<br>OutBuf[5] := (D2[0] shr 16) and $ff;<br>OutBuf[6] := (D2[0] shr 8) and $ff;<br>OutBuf[7] := D2[0] and $ff;<br>OutBuf[8] := D1[1] shr 24;<br>OutBuf[9] := (D1[1] shr 16) and $ff;<br>OutBuf[10] := (D1[1] shr 8) and $ff;<br>OutBuf[11] := D1[1] and $ff;<br>OutBuf[12] := D1[0] shr 24;<br>OutBuf[13] := (D1[0] shr 16) and $ff;<br>OutBuf[14] := (D1[0] shr 8) and $ff;<br>OutBuf[15] := D1[0] and $ff;}<br>OutBuf[0] := D2[1] shr 24;<br>OutBuf[1] := Byte(D2[1] shr 16);<br>OutBuf[2] := Byte(D2[1] shr 8);<br>OutBuf[3] := Byte(D2[1]);<br>OutBuf[4] := D2[0] shr 24;<br>OutBuf[5] := Byte(D2[0] shr 16);<br>OutBuf[6] := Byte(D2[0] shr 8);<br>OutBuf[7] := Byte(D2[0]);<br>OutBuf[8] := D1[1] shr 24;<br>OutBuf[9] := Byte(D1[1] shr 16);<br>OutBuf[10] := Byte(D1[1] shr 8);<br>OutBuf[11] := Byte(D1[1]);<br>OutBuf[12] := D1[0] shr 24;<br>OutBuf[13] := Byte(D1[0] shr 16);<br>OutBuf[14] := Byte(D1[0] shr 8);<br>OutBuf[15] := Byte(D1[0]);<br>end;<br>procedure EncryptBlock(const InBuf : ByteArray; InIndex : integer; var OutBuf : ByteArray;<br>OutIndex : integer; const Key : TSBCamelliaExpandedKey; LongKey : boolean);<br>var<br>D1, D2, R : TCmInt64;<br>begin<br>D1[0] := InBuf[InIndex + 7] or (InBuf[InIndex + 6] shl 8) or (InBuf[InIndex + 5] shl 16) or (InBuf[InIndex + 4] shl 24);<br>D1[1] := InBuf[InIndex + 3] or (InBuf[InIndex + 2] shl 8) or (InBuf[InIndex + 1] shl 16) or (InBuf[InIndex + 0] shl 24);<br>D2[0] := InBuf[InIndex + 15] or (InBuf[InIndex + 14] shl 8) or (InBuf[InIndex + 13] shl 16) or (InBuf[InIndex + 12] shl 24);<br>D2[1] := InBuf[InIndex + 11] or (InBuf[InIndex + 10] shl 8) or (InBuf[InIndex + 9] shl 16) or (InBuf[InIndex + 8] shl 24);<br>D1[0] := D1[0] xor Key.KW[1 , 0]; D1[1] := D1[1] xor Key.KW[1 , 1];<br>D2[0] := D2[0] xor Key.KW[2 , 0]; D2[1] := D2[1] xor Key.KW[2 , 1];<br>CamelliaF(D1, Key.K[1 ], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[2], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[3], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[4], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[5], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[6], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaFL(D1, Key.KE[1], D1);<br>CamelliaFLInv(D2, Key.KE[2], D2);<br>CamelliaF(D1, Key.K[7], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[8], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[9], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[10], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[11], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[12], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaFL(D1, Key.KE[3], D1);<br>CamelliaFLInv(D2, Key.KE[4], D2);<br>CamelliaF(D1, Key.K[13], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[14], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[15], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[16], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[17], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[18], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>if LongKey then<br>begin<br>CamelliaFL(D1, Key.KE[5], D1);<br>CamelliaFLInv(D2, Key.KE[6], D2);<br>CamelliaF(D1, Key.K[19], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[20], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[21], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[22], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>CamelliaF(D1, Key.K[23], R);<br>D2[0] := D2[0] xor R[0]; D2[1] := D2[1] xor R[1];<br>CamelliaF(D2, Key.K[24], R);<br>D1[0] := D1[0] xor R[0]; D1[1] := D1[1] xor R[1];<br>end;<br>D2[0] := D2[0] xor Key.KW[3 , 0]; D2[1] := D2[1] xor Key.KW[3 , 1];<br>D1[0] := D1[0] xor Key.KW[4 , 0]; D1[1] := D1[1] xor Key.KW[4 , 1];<br>OutBuf[OutIndex + 0] := D2[1] shr 24;<br>OutBuf[OutIndex + 1] := (D2[1] shr 16) and $ff;<br>OutBuf[OutIndex + 2] := (D2[1] shr 8) and $ff;<br>OutBuf[OutIndex + 3] := D2[1] and $ff;<br>OutBuf[OutIndex + 4] := D2[0] shr 24;<br>OutBuf[OutIndex + 5] := (D2[0] shr 16) and $ff;<br>OutBuf[OutIndex + 6] := (D2[0] shr 8) and $ff;<br>OutBuf[OutIndex + 7] := D2[0] and $ff;<br>OutBuf[OutIndex + 8] := D1[1] shr 24;<br>OutBuf[OutIndex + 9] := (D1[1] shr 16) and $ff;<br>OutBuf[OutIndex + 10] := (D1[1] shr 8) and $ff;<br>OutBuf[OutIndex + 11] := D1[1] and $ff;<br>OutBuf[OutIndex + 12] := D1[0] shr 24;<br>OutBuf[OutIndex + 13] := (D1[0] shr 16) and $ff;<br>OutBuf[OutIndex + 14] := (D1[0] shr 8) and $ff;<br>OutBuf[OutIndex + 15] := D1[0] and $ff;<br>end;<br>少数代码参考了CRASS，手头有一个SECB，就用了其中的部分函数。<br>主体以及Camellia是我自己写的，调试了N长时间啊……<br>可能有些人懒得打字，于是把SBOX也贴出来，这玩意就是看起来恶心而已。<br>SBOX1 : array [0..255] of byte =<br>(<br>$70, $82, $2C, $EC, $B3, $27, $C0, $E5, $E4, $85, $57, $35, $EA, $0C, $AE, $41,<br>$23, $EF, $6B, $93, $45, $19, $A5, $21, $ED, $0E, $4F, $4E, $1D, $65, $92, $BD,<br>$86, $B8, $AF, $8F, $7C, $EB, $1F, $CE, $3E, $30, $DC, $5F, $5E, $C5, $0B, $1A,<br>$A6, $E1, $39, $CA, $D5, $47, $5D, $3D, $D9, $01, $5A, $D6, $51, $56, $6C, $4D,<br>$8B, $0D, $9A, $66, $FB, $CC, $B0, $2D, $74, $12, $2B, $20, $F0, $B1, $84, $99,<br>$DF, $4C, $CB, $C2, $34, $7E, $76, $05, $6D, $B7, $A9, $31, $D1, $17, $04, $D7,<br>$14, $58, $3A, $61, $DE, $1B, $11, $1C, $32, $0F, $9C, $16, $53, $18, $F2, $22,<br>$FE, $44, $CF, $B2, $C3, $B5, $7A, $91, $24, $08, $E8, $A8, $60, $FC, $69, $50,<br>$AA, $D0, $A0, $7D, $A1, $89, $62, $97, $54, $5B, $1E, $95, $E0, $FF, $64, $D2,<br>$10, $C4, $00, $48, $A3, $F7, $75, $DB, $8A, $03, $E6, $DA, $09, $3F, $DD, $94,<br>$87, $5C, $83, $02, $CD, $4A, $90, $33, $73, $67, $F6, $F3, $9D, $7F, $BF, $E2,<br>$52, $9B, $D8, $26, $C8, $37, $C6, $3B, $81, $96, $6F, $4B, $13, $BE, $63, $2E,<br>$E9, $79, $A7, $8C, $9F, $6E, $BC, $8E, $29, $F5, $F9, $B6, $2F, $FD, $B4, $59,<br>$78, $98, $06, $6A, $E7, $46, $71, $BA, $D4, $25, $AB, $42, $88, $A2, $8D, $FA,<br>$72, $07, $B9, $55, $F8, $EE, $AC, $0A, $36, $49, $2A, $68, $3C, $38, $F1, $A4,<br>$40, $28, $D3, $7B, $BB, $C9, $43, $C1, $15, $E3, $AD, $F4, $77, $C7, $80, $9E<br>);<br>SBOX2 : array [0..255] of byte =<br>(<br>$E0, $05, $58, $D9, $67, $4E, $81, $CB, $C9, $0B, $AE, $6A, $D5, $18, $5D, $82,<br>$46, $DF, $D6, $27, $8A, $32, $4B, $42, $DB, $1C, $9E, $9C, $3A, $CA, $25, $7B,<br>$0D, $71, $5F, $1F, $F8, $D7, $3E, $9D, $7C, $60, $B9, $BE, $BC, $8B, $16, $34,<br>$4D, $C3, $72, $95, $AB, $8E, $BA, $7A, $B3, $02, $B4, $AD, $A2, $AC, $D8, $9A,<br>$17, $1A, $35, $CC, $F7, $99, $61, $5A, $E8, $24, $56, $40, $E1, $63, $09, $33,<br>$BF, $98, $97, $85, $68, $FC, $EC, $0A, $DA, $6F, $53, $62, $A3, $2E, $08, $AF,<br>$28, $B0, $74, $C2, $BD, $36, $22, $38, $64, $1E, $39, $2C, $A6, $30, $E5, $44,<br>$FD, $88, $9F, $65, $87, $6B, $F4, $23, $48, $10, $D1, $51, $C0, $F9, $D2, $A0,<br>$55, $A1, $41, $FA, $43, $13, $C4, $2F, $A8, $B6, $3C, $2B, $C1, $FF, $C8, $A5,<br>$20, $89, $00, $90, $47, $EF, $EA, $B7, $15, $06, $CD, $B5, $12, $7E, $BB, $29,<br>$0F, $B8, $07, $04, $9B, $94, $21, $66, $E6, $CE, $ED, $E7, $3B, $FE, $7F, $C5,<br>$A4, $37, $B1, $4C, $91, $6E, $8D, $76, $03, $2D, $DE, $96, $26, $7D, $C6, $5C,<br>$D3, $F2, $4F, $19, $3F, $DC, $79, $1D, $52, $EB, $F3, $6D, $5E, $FB, $69, $B2,<br>$F0, $31, $0C, $D4, $CF, $8C, $E2, $75, $A9, $4A, $57, $84, $11, $45, $1B, $F5,<br>$E4, $0E, $73, $AA, $F1, $DD, $59, $14, $6C, $92, $54, $D0, $78, $70, $E3, $49,<br>$80, $50, $A7, $F6, $77, $93, $86, $83, $2A, $C7, $5B, $E9, $EE, $8F, $01, $3D<br>);<br>SBOX3 : array [0..255] of byte =<br>(<br>$38, $41, $16, $76, $D9, $93, $60, $F2, $72, $C2, $AB, $9A, $75, $06, $57, $A0,<br>$91, $F7, $B5, $C9, $A2, $8C, $D2, $90, $F6, $07, $A7, $27, $8E, $B2, $49, $DE,<br>$43, $5C, $D7, $C7, $3E, $F5, $8F, $67, $1F, $18, $6E, $AF, $2F, $E2, $85, $0D,<br>$53, $F0, $9C, $65, $EA, $A3, $AE, $9E, $EC, $80, $2D, $6B, $A8, $2B, $36, $A6,<br>$C5, $86, $4D, $33, $FD, $66, $58, $96, $3A, $09, $95, $10, $78, $D8, $42, $CC,<br>$EF, $26, $E5, $61, $1A, $3F, $3B, $82, $B6, $DB, $D4, $98, $E8, $8B, $02, $EB,<br>$0A, $2C, $1D, $B0, $6F, $8D, $88, $0E, $19, $87, $4E, $0B, $A9, $0C, $79, $11,<br>$7F, $22, $E7, $59, $E1, $DA, $3D, $C8, $12, $04, $74, $54, $30, $7E, $B4, $28,<br>$55, $68, $50, $BE, $D0, $C4, $31, $CB, $2A, $AD, $0F, $CA, $70, $FF, $32, $69,<br>$08, $62, $00, $24, $D1, $FB, $BA, $ED, $45, $81, $73, $6D, $84, $9F, $EE, $4A,<br>$C3, $2E, $C1, $01, $E6, $25, $48, $99, $B9, $B3, $7B, $F9, $CE, $BF, $DF, $71,<br>$29, $CD, $6C, $13, $64, $9B, $63, $9D, $C0, $4B, $B7, $A5, $89, $5F, $B1, $17,<br>$F4, $BC, $D3, $46, $CF, $37, $5E, $47, $94, $FA, $FC, $5B, $97, $FE, $5A, $AC,<br>$3C, $4C, $03, $35, $F3, $23, $B8, $5D, $6A, $92, $D5, $21, $44, $51, $C6, $7D,<br>$39, $83, $DC, $AA, $7C, $77, $56, $05, $1B, $A4, $15, $34, $1E, $1C, $F8, $52,<br>$20, $14, $E9, $BD, $DD, $E4, $A1, $E0, $8A, $F1, $D6, $7A, $BB, $E3, $40, $4F<br>);<br>SBOX4 : array [0..255] of byte =<br>(<br>$70, $2C, $B3, $C0, $E4, $57, $EA, $AE, $23, $6B, $45, $A5, $ED, $4F, $1D, $92,<br>$86, $AF, $7C, $1F, $3E, $DC, $5E, $0B, $A6, $39, $D5, $5D, $D9, $5A, $51, $6C,<br>$8B, $9A, $FB, $B0, $74, $2B, $F0, $84, $DF, $CB, $34, $76, $6D, $A9, $D1, $04,<br>$14, $3A, $DE, $11, $32, $9C, $53, $F2, $FE, $CF, $C3, $7A, $24, $E8, $60, $69,<br>$AA, $A0, $A1, $62, $54, $1E, $E0, $64, $10, $00, $A3, $75, $8A, $E6, $09, $DD,<br>$87, $83, $CD, $90, $73, $F6, $9D, $BF, $52, $D8, $C8, $C6, $81, $6F, $13, $63,<br>$E9, $A7, $9F, $BC, $29, $F9, $2F, $B4, $78, $06, $E7, $71, $D4, $AB, $88, $8D,<br>$72, $B9, $F8, $AC, $36, $2A, $3C, $F1, $40, $D3, $BB, $43, $15, $AD, $77, $80,<br>$82, $EC, $27, $E5, $85, $35, $0C, $41, $EF, $93, $19, $21, $0E, $4E, $65, $BD,<br>$B8, $8F, $EB, $CE, $30, $5F, $C5, $1A, $E1, $CA, $47, $3D, $01, $D6, $56, $4D,<br>$0D, $66, $CC, $2D, $12, $20, $B1, $99, $4C, $C2, $7E, $05, $B7, $31, $17, $D7,<br>$58, $61, $1B, $1C, $0F, $16, $18, $22, $44, $B2, $B5, $91, $08, $A8, $FC, $50,<br>$D0, $7D, $89, $97, $5B, $95, $FF, $D2, $C4, $48, $F7, $DB, $03, $DA, $3F, $94,<br>$5C, $02, $4A, $33, $67, $F3, $7F, $E2, $9B, $26, $37, $3B, $96, $4B, $BE, $2E,<br>$79, $8C, $6E, $8E, $F5, $B6, $FD, $59, $98, $6A, $46, $BA, $25, $42, $A2, $FA,<br>$07, $55, $EE, $0A, $49, $68, $38, $A4, $28, $7B, $C9, $C1, $E3, $F4, $C7, $9E<br>);<br>ok，基本思路知道了，然后我们来分析结构。<br>一下选自我的源代码<br>const<br>Memory_Buffer_Max_Size: DWORD = $400000; // 最大使用4MB Buffer<br>Type<br>Pack_Head = Packed Record<br>Magic: array [0 .. 3] of AnsiChar;<br>Version: DWORD;<br>Entries_Count: DWORD;<br>Reserved: DWORD;<br>End;<br>Lib_Pack_Entries = Record // 2b<br>File_name: Array [0 .. 35] of AnsiChar;<br>Length: DWORD;<br>START_OFFSET: DWORD;<br>Reserved: DWORD;<br>End;<br>其实没什么难度……感觉很清晰，不过这个length可能不容易确认，因为它比较恶心，时时刻刻都要记得这破引擎需要对齐就没问题了。<br>接着我们来看看图像，这个很恶心的<br>type<br>Mgf_Pack_Head = Packed Record<br>Magic: array [0 .. 7 + 5] of AnsiChar;<br>End;<br>const<br>Png_Header: array [0 .. 7] of AnsiChar = (#$89, 'P', 'N', 'G', #$0D, #$0A,<br>#$1A, #$0A);<br>图像有且只有2种方式，offset 0&amp;6，我不知道为什么，也懒的再去找代码，总之这样写可以回封。<br>code：<br>if SameText(Mgf.Magic, 'MalieGF') then<br>begin<br>Move(Png_Header[0], TempBuffer[0], 8);<br>Ext := '.png';<br>END<br>else<br>begin<br>Move(TempBuffer[6], Mgf.Magic[0], 8);<br>if SameText(Mgf.Magic, 'MalieGF') then<br>begin<br>rs_offset := 6;<br>Move(Png_Header[0], TempBuffer[6], 8);<br>Ext := '.Type2.png';<br>end;<br>end;<br>这就是全部，至于文本的加密，那个交给了Z大，不知他会不会来分析一下w。<br>我稍稍看了下，应该是ZLIB压缩的，外面还有一层TMA，新游戏的难度将会更大吧。总之我应该不会再继续搞这玩意了。（笑）<br>下面来想想回封的事情吧，其实很简单，反过来写，注意对齐，我这里给出一部分代码：<br>procedure rotate16bytes_enc(offset: DWORD; var cipher1);<br>var<br>shifts: Byte;<br>cipher: PByte;<br>begin<br>cipher := @cipher1;<br>shifts := ((offset shr 4) and $0F) + 16;<br>PDWORD(@cipher[0])^ := RightRotate(PDWORD(@cipher[0])^, shifts);<br>PDWORD(@cipher[4])^ := LeftRotate(PDWORD(@cipher[4])^, shifts);<br>PDWORD(@cipher[8])^ := RightRotate(PDWORD(@cipher[8])^, shifts);<br>PDWORD(@cipher[12])^ := LeftRotate(PDWORD(@cipher[12])^, shifts);<br>end;<br>function Encode_Data_Block(Data_Buffer: PByte; offset: DWORD;<br>Data_Length: DWORD; RawKey: SBCamellia.TSBCamelliaKey): PByte;<br>// Offset -&gt; key<br>var<br>cipher, Plain: PByte;<br>Al_Key, key, i: DWORD;<br>Tmp, Act_Length, cipher_length: DWORD;<br>Plain_Buffer: PByte;<br>offset0: DWORD;<br>Key_Context: TCamelliaContext;<br>Iv: TSBCamelliaBuffer;<br>begin<br>// 一些乱七八糟的操作<br>Move(RawKey[0], Iv[0], 16); // 初始化IV<br>cipher := SysGetMem(32);<br>Plain := SysGetMem(32);<br>Plain_Buffer := SysGetMem(Data_Length);<br>Result := Plain_Buffer;<br>Al_Key := offset and $0F;<br>offset0 := offset - Al_Key;<br>key := (16 - Al_Key) and $0F; // 这个是真实的数据地址<br>offset := 0; // 注意 这里置0 ,加上offset0就是绝对偏移<br>if Al_Key &lt;&gt; 0 then<br>begin<br>Read_Cipher(Data_Buffer, cipher, offset);<br>InitializeEncryptionCBC(RawKey, Iv, Key_Context);<br>Tmp := 16;<br>EncryptCBC(Key_Context, Pointer(@cipher[0]), 16, Pointer(@Plain^), Tmp);<br>FinalizeEncryptionCBC(Key_Context, Pointer(@Plain^), Tmp);<br>rotate16bytes_enc(Integer(offset + offset0), Plain[0]); // 这里使用的是绝对偏移<br>if Data_Length &gt; key then<br>Act_Length := key<br>else<br>Act_Length := Data_Length;<br>Move(Plain[Al_Key], Plain_Buffer[0], Act_Length);<br>Data_Length := Data_Length - Act_Length;<br>Inc(offset, 16);<br>end;<br>cipher_length := (Data_Length and not $0F) div 16; // 数据解密次数<br>for i := 0 to cipher_length - 1 do<br>begin<br>Read_Cipher(Data_Buffer, cipher, offset);<br>Tmp := 16;<br>InitializeEncryptionCBC(RawKey, Iv, Key_Context);<br>EncryptCBC(Key_Context, Pointer(@cipher[0]), 16,<br>Pointer(@Plain_Buffer[key + i * 16]), Tmp);<br>FinalizeEncryptionCBC(Key_Context, Pointer(@Plain_Buffer[key + i * 16]),<br>Tmp); // 数据被直接写入plainbuffer<br>rotate16bytes_enc(Integer(offset + offset0), Plain_Buffer[key + i * 16]);<br>Inc(offset, 16); // 一次16字节&nbsp;&nbsp;因为每次的原始数据都要进行变换<br>Application.ProcessMessages;<br>end;<br>Al_Key := Data_Length and $0F;<br>if Al_Key &lt;&gt; 0 then<br>begin<br>Read_Cipher(Data_Buffer, cipher, offset);<br>Tmp := 16;<br>InitializeEncryptionCBC(RawKey, Iv, Key_Context);<br>EncryptCBC(Key_Context, Pointer(@cipher[0]), 16,<br>@Plain_Buffer[key + cipher_length * 16], Tmp);<br>FinalizeEncryptionCBC(Key_Context,<br>Pointer(@Plain_Buffer[key + cipher_length * 16]), Tmp);<br>rotate16bytes_enc(Integer(offset + offset0),<br>Plain_Buffer[key + cipher_length * 16]);<br>end;<br>SysFreeMem(Plain);<br>SysFreeMem(cipher);<br>end;<br>这个就是pack了，很简单的样子，不过entries可没那么简单，我调试了2天才弄好：<br>for i := 1 to FileList.Count - 1 do<br>begin<br>hdl_File_Handle := fileopen(FileList<i>, fmopenread);<br>entries<i>.Length := FileSeek(hdl_File_Handle, 0, 2);<br>FileSeek(hdl_File_Handle, 0, 0);<br>entries<i>.START_OFFSET := TempBuffer.Position;<br>rs_offset := entries<i>.START_OFFSET and $0F;<br>rs_length := ((entries<i>.Length + rs_offset) + 15) and (Not $0F);<br>Data_Stream := SysGetMem(rs_length);<br>FileRead(hdl_File_Handle, Data_Stream[rs_offset], entries<i>.Length);<br>fileclose(hdl_File_Handle);<br>Plain := Encode_Data_Block(Data_Stream, entries<i>.START_OFFSET,<br>rs_length, RawKey);<br>TempBuffer.Write(Plain[0], rs_length);<br>SysFreeMem(Data_Stream);<br>// FileList<i>:=ChangeFileExt(FileList<i>,'');<br>FileList<i> := rightStr(FileList<i>, Length(FileList<i>) - PathLength);<br>Move(PByte(FileList<i>)^, entries<i>.File_name[0],<br>Length(FileList<i>) * 2);<br>Tmp := rs_length;<br>entries<i>.Reserved := 0;<br>Form1.pb2.StepIt;<br>SysFreeMem(Plain);<br>Application.ProcessMessages;<br>end;<br>这个封回去你会发现一些稍稍的诡异之处，我就不多解释了w，有兴趣的自己看。<br>最后造福一下delphi众，把light用过的key贴出来：（不包括最新的某足x作）<br>const<br>orig_key1: array [0 .. 15] of Byte = ($FD, $FE, $FF, $00, $F9, $FA, $FB, $FC,<br>$F5, $F6, $F7, $F8, $F1, $F2, $F3, $F4);<br>orig_key2: array [0 .. 15] of Byte = ($AC, $CA, $8B, $96, $9A, $8F, $C7, $99,<br>$AA, $AE, $88, $AF, $9D, $A9, $A8, $B6);<br>orig_key3: array [0 .. 15] of Byte = ($AF, $B3, $CA, $CB, $8A, $92, $B9, $8B,<br>$BE, $B5, $91, $9D, $BA, $AB, $B4, $B8);<br>orig_key4: array [0 .. 15] of Byte = ($B2, $95, $CC, $AA, $BD, $BB, $C9, $86,<br>$A8, $AC, $CD, $D0, $8A, $B1, $A6, $B4);<br>orig_key5: array [0 .. 15] of Byte = ($AF, $B3, $CA, $CB, $8A, $92, $B9, $8B,<br>$BE, $B5, $91, $9D, $BA, $AB, $B4, $B8);<br>orig_key6: array [0 .. 15] of Byte = ($8F, $9D, $B9, $9E, $94, $AF, $AD, $BB,<br>$9C, $A8, $8B, $92, $9F, $B3, $97, $BA);<br>这一组均选自crass，本人没有发现这些key。<br>最后提一句，diesirae的key是全0，自己试下就知道。</i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></i></div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_tpc" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2010-10-17 18:16 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 楼主(初音拓海) 的帖子');" data-mx-warn="Empty URL">[楼 主]</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="3967759" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>xiayuanzhong</b>
<div style="margin:.3em 0 .4em .2em">CROSS†CHANNEL完整汉化补丁已经发布！</div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=455755" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-61d230ead156bb08581da82035c0cd3f.png" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_1"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空一年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-f43195cd588caa26c296fcc61910b3e6.gif"><br>

<span class="user-info2" id="showface_1">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">121</span><br>
学分: <span class="s2 f9">0 点</span><br>
澄空币: <span class="s3 f9">419 KID</span><br>

		GPA: <span class="s2 f9">0 点</span><br>

		<span class="gray">注册时间:2010-07-05<br>
		最后登录:2019-04-20 <br><br> 
		</span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_3967759" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=3967759&amp;article=1" onclick="return sendurl(this,4,event)" id="quote_3967759" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=3967759&amp;article=1" id="modify_3967759" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=455755" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=3967759" onclick="return sendurl(this,8)" id="report_3967759" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=455755" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('3967759')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_3967759" class="fl">&nbsp;</h1>
			

			<div id="p_3967759" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_3967759">极品！！！<br>我就喜欢高手的分析！！<br>while( 1 ) 人品++;</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_3967759" class="c"></div>

		<div><img class="signature" src="assets/1570973869-f23b8ffd0b6b327441aa828c9cd3243d.gif" align="absbottom"></div>
		<div class="signature" style="max-height:380px;maxHeight:380px; overflow:hidden;"><table width="100%"><tbody><tr><td>CROSS†CHANNEL 原版 &amp; 复刻版 汉化 项目：<br>汉化组博客：crosschannel.cn<br>欢迎大家关注！~《少女们向荒野进发》同样欢迎大家~~</td><td></td></tr></tbody></table></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2011-04-23 12:03 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 1楼(xiayuanzhong) 的帖子');" data-mx-warn="Empty URL">1 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5416321" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>bingkan</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-fe8ef3331f97b66ca7156370f35bcf33.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_2"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空一年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-f43195cd588caa26c296fcc61910b3e6.gif"><br>

<span class="user-info2" id="showface_2">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">53</span><br>
学分: <span class="s2 f9">0 点</span><br>
澄空币: <span class="s3 f9">599 KID</span><br>

		GPA: <span class="s2 f9">0 点</span><br>

		<span class="gray">注册时间:2012-02-02<br>
		最后登录:2014-06-29 <br><br> 
		</span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5416321" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5416321&amp;article=2" onclick="return sendurl(this,4,event)" id="quote_5416321" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5416321&amp;article=2" id="modify_5416321" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5416321" onclick="return sendurl(this,8)" id="report_5416321" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=735425" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5416321')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5416321" class="fl">&nbsp;</h1>
			

			<div id="p_5416321" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5416321">关于这个lib，有些问题想请教一下：<br>初音大的源码我基本看不懂，只会一些C++。<br>看了下crass的源码，解包过程大概就是先做camellia解密，得到标准的LIBU文件头的lib包，然后再对它解包。<br>那么我的问题是这样，camellia源码只有三个函数，一个用来转换Key，可忽视之，剩下一个是加密一个是解密。<br>那么怎么获得解密的Key呢？<br>只要把加密的lib解密为标准的libu剩下的就简单了。<br>还有，crass在解密之前，调用了一下static void rotate16bytes(u32 offset, DWORD *cipher)这个函数，这是在干嘛呢？<br>这游戏文本的部分找到key之后直接就能按块解密，再zlib解压就完事了，加密也是如此。<br>可这lib包搞得我乳酸蛋疼。</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5416321" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-10-21 20:05 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 2楼(bingkan) 的帖子');" data-mx-warn="Empty URL">2 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5416341" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>初音拓海</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-80678a1e90de4d0a85fbe524c3d35182.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_3"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空二年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-3699e74cfe4e975552e8db25eb7cc233.gif"><br>

<span class="user-info2" id="showface_3">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">412</span><br>
学分: <span class="s2 f9">11 点</span><br>
澄空币: <span class="s3 f9">674 KID</span><br>

		GPA: <span class="s2 f9">1 点</span><br>

		<span class="gray">注册时间:2009-05-07<br>
		最后登录:2017-06-12 <br><br> 
		<img src="assets/1570973869-d1be6d7f9758587bb010e932f19b099a.gif" title="ピアノの森の満開の下"> <img src="assets/1570973869-15e89d0b08be5c8eefbdfacf3bb9dffd.gif" title="天神乱漫汉化纪念勋章"> <img src="assets/1570973869-0be30e42d981b60e7b1ef013372e2d39.gif" title="V.G.NEO汉化纪念勋章"> <img src="assets/1570973869-cf90ee580aa7aa167980e457d4ade136.gif" title="青空の見える丘汉化纪念勋章"> <img src="assets/1570973869-28c25581c211b3c7aef52d987ff9b722.gif" title="Akabeesoft2主题学部纪念勋章"> <img src="assets/1570973869-073c3b6be58f710904aa8fb76d998d56.gif" title="高町なのは"> <br></span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5416341" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5416341&amp;article=3" onclick="return sendurl(this,4,event)" id="quote_5416341" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5416341&amp;article=3" id="modify_5416341" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5416341" onclick="return sendurl(this,8)" id="report_5416341" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=284925" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5416341')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5416341" class="fl">&nbsp;</h1>
			

			<div id="p_5416341" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5416341"><h6 class="quote">Quote:</h6><blockquote class="blockquote">引用第2楼bingkan于2012-10-21 20:05发表的&nbsp;&nbsp;:<br>关于这个lib，有些问题想请教一下：<br>初音大的源码我基本看不懂，只会一些C++。<br>看了下crass的源码，解包过程大概就是先做camellia解密，得到标准的LIBU文件头的lib包，然后再对它解包。<br>那么我的问题是这样，camellia源码只有三个函数，一个用来转换Key，可忽视之，剩下一个是加密一个是解密。<br>那么怎么获得解密的Key呢？<br>.......</blockquote><br><br>回头看这帖子已经两年了<br>那个时候的自己好2啊w<br><br>解密key写在exe里，自从dies irae的之后就标配alphadisc（tma壳）了，需要激活后脱壳，目前的通用方法可以勉强对付<br>游戏跟进至kaminoyo 之后的游戏未知<br><br><br>shift是从raw key产生加密用cipher，保证对每个文件都是不同的key。像这样<br>rotate16bytes(Integer(offset + offset0), cipher[0]);<br>这样产生的cipher直接仍进kameria解密函数即可</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5416341" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-10-21 20:27 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 3楼(初音拓海) 的帖子');" data-mx-warn="Empty URL">3 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5418106" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>bingkan</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-fe8ef3331f97b66ca7156370f35bcf33.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_4"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空一年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-f43195cd588caa26c296fcc61910b3e6.gif"><br>

<span class="user-info2" id="showface_4">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">53</span><br>
学分: <span class="s2 f9">0 点</span><br>
澄空币: <span class="s3 f9">599 KID</span><br>

		GPA: <span class="s2 f9">0 点</span><br>

		<span class="gray">注册时间:2012-02-02<br>
		最后登录:2014-06-29 <br><br> 
		</span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5418106" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5418106&amp;article=4" onclick="return sendurl(this,4,event)" id="quote_5418106" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5418106&amp;article=4" id="modify_5418106" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5418106" onclick="return sendurl(this,8)" id="report_5418106" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=735425" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5418106')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5418106" class="fl">&nbsp;</h1>
			

			<div id="p_5418106" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5418106">时隔两年竟然出现了~！<img src="assets/1570973869-43f31d94785b2592a825b3775f92cc2a.gif"><br>不过渣渣我还是没搞定。camellia解密不是以CAMELLIA_BLOCK_SIZE为单位的吗？整个文件包都已经加密，还能算出每个文件的大小吗？要怎样算出呢？另外怎么保证对每个文件都是不同的key？<br><br>还有alphadisk和alphaRom是不是同一种壳？<img src="assets/1570973869-7ca0e2c96d22ed4b82fa7e59ccab8be1.gif"></div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5418106" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-10-24 21:33 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 4楼(bingkan) 的帖子');" data-mx-warn="Empty URL">4 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5418684" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>初音拓海</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-80678a1e90de4d0a85fbe524c3d35182.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_5"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空二年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-3699e74cfe4e975552e8db25eb7cc233.gif"><br>

<span class="user-info2" id="showface_5">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">412</span><br>
学分: <span class="s2 f9">11 点</span><br>
澄空币: <span class="s3 f9">674 KID</span><br>

		GPA: <span class="s2 f9">1 点</span><br>

		<span class="gray">注册时间:2009-05-07<br>
		最后登录:2017-06-12 <br><br> 
		<img src="assets/1570973869-d1be6d7f9758587bb010e932f19b099a.gif" title="ピアノの森の満開の下"> <img src="assets/1570973869-15e89d0b08be5c8eefbdfacf3bb9dffd.gif" title="天神乱漫汉化纪念勋章"> <img src="assets/1570973869-0be30e42d981b60e7b1ef013372e2d39.gif" title="V.G.NEO汉化纪念勋章"> <img src="assets/1570973869-cf90ee580aa7aa167980e457d4ade136.gif" title="青空の見える丘汉化纪念勋章"> <img src="assets/1570973869-28c25581c211b3c7aef52d987ff9b722.gif" title="Akabeesoft2主题学部纪念勋章"> <img src="assets/1570973869-073c3b6be58f710904aa8fb76d998d56.gif" title="高町なのは"> <br></span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5418684" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5418684&amp;article=5" onclick="return sendurl(this,4,event)" id="quote_5418684" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5418684&amp;article=5" id="modify_5418684" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5418684" onclick="return sendurl(this,8)" id="report_5418684" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=284925" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5418684')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5418684" class="fl">&nbsp;</h1>
			

			<div id="p_5418684" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5418684"><h6 class="quote">Quote:</h6><blockquote class="blockquote">引用第4楼bingkan于2012-10-24 21:33发表的&nbsp;&nbsp;:<br>时隔两年竟然出现了~！<img src="assets/1570973869-43f31d94785b2592a825b3775f92cc2a.gif"><br>不过渣渣我还是没搞定。camellia解密不是以CAMELLIA_BLOCK_SIZE为单位的吗？整个文件包都已经加密，还能算出每个文件的大小吗？要怎样算出呢？另外怎么保证对每个文件都是不同的key？<br><br>还有alphadisk和alphaRom是不是同一种壳？<img src="assets/1570973869-7ca0e2c96d22ed4b82fa7e59ccab8be1.gif"></blockquote><br><br><br>这个游戏的数据都是按照BLOCK_SIZE对齐过的，文件头和index解出来后就可以看到文件大小和偏移了<br>解的时候放心读就行，后面有冗余数据填充<br>建议先找已知key的游戏看看结构再分析新的<br><br>可以看到shift_key函数和offset有关啊，每个文件的offset不一样自然算出来的key是不一样的<br>当然，对于什么东西都写在exe里的游戏，这些都没什么大的意义。<br><br>壳就是themida，现在有通用办法解决它</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5418684" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-10-25 20:08 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 5楼(初音拓海) 的帖子');" data-mx-warn="Empty URL">5 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5419113" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>bingkan</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-fe8ef3331f97b66ca7156370f35bcf33.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_6"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空一年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-f43195cd588caa26c296fcc61910b3e6.gif"><br>

<span class="user-info2" id="showface_6">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">53</span><br>
学分: <span class="s2 f9">0 点</span><br>
澄空币: <span class="s3 f9">599 KID</span><br>

		GPA: <span class="s2 f9">0 点</span><br>

		<span class="gray">注册时间:2012-02-02<br>
		最后登录:2014-06-29 <br><br> 
		</span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5419113" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5419113&amp;article=6" onclick="return sendurl(this,4,event)" id="quote_5419113" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5419113&amp;article=6" id="modify_5419113" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5419113" onclick="return sendurl(this,8)" id="report_5419113" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=735425" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5419113')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5419113" class="fl">&nbsp;</h1>
			

			<div id="p_5419113" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5419113"><h6 class="quote">Quote:</h6><blockquote class="blockquote">引用第5楼初音拓海于2012-10-25 20:08发表的&nbsp;&nbsp;:<br><br><br><br>这个游戏的数据都是按照BLOCK_SIZE对齐过的，文件头和index解出来后就可以看到文件大小和偏移了<br>解的时候放心读就行，后面有冗余数据填充<br>.......</blockquote><br><br><br>改了下crass的源码，之后解成了这样：<br><a href="http://tieba.baidu.com/p/1733454202" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">http://tieba.baidu.com/p/1733454202</a><br>总的索引还好，下面分目录的索引就乱糟糟了。<br><br><br>肯定是对其找的不对。这几个函数看的还不是很明白，我再研究下。不过目前这样好像也能解包的样子~W~<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (aligned) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (pkg-&gt;pio-&gt;readvec(pkg, cipher, sizeof(cipher), offset, IO_SEEK_SET))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -CUI_EREADVEC;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotate16bytes((unsigned int)pkg-&gt;fior-&gt;base_offset + offset, (DWORD *)cipher);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Camellia_DecryptBlock(128, cipher, keyTable, plain);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD act_data_len = data_len &gt; data_offset ? data_offset : data_len;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(data, plain + aligned, act_data_len);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data_len -= act_data_len;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!data_len)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset += 16;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD cipher_len = data_len &amp; ~0xf;<br>&nbsp;&nbsp;&nbsp;&nbsp;BYTE *_cipher = data + data_offset;<br>&nbsp;&nbsp;&nbsp;&nbsp;if (pkg-&gt;pio-&gt;readvec(pkg, _cipher, cipher_len, offset, IO_SEEK_SET))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -CUI_EREADVEC;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;cipher_len /= 16;<br>&nbsp;&nbsp;&nbsp;&nbsp;for (DWORD i = 0; i &lt; cipher_len; ++i) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotate16bytes((unsigned int)pkg-&gt;fior-&gt;base_offset + offset, (DWORD *)_cipher);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Camellia_DecryptBlock(128, _cipher, keyTable, plain);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(_cipher, plain, 16);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_cipher += 16;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset += 16;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;aligned = data_len &amp; 0xf;<br>&nbsp;&nbsp;&nbsp;&nbsp;if (aligned) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (pkg-&gt;pio-&gt;readvec(pkg, cipher, 16, offset, IO_SEEK_SET))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -CUI_EREADVEC;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotate16bytes((unsigned int)pkg-&gt;fior-&gt;base_offset + offset, (DWORD *)cipher);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Camellia_DecryptBlock(128, cipher, keyTable, plain);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(_cipher, plain, aligned);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>尤其是pkg-&gt;fior-&gt;base_offset 不知怎么确定，真是蛋疼无比<img src="assets/1570973869-43f31d94785b2592a825b3775f92cc2a.gif"><div id="alert_5419113" style="color: gray; margin-top: 30px; --darkreader-inline-color:#bfb9ac;" data-darkreader-inline-color="">[ 此帖被bingkan在2012-10-26 16:04重新编辑 ]</div></div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5419113" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-10-26 15:57 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 6楼(bingkan) 的帖子');" data-mx-warn="Empty URL">6 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5419128" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>bingkan</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-fe8ef3331f97b66ca7156370f35bcf33.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_7"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空一年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-f43195cd588caa26c296fcc61910b3e6.gif"><br>

<span class="user-info2" id="showface_7">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">53</span><br>
学分: <span class="s2 f9">0 点</span><br>
澄空币: <span class="s3 f9">599 KID</span><br>

		GPA: <span class="s2 f9">0 点</span><br>

		<span class="gray">注册时间:2012-02-02<br>
		最后登录:2014-06-29 <br><br> 
		</span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5419128" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5419128&amp;article=7" onclick="return sendurl(this,4,event)" id="quote_5419128" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5419128&amp;article=7" id="modify_5419128" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5419128" onclick="return sendurl(this,8)" id="report_5419128" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=735425" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5419128')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5419128" class="fl">&nbsp;</h1>
			

			<div id="p_5419128" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5419128">初音大的Delphi和crass的代码解密函数几乎是一样的。一共有三个。<br>看起来真正解密的是中间那个在循环里的函数。那上下两个是干嘛用的呢？<br>另外第一个置零前的offset是怎么获得的呢？</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5419128" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-10-26 16:23 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 7楼(bingkan) 的帖子');" data-mx-warn="Empty URL">7 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5419278" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>初音拓海</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-80678a1e90de4d0a85fbe524c3d35182.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_8"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空二年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-3699e74cfe4e975552e8db25eb7cc233.gif"><br>

<span class="user-info2" id="showface_8">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">412</span><br>
学分: <span class="s2 f9">11 点</span><br>
澄空币: <span class="s3 f9">674 KID</span><br>

		GPA: <span class="s2 f9">1 点</span><br>

		<span class="gray">注册时间:2009-05-07<br>
		最后登录:2017-06-12 <br><br> 
		<img src="assets/1570973869-d1be6d7f9758587bb010e932f19b099a.gif" title="ピアノの森の満開の下"> <img src="assets/1570973869-15e89d0b08be5c8eefbdfacf3bb9dffd.gif" title="天神乱漫汉化纪念勋章"> <img src="assets/1570973869-0be30e42d981b60e7b1ef013372e2d39.gif" title="V.G.NEO汉化纪念勋章"> <img src="assets/1570973869-cf90ee580aa7aa167980e457d4ade136.gif" title="青空の見える丘汉化纪念勋章"> <img src="assets/1570973869-28c25581c211b3c7aef52d987ff9b722.gif" title="Akabeesoft2主题学部纪念勋章"> <img src="assets/1570973869-073c3b6be58f710904aa8fb76d998d56.gif" title="高町なのは"> <br></span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5419278" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5419278&amp;article=8" onclick="return sendurl(this,4,event)" id="quote_5419278" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5419278&amp;article=8" id="modify_5419278" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5419278" onclick="return sendurl(this,8)" id="report_5419278" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=284925" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5419278')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5419278" class="fl">&nbsp;</h1>
			

			<div id="p_5419278" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5419278"><h6 class="quote">Quote:</h6><blockquote class="blockquote">引用第7楼bingkan于2012-10-26 16:23发表的&nbsp;&nbsp;:<br>初音大的Delphi和crass的代码解密函数几乎是一样的。一共有三个。<br>看起来真正解密的是中间那个在循环里的函数。那上下两个是干嘛用的呢？<br>另外第一个置零前的offset是怎么获得的呢？</blockquote><br><br>ntt网络不好，看不了贴吧……（有时连白毒首页都打不开）<br><br>base offset在crass里一般是指header＋index length<br><br>既然header和index能解出来就好办<br>索引的加密是放在一起的，产生key用sizeof（header），应该一起解出来的<br><br>三个块，前后都是和对其有关的，保证数据不是16字节对其时正确解密最后LENGTH mod 16的那部分<br>解密都一样<br><br>－－－更新<br>看到贴吧的图了<br>两张图都没问题啊</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5419278" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-10-26 20:32 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 8楼(初音拓海) 的帖子');" data-mx-warn="Empty URL">8 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5419379" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>bingkan</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-fe8ef3331f97b66ca7156370f35bcf33.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_9"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空一年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-f43195cd588caa26c296fcc61910b3e6.gif"><br>

<span class="user-info2" id="showface_9">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">53</span><br>
学分: <span class="s2 f9">0 点</span><br>
澄空币: <span class="s3 f9">599 KID</span><br>

		GPA: <span class="s2 f9">0 点</span><br>

		<span class="gray">注册时间:2012-02-02<br>
		最后登录:2014-06-29 <br><br> 
		</span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5419379" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5419379&amp;article=9" onclick="return sendurl(this,4,event)" id="quote_5419379" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5419379&amp;article=9" id="modify_5419379" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5419379" onclick="return sendurl(this,8)" id="report_5419379" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=735425" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5419379')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5419379" class="fl">&nbsp;</h1>
			

			<div id="p_5419379" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5419379"><h6 class="quote">Quote:</h6><blockquote class="blockquote">引用第8楼初音拓海于2012-10-26 20:32发表的&nbsp;&nbsp;:<br><br><br>ntt网络不好，看不了贴吧……（有时连白毒首页都打不开）<br><br>base offset在crass里一般是指header＋index length<br>.......</blockquote><br><br><br>后面的索引肯定是有问题的，至少我在运行程序的时候屏幕输出Al_Key ，始终是0 ， 就是第一个和第三个函数根本没起作用。结果就这样，只用这一个函数<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; size / CAMELLIA_BLOCK_SIZE; i++)<br><br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotate16bytes((unsigned int)offset, (DWORD *)enc) ;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Camellia_DecryptBlock(128, enc, keyTable, dec);<br><br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enc += CAMELLIA_BLOCK_SIZE;<br><br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec += CAMELLIA_BLOCK_SIZE;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset += 16 ;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>就得到那两张图片的结果了。不过貌似影响不是很大，虽然不工整，不过可以解包封包，反过来加密也很简单。（虽然很蛋疼Orz……）<br>解包我用的quickbms，这可是个好物啊~<img src="assets/1570973869-a32f10156415b7ffaf41b808023d9e34.gif"><br><br>接下来再研究下malie.exe<br><br>总之真心感谢初音大指点，有时候自己看不懂别人一句话就点明白了~~</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5419379" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-10-26 22:57 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 9楼(bingkan) 的帖子');" data-mx-warn="Empty URL">9 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="5431177" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>bingkan</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-fe8ef3331f97b66ca7156370f35bcf33.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_10"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空一年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-f43195cd588caa26c296fcc61910b3e6.gif"><br>

<span class="user-info2" id="showface_10">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">53</span><br>
学分: <span class="s2 f9">0 点</span><br>
澄空币: <span class="s3 f9">599 KID</span><br>

		GPA: <span class="s2 f9">0 点</span><br>

		<span class="gray">注册时间:2012-02-02<br>
		最后登录:2014-06-29 <br><br> 
		</span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5431177" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5431177&amp;article=10" onclick="return sendurl(this,4,event)" id="quote_5431177" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5431177&amp;article=10" id="modify_5431177" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=735425" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5431177" onclick="return sendurl(this,8)" id="report_5431177" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=735425" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5431177')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5431177" class="fl">&nbsp;</h1>
			

			<div id="p_5431177" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5431177"><h6 class="quote">Quote:</h6><blockquote class="blockquote">引用第8楼初音拓海于2012-10-26 20:32发表的&nbsp;&nbsp;:<br><br><br>ntt网络不好，看不了贴吧……（有时连白毒首页都打不开）<br><br>base offset在crass里一般是指header＋index length<br>.......</blockquote><br><br>经过一段时间蛋疼的努力，现在文件包的封包解包，文本的导入导出都已经完成。<br>我简单改了下文本，测试，发现这游戏不脱壳也行。<br>现在剩下一个最蛋疼的问题，导出的资源文件再次导入貌似存在校验，而且好像和文件的大小是一一对应的。比较了一下之前测试补丁的malie-c.dll和游戏原来的sc.dll二者只差七个字节，猜测这东西和校验有关~<br>不知初音大对当年这里还有木有印象，对新人来说程序的问题还能自己努力解决，不过这种问题真的需要经验了~<br>嗯，再次请教下~~</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5431177" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-11-15 01:23 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 10楼(bingkan) 的帖子');" data-mx-warn="Empty URL">10 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

<a name="a" data-mx-warn="Empty URL"></a><a name="5431469" data-mx-warn="Empty URL"></a>
<div class="t t2"><table cellspacing="0" cellpadding="0" width="100%" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;" data-darkreader-inline-border-top="">
	<tbody><tr class="tr1"><th style="width:20%" rowspan="2" class="r_two">

		<img src="assets/1570973869-1cde2ccde0fc90dbe6db3784fc6ec383.gif" title="该用户目前不在线" align="absmiddle">

<b>初音拓海</b>
<div style="margin:.3em 0 .4em .2em"></div>
<div class="user-pic"><table style="border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><tbody><tr><td width="1">

<a href="https://bbs.sumisora.net/profile.php?action=show&amp;uid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img class="pic" src="assets/1570973869-80678a1e90de4d0a85fbe524c3d35182.jpg" style="max-width:185px;max-height:200px;overflow:hidden" border="0"></a>

</td><td style="vertical-align:top"><span id="sf_11"></span></td></tr></tbody></table>
</div>
		级别: <font color="#555555" data-darkreader-inline-color="" style="--darkreader-inline-color:#cfc9be;">澄空二年生上学期</font><br>
		<img style="margin:.2em 0 .6em" src="assets/1570973869-3699e74cfe4e975552e8db25eb7cc233.gif"><br>

<span class="user-info2" id="showface_11">
<span class="user-infoWrap2">


精华:

		<span class="s4">0</span>
<br>
发帖: <span class="s1 f9">412</span><br>
学分: <span class="s2 f9">11 点</span><br>
澄空币: <span class="s3 f9">674 KID</span><br>

		GPA: <span class="s2 f9">1 点</span><br>

		<span class="gray">注册时间:2009-05-07<br>
		最后登录:2017-06-12 <br><br> 
		<img src="assets/1570973869-d1be6d7f9758587bb010e932f19b099a.gif" title="ピアノの森の満開の下"> <img src="assets/1570973869-15e89d0b08be5c8eefbdfacf3bb9dffd.gif" title="天神乱漫汉化纪念勋章"> <img src="assets/1570973869-0be30e42d981b60e7b1ef013372e2d39.gif" title="V.G.NEO汉化纪念勋章"> <img src="assets/1570973869-cf90ee580aa7aa167980e457d4ade136.gif" title="青空の見える丘汉化纪念勋章"> <img src="assets/1570973869-28c25581c211b3c7aef52d987ff9b722.gif" title="Akabeesoft2主题学部纪念勋章"> <img src="assets/1570973869-073c3b6be58f710904aa8fb76d998d56.gif" title="高町なのは"> <br></span>
		</span></span>
		</th>
		<th height="100%" class="r_one" valign="top" id="td_5431469" style="padding: 5px 15px 0px; border: 0px; width: 80%; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=10978083&amp;pid=5431469&amp;article=11" onclick="return sendurl(this,4,event)" id="quote_5431469" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=10978083&amp;pid=5431469&amp;article=11" id="modify_5431469" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=284925" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=10978083&amp;pid=5431469" onclick="return sendurl(this,8)" id="report_5431469" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=10978083&amp;uid=284925" title="只看该作者的所有回复" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('5431469')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_5431469" class="fl">&nbsp;</h1>
			

			<div id="p_5431469" class="c"></div>

<!--
-->

			<div class="tpc_content" id="read_5431469"><h6 class="quote">Quote:</h6><blockquote class="blockquote">引用第10楼bingkan于2012-11-15 01:23发表的&nbsp;&nbsp;:<br><br><br>经过一段时间蛋疼的努力，现在文件包的封包解包，文本的导入导出都已经完成。<br>我简单改了下文本，测试，发现这游戏不脱壳也行。<br>现在剩下一个最蛋疼的问题，导出的资源文件再次导入貌似存在校验，而且好像和文件的大小是一一对应的。比较了一下之前测试补丁的malie-c.dll和游戏原来的sc.dll二者只差七个字节，猜测这东西和校验有关~<br>.......</blockquote><br><br>这个没印象了，当时似乎没遇到过这种事情<br>当然如果说script的话，当时文本是z大负责的，不知道有没有资料留下来<br>//当时文本似乎是嵌在exe里的，所以必须脱壳</div>
		</th>
	</tr>
	<tr class="tr1 r_one">
		<th style="vertical-align: bottom; padding-left: 15px; border: 0px; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">

		<div id="w_5431469" class="c"></div>

		<div class="tipad"><span style="float:right">
<a href="javascript:scroll(0,0)" title="顶端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">顶端</a> <a href="javascript:scroll(0,999999)" title="底端" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">底端</a></span>
			
			<span class="gray"> 2012-11-15 18:00 | 
	
			</span>

			<span><a class="s3" title="回复此楼" style="cursor:pointer;" onclick="postreply('回 11楼(初音拓海) 的帖子');" data-mx-warn="Empty URL">11 楼</a></span>

		</div></th>
	</tr></tbody></table>
</div>

</form>
<div class="t3" style="margin:initial"><table cellspacing="0" cellpadding="0" width="100%" align="center">
	<tbody><tr><td align="left"></td>
		<td valign="center" align="right">
		<a class="abtn f_two" id="readlog" onclick="sendmsg('pw_ajax.php?action=readlog','',this.id);" data-mx-warn="Empty URL">帖子浏览记录<img src="assets/1570973869-5c8e409588b73ce4284cf5b9bd619e15.gif"></a>
		<select onchange="Fjump(this.options[this.selectedIndex].value)"><option value="" selected="">快速跳至</option>
<option value="1">&gt;&gt; 『澄空学园 办公楼区』</option>
<option value="2"> &nbsp;|- 【校园公告栏】</option>
<option value="5"> &nbsp;|- 【论坛意见箱】</option>
<option value="113">&gt;&gt; 『澄空学园 资讯社』</option>
<option value="47"> &nbsp;|- 【新鲜速报】</option>
<option value="103"> &nbsp;|- 【新作介绍】</option>
<option value="8"> &nbsp; &nbsp;|-  【电子杂志下载区】</option>
<option value="104"> &nbsp;|- 【杂志专题】</option>
<option value="7">&gt;&gt; 『澄空学园 教学楼区』</option>
<option value="62"> &nbsp;|- 【AGE主题学部】</option>
<option value="39"> &nbsp;|- 【Akabeesoft2主题学部】</option>
<option value="100"> &nbsp;|- 【AUGUST主题学部】</option>
<option value="42"> &nbsp;|- 【CIRCUS主题学部】</option>
<option value="40"> &nbsp;|- 【Cotton-Nekoneko主题学部】</option>
<option value="64"> &nbsp;|- 【GIGA主题学部】</option>
<option value="38"> &nbsp;|- 【Key主题学部】</option>
<option value="10"> &nbsp;|- 【KID主题学部】</option>
<option value="37"> &nbsp;|- 【Leaf主题学部】</option>
<option value="70"> &nbsp;|- 【minori主题学部】</option>
<option value="12"> &nbsp;|- 【Navel主题学部】</option>
<option value="65"> &nbsp;|- 【Nitro+主题学部】</option>
<option value="14"> &nbsp;|- 【Type-Moon应援会】</option>
<option value="17"> &nbsp; &nbsp;|-  【TM精华区】</option>
<option value="98"> &nbsp;|- 【Will主题学部】</option>
<option value="116"> &nbsp;|- 【FAVORITE主题学部】</option>
<option value="108"> &nbsp;|- 【ALcot主题学部】</option>
<option value="55"> &nbsp;|- 【GALGAME综合作品讨论室】</option>
<option value="97"> &nbsp; &nbsp;|-  【Light主题学部】</option>
<option value="117"> &nbsp; &nbsp;|-  【CUFFS主题学部】</option>
<option value="15"> &nbsp; &nbsp;|-  【Liar Soft主题学部】</option>
<option value="57"> &nbsp; &nbsp;|-  【Purple 主题学部】</option>
<option value="13"> &nbsp; &nbsp;|-  【工画堂主题学部】</option>
<option value="35"> &nbsp;|- 【GALGAME综合杂谈室】</option>
<option value="99"> &nbsp;|- 【ぱれっと主题学部】</option>
<option value="122"> &nbsp;|- 【SAGA PLANETS研讨室】</option>
<option value="123"> &nbsp;|- 【Lump of Sugar 研讨室】</option>
<option value="86">&gt;&gt; 『澄空学园 图书馆』</option>
<option value="80"> &nbsp;|- 【游戏鉴赏室】</option>
<option value="56"> &nbsp;|- 【GALGAME攻略馆】</option>
<option value="115"> &nbsp;|- 【作品出处问询室】</option>
<option value="63"> &nbsp;|- 【Galgame疑问求助室】</option>
<option value="18">&gt;&gt; 『澄空学园 教辅楼区』</option>
<option value="73"> &nbsp;|- 【同人游戏区】</option>
<option value="60"> &nbsp;|- 【二次元轻小说社】</option>
<option value="20"> &nbsp;|- 【日语自学教室】</option>
<option value="61"> &nbsp; &nbsp;|-  【日语学习资料区】</option>
<option value="118"> &nbsp; &nbsp;|-  【日语参考文章区】</option>
<option value="21"> &nbsp;|- 【一般游戏社团】</option>
<option value="24"> &nbsp;|- 【多媒体课堂】</option>
<option value="88">&gt;&gt; 『澄空学园 原创综合区』</option>
<option value="79"> &nbsp;|- 【原创游戏部】</option>
<option value="36"> &nbsp; &nbsp;|-  【ss-square】</option>
<option value="89"> &nbsp;|- 【MAD研究室】</option>
<option value="91"> &nbsp;|- 【莉可屋 REC ROOM】</option>
<option value="119"> &nbsp; &nbsp;|-  【澄空百合社翻唱作品】</option>
<option value="19"> &nbsp;|- 【澄空文学部】</option>
<option value="120"> &nbsp; &nbsp;|-  【落日余晖】</option>
<option value="23"> &nbsp;|- 【绘画工房】</option>
<option value="69"> &nbsp;|- 【活动投票区】</option>
<option value="74"> &nbsp;|- 【友谊赛投票区】</option>
<option value="58"> &nbsp;|- 【澄空部活室】</option>
<option value="41"> &nbsp;|- 【暑假原创作品活动专区】</option>
<option value="59"> &nbsp;|- 【实物周边交流区】</option>
<option value="85"> &nbsp; &nbsp;|-  【ComicMarket相关资料】</option>
<option value="82"> &nbsp; &nbsp;|-  【新品介绍】</option>
<option value="84"> &nbsp; &nbsp;|-  【综合交流】</option>
<option value="83"> &nbsp; &nbsp;|-  【好物收集】</option>
<option value="81"> &nbsp; &nbsp;|-  【交易求购】</option>
<option value="95"> &nbsp;|- 【澄空放送部】</option>
<option value="111"> &nbsp; &nbsp;|-  【放送策划室】</option>
<option value="27"> &nbsp;|- 【水下乐园LeMU】</option>
<option value="46"> &nbsp; &nbsp;|-  【美工作品收藏室】</option>
<option value="26"> &nbsp; &nbsp;|-  【COS自爆馆】</option>
<option value="90"> &nbsp; &nbsp;|-  【澄空期刊室】</option>
<option value="71"> &nbsp;|- 【澄空演剧部】</option>
<option value="9"> &nbsp; &nbsp;|-  演剧部排练室</option>
<option value="52"> &nbsp;|- 【废帖回收站】</option>
<option value="29">&gt;&gt; 『澄空学园 好物交流站』</option>
<option value="50"> &nbsp;|- 【澄空学园字幕作品】</option>
<option value="51"> &nbsp;|- 【澄空学园漫画作品】</option>
<option value="77"> &nbsp;|- 【游戏汉化交流区】</option>
<option value="28"> &nbsp; &nbsp;|-  【CK-GAL中文化小组】</option>
<option value="106"> &nbsp; &nbsp;|-  【PRO2】</option>
<option value="49"> &nbsp; &nbsp;|-      【桜】</option>
<option value="30"> &nbsp;|- 【资源求助区】</option>
<option value="32"> &nbsp;|- 【澄空音乐厅】</option>
<option value="33"> &nbsp;|- 【澄空美术馆】</option>
<option value="34"> &nbsp;|- 【动漫租售屋】</option>
<option value="44">&gt;&gt; 『澄空学园 课余工作区』</option>
<option value="45"> &nbsp;|- 【澄空漫画汉化组】</option>
<option value="48"> &nbsp;|-  【澄空学园字幕组】</option>
<option value="101"> &nbsp; &nbsp;|-  字幕组资料区</option>
<option value="72"> &nbsp;|- 【澄空学园分流组】</option>
<option value="87"> &nbsp;|- 【澄空学园新闻组】</option>
<option value="96"> &nbsp;|- 【澄空学园文学社】</option>
<option value="75"> &nbsp;|- 【澄空学园百合社】</option>
<option value="112"> &nbsp;|- 【澄空学园编辑部】</option>
<option value="114"> &nbsp;|- 【澄空学园美工部】</option>
<option value="121"> &nbsp;|-  【澄空祭运行委员会】</option>
</select></td>
		
	</tr>
	<tr><td style="padding-top: 12px;text-align: left;"><img src="assets/1570973869-ca4a91079181c2a5cb3514b2e5b5f035.gif" align="absbottom"> <b><a href="https://bbs.sumisora.net/index.php" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">『澄空学园』</a> » <a href="https://bbs.sumisora.net/thread.php?fid=78&amp;page=4" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">【汉化破解研讨室】</a></b> </td>
	<td style="padding-top: 12px;text-align: right;"><a href="https://bbs.sumisora.net/post.php?action=reply&amp;fid=78&amp;tid=10978083" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img src="assets/1570973869-132cb83b134d7ecd9b390389d489bc43.png"></a>

<a href="https://bbs.sumisora.net/post.php?fid=78" style="margin-left:.5em" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><img src="assets/1570973869-8cab7ee31ae503cf78e5410d40cec291.png" id="td_post1"></a>
</td>
	</tr>
</tbody></table></div>




<form name="FORM" method="post" action="post.php?" enctype="multipart/form-data" onsubmit="return checkpost(document.FORM);">
<div class="t" style="margin-top:8px"><table cellspacing="0" cellpadding="0" align="center" width="100%">
	<tbody><tr>
		<td class="h" colspan="3"><b>快速发帖</b></td>
	</tr>
	<tr></tr>
	<tr class="tr2"><td colspan="100" style="border-bottom: 0px; --darkreader-inline-border-bottom: initial;" data-darkreader-inline-border-bottom=""></td></tr>
	<tr>
		<td valign="top" width="20%" class="f_one" style="padding:7px">
		<fieldset id="smiliebox" style="border: 1px solid rgb(213, 229, 232); --darkreader-inline-border-top:#354e51; --darkreader-inline-border-right:#354e51; --darkreader-inline-border-bottom:#354e51; --darkreader-inline-border-left:#354e51;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
		<legend>内容</legend>
		<br>
		<input type="checkbox" name="atc_usesign" value="1" checked="">使用签名<br>
		<input type="checkbox" name="atc_convert" value="1" checked="">Wind Code自动转换 <br>
	 	<input type="checkbox" id="atc_autoimg" name="atc_autoimg" value="1" onchange="onAutoImgchange()" checked="" title="此设置会记在浏览器中"><label for="atc_autoimg" title="此设置会记在浏览器中">自动分析img</label><br><br>
	 	
		<input type="checkbox" name="atc_requiresell" value="1" disabled="">出售此帖
		<input class="input" type="text" maxlength="3" size="3" name="atc_money" value="0">
		<br>
		<input type="checkbox" name="atc_requirervrc" value="1">加密此帖
		<input class="input" type="text" maxlength="6" size="3" name="atc_rvrc" value="0">
		<br>
		<br><br><a href="https://bbs.sumisora.net/read.php?tid=10925672" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">如何在帖子中贴图？</a>
		<br><a href="https://bbs.sumisora.net/read.php?tid=10942243" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Wind Code使用教程</a>
		<br><a href="https://bbs.sumisora.net/yume/recover/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">恢复帖子内容</a>
		</fieldset>
		</td>
		<td width="60%" class="f_one" style="padding:7px">
		<div>


<blockquote style="width: 96%;" class="blockquote">澄空娘：『发帖请注意内涵，“占楼”“路过”“留名”这样的行为是不受欢迎的
』</blockquote>

		<input type="text" class="input" name="atc_title" value="Re:Some about Malie（Dies irae/LIGHT）" size="65">
		

		 认证码: <input class="input" type="text" name="gdcode" size="5" tabindex="6" onfocus="try{opencode('menu_gd',this)}catch(e){}"><br>
		

		</div><div style="padding:.3em 0">
		</div>
		<textarea onkeydown="quickpost(event)" id="atc_content" name="atc_content" rows="8" style="width:96%"></textarea>
		
		
		
		
		
		<div style="margin:5px 0">
		<div style="padding: 4px 10px 0px 0px; float: left; color: rgb(136, 136, 136); --darkreader-inline-color:#bfb9ac;" data-darkreader-inline-color="">按 Ctrl+Enter 直接提交</div>
		<input class="btn" type="submit" name="Submit" value=" 提 交 "></div>
		</td>
		<td width="20%" class="f_one">
		<div style="padding:3px; text-align:center; width:200px;">
		<fieldset id="smiliebox" style="border: 1px solid rgb(213, 229, 232); --darkreader-inline-border-top:#354e51; --darkreader-inline-border-right:#354e51; --darkreader-inline-border-bottom:#354e51; --darkreader-inline-border-left:#354e51;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<legend>表情</legend>
			<div id="menu_show"></div>
<span style="float:right; margin:3px 10px 5px;"><a id="td_face" style="cursor:pointer;" onclick="showDefault();" align="absmiddle" unselectable="on" data-mx-warn="Empty URL">[更多]</a></span>
<span style="float:left; margin:3px 10px 5px;"><a id="td_generalface" style="cursor:pointer;" onclick="showfaces();$('#td_generalface').fadeOut();" align="absmiddle" data-mx-warn="Empty URL">[显示表情]</a></span>
		</fieldset></div>
		
		
		</td>
	</tr>
</tbody></table></div></form>







</div>
<div id="bottom"></div><br>
<center class="gray">
<small><span id="windspend">Total 0.044786(s) query 6, Time is now 10-13 21:06, 
Load is low.
</span> <br>
Powered by <a href="http://www.phpwind.net/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><b>PHPWind</b></a> <a href="http://www.phpwind.net/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><b style="color: rgb(255, 153, 0); --darkreader-inline-color:#f7b24b;" data-darkreader-inline-color="">v6.3.2</b></a> Code © 2003-08 <a href="http://www.phpwind.com/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><b>PHPWind.com</b></a> Corporation</small>
</center><br>
<div id="footer">
	<span class="f12 fl"></span><a href="https://bbs.sumisora.net/sendmail.php" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Contact us</a>

</div>
</div>
        
      </div>
    </body>
  </html>